define("bitbucket/util/scheduler",["exports","jquery","lodash"],function(b,c,k){Object.defineProperty(b,"__esModule",{value:!0});b.MINUTE=b.SECOND=void 0;var l=babelHelpers.interopRequireDefault(c),d=b.SECOND=1E3;c=b.MINUTE=60*d;var h=function(){function b(){var a=this,g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};babelHelpers.classCallCheck(this,b);this.schedule=babelHelpers.extends({},b.defaults,g);if("function"!==typeof g.job)throw Error("A schedule's job must be a function.");if(1>
g.interval)throw Error("A schedule's interval must be a positive number.");this.currentInterval=this.schedule.interval;this._destroyables=[];this.lastActiveTime=Date.now();var c=(0,k.debounce)(function(){Date.now()-a.lastActiveTime>a.schedule.inactivityTime?a.start(!0):a._setActiveTime()},100),d=function(){return a._setActiveTime()},e=(0,l.default)(window),f=[];!0===this.schedule.backoff.onBlur&&(document.hasFocus()||this.stop(),f.push("focus.scheduler"),e.on("blur.scheduler",d),this._destroyables.push(function(){return e.off("blur.scheduler",
d)}));!0===this.schedule.backoff.onInactive&&f.push("mousemove.scheduler","keydown.scheduler","scroll.scheduler");e.on(f.join(" "),c);this._destroyables.push(function(){return e.off(f.join(" "),c)})}babelHelpers.createClass(b,[{key:"_setActiveTime",value:function(){this.lastActiveTime=Date.now()}},{key:"_getJitter",value:function(){return this.schedule.jitter?Math.floor(50+(d-50)*Math.random()):0}},{key:"getBackoffTime",value:function(){return Date.now()-this.lastActiveTime>=Math.max(this.currentInterval,
2*this.schedule.interval)?Math.min(2*this.currentInterval,this.schedule.maxInterval):this.schedule.interval}},{key:"run",value:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!1,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.running&&!this._destroyed&&(this.currentInterval=this.getBackoffTime(),this.runTimer=setTimeout(function(){a.jobDeferred=a.schedule.job();a.jobDeferred.always(function(){a.running&&a.run()})},(b?this.schedule.immediateTime:this.currentInterval)+
c))}},{key:"stop",value:function(){this.jobDeferred&&this.jobDeferred.abort&&(this.jobDeferred.abort(),this.jobDeferred=null);clearTimeout(this.runTimer);this.running=!1}},{key:"start",value:function(a){this.stop();this._setActiveTime();this.running=!0;this._currentJitter=this._getJitter();this.run(a,this._currentJitter)}},{key:"destroy",value:function(){this.stop();this._destroyables.forEach(function(a){return a()});this._destroyed=!0}}]);return b}();h.defaults={immediateTime:d,backoff:{onBlur:!0,
onInactive:!0},jitter:!0,interval:10*d,maxInterval:5*c,inactivityTime:2*c};b.default=h});