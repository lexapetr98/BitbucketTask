define("bitbucket/util/server","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/model/page-state bitbucket/internal/util/error bitbucket/internal/util/function bitbucket/internal/widget/error-dialog/error-dialog".split(" "),function(C,k,D,E,F,G,H,I,J,K){function L(a,h,d,f){if(new Date<d){var g=function(){var g=Math.ceil((+d-+new Date)/h);0>=g?(clearInterval(c),f()):a.text(g)},c=setInterval(g,h);g()}else f()}function M(a,d,c,f,g){new Date<g&&(a.addClass("hidden"),
a.before(d),L(c,f,g,function(){d.remove();a.removeClass("hidden")}))}function N(a,h,c,f){function g(){z.apply(p,arguments)}function r(b,a,u,f,m,h,c){if(b.shouldLogin)return window.onbeforeunload=null,window.location.href=O.default.login().next(window.location.href).build(),d.default.Deferred();a&&delete a.errors;var e;v||(e=new P.default);var t=b.shouldRetry&&!v?d.default.Deferred():d.default.Deferred().rejectWith(this,[f,u,m,a,e]);if(!v){c="";var q=!1,k=bitbucket.internal.widget.errorContent(b);
e.addHideListener(function(){v=!1});var l={id:"ajax-error",titleText:b.title,titleClass:b.titleClass||"error-header",showCloseButton:w.default.isUndefined(b.canClose)?!0:b.canClose,closeOnOutsideClick:!1};if(b.fallbackUrl)l.okButtonText=n.default.escapeHtml(b.fallbackTitle),e.addOkListener(function(a){window.location.href=b.fallbackUrl;a.preventDefault()});else if(b.shouldReload)l.okButtonText=n.default.escapeHtml(n.default.I18n.getText("bitbucket.web.ajax.reload")),e.addOkListener(function(b){window.location.reload();
b.preventDefault()});else if(b.shouldRetry){t.notify("stalled");b.retryAfterDate&&(36E5<+b.retryAfterDate-+new Date?c=n.default.I18n.getText("bitbucket.web.retry.later"):q=!0);l.okButtonText=n.default.escapeHtml(n.default.I18n.getText("bitbucket.web.ajax.try.again"));var r;e.addOkListener(function(b){t.notify("unstalled");r=x(h);e.remove();p=r;z=p.abort;p.abort=g;r.done(function(){return t.resolveWith(this,arguments)});r.fail(function(){return t.rejectWith(this,arguments)});b.preventDefault()});e.addHideListener(function(){"pending"!==
t.state()||r||t.rejectWith(this,[f,u,m,a])})}else l.showCloseButton=!1;l.panelContent="\x3cp\x3e"+k+c+"\x3c/p\x3e";setTimeout(function(){e.reinit(l).show()},0);v=!0;q&&(6E4<+b.retryAfterDate-+new Date?(q=n.default.I18n.getText("bitbucket.web.retry.in.x.minutes","\x3ctime\x3e\x3cspan\x3e\x3c/span\x3e","\x3c/time\x3e"),c=6E4):(q=n.default.I18n.getText("bitbucket.web.retry.in.x.seconds","\x3ctime\x3e\x3cspan\x3e\x3c/span\x3e","\x3c/time\x3e"),c=1E3),q=(0,d.default)("\x3cspan\x3e"+q+"\x3c/span\x3e"),
k=q.children("time").children(),M(e.getOkButton(),q,k,c,b.retryAfterDate))}return t}function l(b,a,c,g,m,d){var e=f?A.default.getDominantRESTError(b,c):A.default.getDominantAJAXError(c),u=!0;if(m){if((m=m(e))&&"function"===typeof m.promise)return m.promise(c);m&&w.default.isObject(m)&&(e=m);u=!1!==m}return u&&e?r(e,b,a,c,g,h,f):d()}function k(b){b=c[b];null==b&&(b=c["*"]);return"function"===typeof b?b:Q.default.constant(b)}var p=a;var z=p.abort;p.abort=g;return a.then(function(b,a,c){var e=this,g=
k(c.status);g=g?w.default.bind(g,e,b,a,c):null;return l(b,a,c,null,g,function(){return d.default.Deferred().resolveWith(e,[b,a,c])})},function(a,c,g){var b=this,e=a.responseText;try{e=JSON.parse(e)}catch(R){}var f=k(a.status);f=f?w.default.bind(f,b,a,c,g,e):null;return l(e,c,a,g,f,function(){return d.default.Deferred().rejectWith(b,[a,c,g,e])})}).promise(a)}function x(a,h){if(a.statusCode){var c=a.statusCode;delete a.statusCode}c=c||{};var f=N(d.default.ajax(a),a,c,h);f.statusCode=function(a){if(a)if("pending"===
f.state())d.default.extend(c,a);else{for(var g in a)if(a.hasOwnProperty(g)){n.default.log("xhr.statusCode() should not be called after the request has completed. Your handler will have no affect on the resolution of the request.");break}a=a[f.status];f.then(a,a)}};return f}function B(a){var h={};y.default.getCurrentUser()&&(h["X-AUSERNAME"]=y.default.getCurrentUser().getName(),h["X-AUSERID"]=y.default.getCurrentUser().getId());a=d.default.extend(!0,{dataType:"json",contentType:"application/json",
headers:h,jsonp:!1,type:"GET"},a);"GET"!==a.type.toUpperCase()&&(d.default.isPlainObject(a.data)||d.default.isArray(a.data))&&(a.data=JSON.stringify(a.data));return x(a,!0)}Object.defineProperty(k,"__esModule",{value:!0});var n=babelHelpers.interopRequireDefault(D),d=babelHelpers.interopRequireDefault(E),w=babelHelpers.interopRequireDefault(F),O=babelHelpers.interopRequireDefault(G),y=babelHelpers.interopRequireDefault(H),A=babelHelpers.interopRequireDefault(I),Q=babelHelpers.interopRequireDefault(J),
P=babelHelpers.interopRequireDefault(K);d.default.ajaxSetup({timeout:6E4});var v=!1;k.default={ajax:function(a){return x(a)},createEmptyPage:function(){return d.default.Deferred().resolve({start:0,size:0,values:[],isLastPage:!0}).promise()},method:{DELETE:"DELETE",GET:"GET",PATCH:"PATCH",POST:"POST",PUT:"PUT"},poll:function(a){a=d.default.extend({pollTimeout:6E4,interval:500,delay:0,tick:d.default.noop},a);var h=!1,c=!1,f=d.default.Deferred(),g=Date.now(),k=function p(){h||c||(c=!0,B(a).done(function(c,
b,e){var d=a.tick(c,b,e);d?f.resolveWith(this,[c,b,e]):!1!==a.pollTimeout&&Date.now()-g>a.pollTimeout||"undefined"!==typeof d?f.rejectWith(this,[e,b,null,c]):setTimeout(p,a.interval)}).fail(function(a,b,c,d){f.rejectWith(this,[a,b,c,d])}).always(function(){c=!1}))};setTimeout(k,a.delay);var l=f.promise();l.resume=function(){h&&(h=!1,k())};l.pause=function(){h=!0};return l},rest:B};C.exports=k["default"]});