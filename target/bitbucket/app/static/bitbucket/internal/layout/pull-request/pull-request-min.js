define("bitbucket/internal/layout/pull-request/pull-request","module exports @atlassian/aui chaperone jquery lodash react react-dom react-redux bitbucket/util/events bitbucket/util/navbuilder bitbucket/internal/bbui/actions/pull-request bitbucket/internal/enums bitbucket/internal/feature/file-content/request-change bitbucket/internal/feature/pull-request/header/pull-request-header-view bitbucket/internal/feature/pull-request/pull-request-analytics/pull-request-analytics bitbucket/internal/feature/pull-request/store/pull-request-store bitbucket/internal/model/commit-range bitbucket/internal/model/page-state bitbucket/internal/model/participant bitbucket/internal/model/pull-request bitbucket/internal/model/revision bitbucket/internal/util/dom-event bitbucket/internal/util/events bitbucket/internal/util/feature-enabled bitbucket/internal/util/feature-loader bitbucket/internal/util/history bitbucket/internal/util/horizontal-keyboard-scrolling bitbucket/internal/util/notifications/notifications".split(" "),
function(B,p,q,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,r,Y,Z,aa){function ba(){b.default.on("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",function(a){a.enableContext("pull-request");v.resolve(a)});b.default.on("bitbucket.internal.keyboard.shortcuts.requestGotoPullRequestsListHandler",function(a){(this.execute?this:f.default.whenIType(a)).execute(function(){window.location.href=ca.default.currentRepo().allPullRequests().build()})});b.default.on("bitbucket.internal.keyboard.shortcuts.requestChangePullRequestSectionHandler",
function(a){(this.execute?this:f.default.whenIType(a)).execute(function(a){a=parseInt(String.fromCharCode(a.which),10);l.children().eq(a-1).children("a").click()})})}function da(){var a=function(a,c){a.addClass("active-tab").siblings().removeClass("active-tab");c&&(a=a.data("module-key").split(".").pop(),b.default.trigger("bitbucket.internal.feature.pullRequest.tab."+a,null,{keyboard:!(c.originalEvent instanceof MouseEvent)}))},g=function(a){var c=a.commitJSON;a=a.commitRangeJSON;d.default.setCommit(c?
new ea.default(c):null);d.default.setCommitRange(!c&&a?new fa.default(a):null);e.setContext({commit:c})};l.on("click","a",function(d){if(ha.default.openInSameTab(d)){var c=(0,k.default)(this),h=c.parent();h.is(".active-tab")||(a(h),b.default.trigger("bitbucket.internal.layout.pull-request.urlRequested",null,c.prop("href")));d.preventDefault()}});b.default.on("bitbucket.internal.page.pull-request.view.contextLoaded",function(b){a(l.find('[data-module-key\x3d"'+b.name+'"]'));b.name===m.diff?w.default.resume():
w.default.pause()});b.default.on("bitbucket.internal.feature.pullRequest.commit.open",g);b.default.on("bitbucket.internal.feature.pullRequest.*.view",g);v.done(function(a){x.default.forEach(l.children(),function(c,h){c=(0,k.default)(c);h=String(h+1);var b=f.default.I18n.getText("bitbucket.web.keyboardshortcut.pull-request.switch.tabs",c.text());a.addCustomShortcut("pull-request",[[h]],b);c.attr("title",(c.attr("title")||b)+f.default.I18n.getText("bitbucket.web.keyboardshortcut.type",h))})})}function ia(a,
g,f,c){function h(a,b){(b=x.default.findKey(m,b))&&ja.default.trigger("bitbucket.internal.browser-metrics.pull-request."+b+"."+a)}e.registerHandler(m.diff,/^[^\?\#]*pull-requests\/\d+\/(diff|commits\/\b[0-9a-fA-F]{5,40}\b|unreviewed)/,t?"bitbucket/internal/next/page/pull-request/view/diff/pull-request-view-diff":"bitbucket/internal/page/pull-request/view/pull-request-view-diff");e.registerHandler(m.overview,/^[^\?\#]*pull-requests\/\d+\/overview/,"bitbucket/internal/page/pull-request/view/pull-request-view-overview");
e.registerHandler(m.commits,/^[^\?\#]*pull-requests\/\d+\/commits(\/?)($|[#?])/,"bitbucket/internal/page/pull-request/view/pull-request-view-commits");e.setContext(babelHelpers.extends({},d.default.getPullRequestViewInternal(),{store:f,commit:c}));b.default.on("bitbucket.internal.page.pull-request.view.contextRequested",h.bind(null,"start"));b.default.on("bitbucket.internal.page.pull-request.view.contextLoaded",function(a){h("end",a.name)});b.default.on("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",
function(a){e.setKeyboardShortcuts(a);a.enableContext("pull-request")});b.default.on("bitbucket.internal.layout.pull-request.urlRequested",function(a){a!==window.location.href&&y.default.pushState(null,"",a)});b.default.on("bitbucket.internal.util.feature-loader.errorOccurred",function(a){a.code===z.default.NO_HANDLER?console.log("You did not register a handler for this page. Please call\nrequire('bitbucket/internal/layout/pull-request').registerHandler(\n   'tab-web-item-module-key',\n   /^[^\\?\\#]*url-regex/,\n   {\n       load : function (contentElement) {},\n       unload : function (contentElement) {}\n   }\n)"):
console.log(a.message)});(t?k.default.when(g,WRM.require("wrc!bitbucket.page.pullRequestNext.view")):g).done(function(){return e.init(document.querySelector(a))})}Object.defineProperty(p,"__esModule",{value:!0});var f=babelHelpers.interopRequireDefault(q),u=babelHelpers.interopRequireDefault(C),k=babelHelpers.interopRequireDefault(D),x=babelHelpers.interopRequireDefault(E),A=babelHelpers.interopRequireDefault(F),ka=babelHelpers.interopRequireDefault(G),ja=babelHelpers.interopRequireDefault(I),ca=
babelHelpers.interopRequireDefault(J),n=babelHelpers.interopRequireDefault(L),la=babelHelpers.interopRequireDefault(M),ma=babelHelpers.interopRequireDefault(N),na=babelHelpers.interopRequireDefault(O),oa=babelHelpers.interopRequireDefault(P),fa=babelHelpers.interopRequireDefault(Q),d=babelHelpers.interopRequireDefault(R),pa=babelHelpers.interopRequireDefault(S),qa=babelHelpers.interopRequireDefault(T),ea=babelHelpers.interopRequireDefault(U),ha=babelHelpers.interopRequireDefault(V),b=babelHelpers.interopRequireDefault(W);
q=babelHelpers.interopRequireDefault(X);var z=babelHelpers.interopRequireDefault(r),y=babelHelpers.interopRequireDefault(Y),w=babelHelpers.interopRequireDefault(Z),ra=babelHelpers.interopRequireDefault(aa),m={diff:"bitbucket.pull-request.nav.diff",overview:"bitbucket.pull-request.nav.overview",commits:"bitbucket.pull-request.nav.commits"},l,v=k.default.Deferred(),t=!1;q.default.getFromProvider("pull.request.next").done(function(a){return t=a});var e=new z.default({loadedEvent:"bitbucket.internal.page.pull-request.view.contextLoaded",
unloadedEvent:"bitbucket.internal.page.pull-request.page.pull-request.view.contextUnloaded",requestedEvent:"bitbucket.internal.page.pull-request.view.contextRequested"});r=k.default.proxy(e.registerHandler,e);p.default={registerHandler:r,onReady:function(a){d.default.setPullRequest(new qa.default(a.pullRequestJSON));d.default.extend("pullRequestViewInternal",function(){return{commitsTableWebSections:a.commitsTableWebSections,maxChanges:a.maxChanges,relevantContextLines:a.relevantContextLines,seenCommitReview:a.seenCommitReview}});
d.default.extend("isWatching");a.commitJSON&&y.default.replaceState({commitRange:a.sinceCommitId&&{sinceRevision:{id:a.sinceCommitId},untilRevision:a.commitJSON},commit:!a.sinceCommitId&&a.commitJSON},null);var g=(0,oa.default)();g.dispatch({type:"PR_SET_PULL_REQUEST",payload:a.pullRequestJSON});g.dispatch({type:"SET_CURRENT_USER",payload:d.default.getCurrentUser().toJSON()});ka.default.render(A.default.createElement(H.Provider,{store:g},A.default.createElement(ma.default,{canDelete:a.canDelete,hasRepoWrite:a.hasRepoWrite,
hasSourceRepoWrite:a.hasSourceRepoWrite,hasSourceRepoRead:a.hasSourceRepoRead,mergeTimeout:a.mergeTimeout||300})),document.getElementById("pull-request-header"));l=(0,k.default)(".content-body .aui-page-panel-content \x3e .aui-tabs \x3e .tabs-menu");var e=k.default.Deferred();_PageDataPlugin.ready("com.atlassian.bitbucket.server.bitbucket-web:iswatching-provider","bitbucket.internal.pull-request.view",function(a){g.dispatch({type:K.PR_SET_IS_WATCHING,payload:a.isWatching});d.default.setIsWatching(a.isWatching);
e.resolve()});!0!==a.seenNeedsWork&&(u.default.registerFeature("reviewer-status",[{id:"reviewer-status",alignment:"top right",selector:".reviewing.reviewer-status-selector",content:bitbucket.internal.feature.pullRequest.feature.discovery.reviewerStatus(),close:{text:f.default.I18n.getText("bitbucket.web.got.it")},moreInfo:{href:bitbucket_help_url("bitbucket.help.pull.request"),text:f.default.I18n.getText("bitbucket.web.pullrequest.learn.more"),extraAttributes:{target:"_blank"}},once:!0}]),b.default.on("bitbucket.internal.feature.pullRequest.self.added",
u.default.checkFeatureVisibility));(0,k.default)(document).on("click","button.needs-work",function(){u.default.registerFeature("needs-work-click",[{id:"needs-work-click",selector:"button.needs-work",alignment:"bottom center",title:f.default.I18n.getText("bitbucket.web.pullrequest.reviewer.status.feature.discovery.needs.work.click.title"),content:bitbucket.internal.feature.pullRequest.feature.discovery.reviewerStatusClick(),close:{text:f.default.I18n.getText("bitbucket.web.got.it")},moreInfo:{href:bitbucket_help_url("bitbucket.help.pull.request"),
text:f.default.I18n.getText("bitbucket.web.pullrequest.learn.more"),extraAttributes:{target:"_blank"}},width:340,once:!0}])});b.default.on("bitbucket.internal.feature.pullRequest.self.added",function(){d.default.getPullRequest().getReviewers().add(new pa.default({user:d.default.getCurrentUser(),role:n.default.ParticipantRole.REVIEWER,status:n.default.ApprovalStatus.UNAPPROVED}))});b.default.on("bitbucket.internal.feature.pullRequest.self.removed",function(){var a=d.default.getPullRequest().getReviewers();
a.remove(a.findByUser(d.default.getCurrentUser()))});var c=function(a){if(a.newStatus===n.default.ApprovalStatus.NEEDS_WORK||a.newStatus===n.default.ApprovalStatus.APPROVED){la.default.reset();a=d.default.getPullRequest();var b=d.default.getCurrentUser();a.getReviewers().findByUser(b).setLastReviewedCommit(a.getFromRef().getLatestCommit())}};b.default.chain().on("bitbucket.internal.widget.approve-button.added",c).on("bitbucket.internal.widget.approve-button.removed",c).on("bitbucket.internal.widget.needs-work.added",
c);na.default.init();ba();da();ia(a.contentSelector,e,g,a.commitJSON);ra.default.showFlashes()}};B.exports=p["default"]});