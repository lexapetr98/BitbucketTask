define("bitbucket/internal/layout/maintenance/maintenance","module exports @atlassian/aui jquery bitbucket/util/navbuilder bitbucket/internal/util/ajax bitbucket/internal/widget/confirm-dialog/confirm-dialog bitbucket/internal/widget/progress-bar/progress-bar".split(" "),function(k,e,l,m,n,p,q,r){function t(c,b,a,d){if(b.task){if(b.task.state&&"RUNNING"!==b.task.state)return!0;c.update(b.task.progress);if(100===b.task.progress.percentage)return!0}}function u(b,d){var a=!1,c=v.default.poll({url:b.pollUrl,
pollTimeout:Infinity,interval:500,statusCode:{404:function(){location.href=b.redirectUrl;return!1},"*":!1},tick:function(a,c,w){return b.pollTickCallback(d,a,c,w)}});c.cancel=function(){a=!0};c.isCancelled=function(){return a};return c}Object.defineProperty(e,"__esModule",{value:!0});var d=babelHelpers.interopRequireDefault(l),b=babelHelpers.interopRequireDefault(m),x=babelHelpers.interopRequireDefault(n),v=babelHelpers.interopRequireDefault(p),y=babelHelpers.interopRequireDefault(q),z=babelHelpers.interopRequireDefault(r);
e.default={init:function(c){var e={pollUrl:d.default.contextPath()+"/system/maintenance",pollTickCallback:t,cancelTriggerSelector:".cancel-link",cancelFormSelector:".cancel-form",progressBarSelector:"#progress",redirectUrl:x.default.dashboard().build(),cancelButtonSelector:"#cancel",canceledHeader:d.default.I18n.getText("bitbucket.web.maintenance.canceled.title"),cancelingButtonText:d.default.I18n.getText("bitbucket.web.maintenance.canceling.button"),cancelingDescription:d.default.I18n.getText("bitbucket.web.maintenance.canceling.description"),
hasCancelDialog:!0,cancelDialogId:"cancel-maintenance-dialog",cancelDialogTitle:d.default.I18n.getText("bitbucket.web.maintenance.dialog.title"),cancelDialogTitleClass:"warning-header",cancelDialogDescription:d.default.I18n.getText("bitbucket.web.maintenance.dialog.description"),cancelDialogButtonText:d.default.I18n.getText("bitbucket.web.maintenance.dialog.cancel")},a=b.default.extend({},e,c),h=(0,b.default)(a.cancelTriggerSelector);h.on("click",function(c){(0,b.default)(a.cancelFormSelector).addClass("visible");
h.hide();c.preventDefault()});var f=(0,z.default)(a.progressBarSelector),g=u(a,f).done(function(b){location.href=a.redirectUrl});a.hasCancelDialog&&(c=new y.default({id:a.cancelDialogId,titleText:a.cancelDialogTitle,titleClass:a.cancelDialogTitleClass,panelContent:"\x3cp\x3e"+a.cancelDialogDescription+"\x3c/p\x3e",submitText:a.cancelDialogButtonText}),c.addCancelListener(function(){g.resume();f.active(!0)}),c.addConfirmListener(function(c,d,e){g.cancel();e();d.val(a.cancelingButtonText).prop("disabled",
!0).toggleClass("disabled",!0);f.update({message:a.cancelingDescription,percentage:100});f.reversed(!0);f.active(!0);(0,b.default)("#backup-description").hide();(0,b.default)("#content \x3e header \x3e h1").text(a.canceledHeader)}),c.attachTo(a.cancelButtonSelector,function(){g.pause();f.active(!1)}),(0,b.default)(a.cancelFormSelector).find('input[name\x3d"token"]').each(function(){var c=(0,b.default)(this),d=(0,b.default)(a.cancelButtonSelector);d.prop("disabled",!b.default.trim(c.val()));c.on("input",
function(){d.prop("disabled",!b.default.trim(c.val()))})}))}};k.exports=e["default"]});