define("bitbucket/internal/widget/keyboard-controller",["module","exports","@atlassian/aui","jquery"],function(x,r,B,C){function t(b,d){if(!(this instanceof t))return new t(b,d);var a=(0,e.default)(b),g;a.on("keydown",g=function(a){a.keyCode in d&&(d[a.keyCode](a)||a.preventDefault())});this.destroy=function(){a.off("keydown",g)};return this}function m(b,d){function a(a){a.focus().addClass(d.focusedClass)}d=e.default.extend({},m.defaults,d);var g={};g[v.default.keyCode.TAB]=function(g){var n=g.target,
f=(0,e.default)("a:visible, :input:visible:enabled, :checkbox:visible:enabled, :radio:visible:enabled, [tabindex]",b).not("[tabindex\x3d-1]").filter(function(){return"hidden"!==(0,e.default)(this).css("visibility")}),p=f.last(),q=f.first();f.removeClass(d.focusedClass);if(g.shiftKey&&n===q[0]){if(!d.wrapAround)return!0;a(p)}else if(g.shiftKey||n!==p[0])g.shiftKey?a(f.eq(f.index(n)-1)):a(f.eq(f.index(n)+1));else{if(!d.wrapAround)return!0;a(q)}};return new t(b,g)}function y(b,d,a){function g(c){do{var b=
c.find("\x3e:first-child"),e=c.next();c=b.length?b:e.length?e:c.parentsUntil(f[0]).next().first()}while(c.length&&!c.is(a.itemSelector));return c}function r(c){do{var b=c.prev();if(b.length){for(;(c=b.find("\x3e:last-child")).length;)b=c;c=b}else c=c.parent(),c[0]===f[0]&&(c=(0,e.default)())}while(c.length&&!c.is(a.itemSelector));return c}function n(c){return function A(b){var d=(0,e.default)(a.itemSelector,f),k=d.filter(function(){return(0,e.default)(this).hasClass(a.focusedClass)}),l=!1;if(k.length)var h=
a.adjacentItems?k[c](a.itemSelector):"next"===c?g(k):r(k);else if("next"===c)h=d.first();else if(a.wrapAround)h=d.last();else return;u=!0;if(!h.length){if("next"===c&&a.requestMore&&!m){if(!z){u=!1;if(h=a.requestMore()){z=!0;h.done(function(a){m=a;u||A(b)}).always(function(){u=z=!1});return}m=!0;A(b);return}u=!1;return}if(a.wrapAround)l=!0,h=d["next"===c?"first":"last"]();else{if(a.onFocusLastItem&&"next"===c)a.onFocusLastItem();return}}k.removeClass(a.focusedClass);h.addClass(a.focusedClass);d=h[c]();
l=!l&&d.length?d:h;d=document.activeElement;a.focusIntoView&&d?(k=l.attr("tabindex"),l.attr("tabindex","0"),l.focus(),d.focus(),null==k?l.removeAttr("tabindex"):l.attr("tabindex",k)):h[0].scrollIntoView(!1);q.fire(h,b)}}a=e.default.extend({},y.defaults,a);var f=(0,e.default)(d),p=e.default.Callbacks(),q=e.default.Callbacks();a.onSelect&&p.add(a.onSelect);a.onFocus&&q.add(a.onFocus);var m=!1,z=!1,u=!1,w={};d=w[v.default.keyCode.UP]=n("prev");var x=w[v.default.keyCode.DOWN]=n("next");w[v.default.keyCode.ENTER]=
function(c){var b=(0,e.default)(a.itemSelector,f).filter(function(){return(0,e.default)(this).hasClass(a.focusedClass)});b.length&&p.fire(b,c)};b=new t(b,w);b.setListElement=function(a){f=(0,e.default)(a)};b.blur=function(){(0,e.default)(a.itemSelector,f).removeClass(a.focusedClass)};b.focus=function(){q.add.apply(q,arguments);return this};b.select=function(){p.add.apply(p,arguments);return this};b.moveToNext=x;b.moveToPrev=d;return b}Object.defineProperty(r,"__esModule",{value:!0});var v=babelHelpers.interopRequireDefault(B),
e=babelHelpers.interopRequireDefault(C);m.defaults={focusedClass:"item-focused",wrapAround:!0};y.defaults={itemSelector:"li",focusedClass:"item-focused",wrapAround:!1,adjacentItems:!0,requestMore:void 0,onFocus:void 0,onSelect:void 0};r.default={KeyboardController:t,TabKeyboardController:m,ListKeyboardController:y};x.exports=r["default"]});