define("bitbucket/internal/widget/client-file-handlers/client-file-handler",["module","exports","jquery","lodash","bitbucket/internal/util/events"],function(g,e,h,k,l){function b(a){return this.init(a)}Object.defineProperty(e,"__esModule",{value:!0});var f=babelHelpers.interopRequireDefault(h),d=babelHelpers.interopRequireDefault(k);babelHelpers.interopRequireDefault(l).default.addLocalEventMixin(b.prototype);b.typeFilters={all:/.*/,application:/^application\/.*/i,audio:/^audio\/.*/i,image:/^image\/.*/i,
imageWeb:/^image\/(jpeg|png|gif)$/i,text:/^text\/.*/i,video:/^video\/.*/i};b.prototype.defaults={fileTypeFilter:b.typeFilters.all,fileCountLimit:Infinity,fileSizeLimit:10485760,onSuccess:f.default.noop,onError:f.default.noop};b.prototype.init=function(a){this.options=f.default.extend({},this.defaults,a);a&&!a.fileSizeLimit&&(this.options.fileSizeLimit=this.defaults.fileSizeLimit);a&&!a.fileCountLimit&&(this.options.fileCountLimit=this.defaults.fileCountLimit);d.default.bindAll(this,"handleFiles",
"filterFiles");return this};b.prototype.handleFiles=function(a){this.trigger("filesSelected",a);a=this.filterFiles(a);0<a.valid.length?(d.default.isFunction(this.options.onSuccess)&&this.options.onSuccess(a.valid),this.trigger("validFiles",a.valid)):d.default.isFunction(this.options.onError)&&this.options.onError(a.invalid);d.default.keys(a.invalid).length&&this.trigger("invalidFiles",a.invalid)};b.prototype.filterFiles=function(a){var b=d.default.isRegExp(this.options.fileTypeFilter)?this.options.fileTypeFilter:
this.defaults.fileTypeFilter,e=this.options.fileSizeLimit;a=d.default.reduce(a,function(a,c){b.test(c.type)?c.size>e?a.invalid.bySize=a.invalid.bySize?a.invalid.bySize.concat(c):[c]:a.valid.push(c):a.invalid.byType=a.invalid.byType?a.invalid.byType.concat(c):[c];return a},{valid:[],invalid:{}});a.valid.length>this.options.fileCountLimit&&(a.invalid.byCount=a.valid.slice(this.options.fileCountLimit),a.valid=a.valid.slice(0,this.options.fileCountLimit));return a};e.default=b;g.exports=e["default"]});