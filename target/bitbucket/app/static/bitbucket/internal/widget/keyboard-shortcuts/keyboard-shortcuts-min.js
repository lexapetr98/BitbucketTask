define("bitbucket/internal/widget/keyboard-shortcuts/keyboard-shortcuts","module exports @atlassian/aui jquery lodash bitbucket/internal/util/events bitbucket/internal/util/navigator".split(" "),function(q,l,r,t,u,v,w){function c(){if(!(this instanceof c))return new c;this._enabledContexts=[]}function m(a,b){a=g.default.extend({},a);a.keys=d.default.map(a.keys,function(a){return d.default.map(a,function(a){if(d.default.every(["key","modifiers"],d.default.partial(d.default.has,a)))return a;var f=1<
a.length?a.split("+"):a;return d.default.isArray(f)&&1!==f.length?{key:f.pop(),modifiers:b&&!1===b.convertOSModifier?f:d.default.map(f,c.convertOSModifier)}:a})});a.displayContext||(a.displayContext=c._contextDisplayInfo[a.context]?c._contextDisplayInfo[a.context].displayName:a.context.replace(/\b[a-z]/g,function(a){return a.toUpperCase()}));h[a.displayContext]||(h[a.displayContext]=[]);h[a.displayContext].push(a)}function n(a,b){p.default.trigger("bitbucket.internal.ui.keyboard.shortcutClicked",
null,{context:a,keyEventName:b})}Object.defineProperty(l,"__esModule",{value:!0});var b=babelHelpers.interopRequireDefault(r),g=babelHelpers.interopRequireDefault(t),d=babelHelpers.interopRequireDefault(u),p=babelHelpers.interopRequireDefault(v),x=/^[cC]trl$/i,k,h={};c.prototype._setRegistry=function(a){this._registry=a};c.prototype._initContent=function(){this._dialog=b.default.dialog2(aui.dialog.dialog2({titleText:b.default.I18n.getText("bitbucket.web.keyboardshortcut.header"),content:bitbucket.internal.widget.keyboardShortcutsContent({contextNames:d.default.keys(h),
contexts:d.default.values(h)}),size:"large",id:"keyboard-shortcut-dialog"}))};c.prototype._bind=function(a){this._$trigger=a;var b=this;this._$trigger.on("click",function(a){a.preventDefault();b._show()})};c.prototype.enableContext=function(a){-1===g.default.inArray(a,this._enabledContexts)&&(k=a,this._registry.enableContext(a),k=void 0,this._enabledContexts.push(a))};c.prototype.resetContexts=function(){b.default.trigger("remove-bindings.keyboardshortcuts");this._enabledContexts=[];b.default.trigger("add-bindings.keyboardshortcuts")};
c.prototype._show=function(){this._hasShown||(this._initContent(),this._hasShown=!0);this._dialog.show()};c.prototype.addCustomShortcut=function(a,b,c,d){m({keys:b,context:a,displayContext:d,description:c},{convertOSModifier:!1})};c.convertOSModifier=function(a){return(0,w.isMac)()?a.replace(x,"\u2318"):a};c.internalizeShortcuts=function(a){d.default.forEach(a,m)};c._contextDisplayInfo={repository:{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.repository")},"branch-compare":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.branch-compare")},
"branch-list":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.branch-list")},commit:{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.commit")},commits:{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.commits")},"diff-tree":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.diff-tree")},"diff-view":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.diff-view")},filebrowser:{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.filebrowser")},
global:{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.global")},"pull-request":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.pull-request")},"pull-request-list":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.pull-request-list")},"pull-request-overview":{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.pull-request")},sourceview:{displayName:b.default.I18n.getText("bitbucket.web.keyboardshortcut.context.sourceview")}};
var e=new c;l.default={onReady:function(){e._bind((0,g.default)(".keyboard-shortcut-link"));var a=g.default.Deferred();(0,g.default)(document).ready(function(){setTimeout(function(){a.resolve()},0)});b.default.bind("register-contexts.keyboardshortcuts",function(b,c){e._setRegistry(c.shortcutRegistry);e.enableContext("global");a.done(function(){p.default.trigger("bitbucket.internal.widget.keyboard-shortcuts.register-contexts",e,e)})});b.default.bind("shortcuts-loaded.keyboardshortcuts",function(a,
b){c.internalizeShortcuts(b.shortcuts)});b.default.params["keyboardshortcut-hash"]="bundled";b.default.trigger("initialize.keyboardshortcuts");require("bitbucket/internal/util/shortcuts",null).bind("keyboardShortcutsDialog",e._show.bind(e))},addTooltip:function(a,f){f=d.default.chain(f).split("+").map(c.convertOSModifier).map(function(a){return"shift"===a?b.default.I18n.getText("bitbucket.web.keyboardshortcut.key.shift"):"ctrl"===a?c.convertOSModifier(b.default.I18n.getText("bitbucket.web.keyboardshortcut.key.ctrl")):
a}).value().join(" + ");var e=a.attr("title");a.attr("title",e+b.default.I18n.getText("bitbucket.web.keyboardshortcut.type",f));return{remove:function(){a.attr("title",e)}}},bindKeyboardShortcutAnalytics:function(a,b){b.onValue(n.bind(null,k,a))},getEnablingContext:function(){return k},showDialog:function(){e&&e._show()},resetContexts:function(){e.resetContexts()},fireKeyboardShocutAnalyticsEvent:n};q.exports=l["default"]});