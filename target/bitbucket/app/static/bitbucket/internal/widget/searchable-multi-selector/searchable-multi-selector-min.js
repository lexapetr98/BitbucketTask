define("bitbucket/internal/widget/searchable-multi-selector/searchable-multi-selector","module exports @atlassian/aui jquery lodash bitbucket/internal/util/ajax bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/util/promise".split(" "),function(m,f,k,n,p,q,r,t,u){function l(a,b){this._$field=a;a=b=this._options=g.default.extend(!0,{},this.defaults,b);if(!a.dataSource)if(a.url)a.dataSource=new e(a.url,a.urlParams,a.filterParamName);else throw Error("either a dataSource or url must be supplied");
a.dataSource=new v(a.dataSource,a.debounceInterval);if(!d.default.isFunction(b.selectionTemplate))throw Error("a selectionTemplate must be a function");if(!d.default.isFunction(b.resultTemplate))throw Error("a resultTemplate must be a function");this._selectedItems=[];this._initialItems=[];this._excludedIds=d.default.map(b.excludedItems,b.generateId);w(this);this.setSelectedItems(b.initialItems.slice(0))}function e(a,b,c){this._url=a;this._urlParams=b;this._filterParamName=c||"filter";this.clear();
this._pageReceived=d.default.bind(this._pageReceived,this)}function v(a,b){this.clear=d.default.bind(a.clear,a);this.nextPage=x.default.delay(d.default.bind(a.nextPage,a),b)}function y(a){var b=(0,g.default)(".select2-drop-active \x3e .select2-results");b.length&&0===b.children(".select2-result-selectable").length&&b.children(".select2-disabled").length&&(0,g.default)('\x3cli class\x3d"select2-no-results"\x3e\x3c/li\x3e').html(a._options.noMatchesTemplate()).appendTo(b)}function z(a,b){return{id:a.generateId(b),
text:a.generateText(b),item:b}}function A(a,b){return d.default.reject(a,function(a){return a.id===b.id})}function B(a){a&&a.abort&&a.abort()}function w(a){var b=a._options,c=a._$field,e=a._excludedIds,f=d.default.bind(z,null,b),h=[];c.auiSelect2({hasAvatar:b.hasAvatar,query:function(a){1>=a.page&&(b.dataSource.clear(),d.default.forEach(h,B),h=[]);var C=b.prepareSearchTerm(g.default.trim(a.term)),c=b.dataSource.nextPage(C);c=c.then(function(a){return{results:d.default.chain(a.values).map(f).filter(function(a){return!d.default.includes(e,
a.id)}).value(),more:!a.isLastPage}}).promise(c);h.push(c);c.always(function(){h=d.default.reject(h,D.default.eq(c))}).done(a.callback)},formatSelection:function(a){return b.selectionTemplate(a.item)},formatResult:function(a){return b.resultTemplate(a.item)},initSelection:function(b,c){b=d.default.map(a._initialItems,f);a._selectedItems=b;c(b)},separator:b.separator,multiple:!0,minimumInputLength:b.minimumInputLength,formatInputTooShort:b.inputTooShortTemplate,formatNoMatches:b.noMatchesTemplate,
formatSearching:b.searchingTemplate,containerCssClass:["searchable-multi-selector",b.extraClasses].join(" "),dropdownCssClass:["searchable-multi-selector-dropdown",b.dropdownClasses].join(" "),openOnEnter:!1}).on("change",function(b){b.removed&&(a._selectedItems=A(a._selectedItems,b.removed));b.added&&a._selectedItems.push(b.added);a.trigger("change")}).on("open",d.default.bind(y,null,this))}Object.defineProperty(f,"__esModule",{value:!0});var c=babelHelpers.interopRequireDefault(k),g=babelHelpers.interopRequireDefault(n),
d=babelHelpers.interopRequireDefault(p),E=babelHelpers.interopRequireDefault(q);k=babelHelpers.interopRequireDefault(r);var D=babelHelpers.interopRequireDefault(t),x=babelHelpers.interopRequireDefault(u);g.default.extend(!0,l.prototype,k.default.createEventMixin("bitbucket.internal.widget.searchable.multi.selector"),{defaults:{minimumInputLength:2,extraClasses:null,dropdownClasses:null,debounceInterval:300,initialItems:[],excludedItems:[],filterParamName:"filter",separator:"|!|",urlParams:{},hasAvatar:!1,
inputTooShortTemplate:function(){return c.default.escapeHtml(c.default.I18n.getText("bitbucket.web.multi.selector.help"))},noMatchesTemplate:function(){return c.default.escapeHtml(c.default.I18n.getText("bitbucket.web.multi.selector.no.match"))},searchingTemplate:function(){return c.default.escapeHtml(c.default.I18n.getText("bitbucket.web.multi.selector.searching"))},generateId:function(a){return a.id||a.name},generateText:function(a){return a.displayName||a.name},prepareSearchTerm:d.default.identity},
getSelectedItems:function(){return d.default.map(this._selectedItems,"item")},setSelectedItems:function(a){this._initialItems=a.slice(0);this._$field.auiSelect2("val",d.default.map(a,this._options.generateId))},clearSelectedItems:function(){this.setSelectedItems([])}});e.prototype.clear=function(){this._nextPageStart=0};e.prototype.nextPage=function(a){a=babelHelpers.defineProperty({start:this._nextPageStart},this._filterParamName,a);return E.default.rest({url:d.default.isFunction(this._url)?this._url():
this._url,data:babelHelpers.extends({},this._urlParams,a)}).done(this._pageReceived)};e.prototype._pageReceived=function(a){this._nextPageStart=a.nextPageStart||a.start+a.size};l.PagedDataSource=e;f.default=l;m.exports=f["default"]});