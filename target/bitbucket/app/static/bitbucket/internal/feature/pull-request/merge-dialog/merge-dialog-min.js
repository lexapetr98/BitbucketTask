define("bitbucket/internal/feature/pull-request/merge-dialog/merge-dialog","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/bbui/aui-react/avatar bitbucket/internal/model/page-state bitbucket/internal/util/ajax bitbucket/internal/util/events bitbucket/internal/util/set-dialog-buttons-disabled bitbucket/internal/widget/commit-message-editor/commit-message-editor bitbucket/internal/widget/submit-spinner/submit-spinner".split(" "),function(t,m,u,v,w,x,y,z,A,B,
C,D,E){function F(d){var b=n.default.dialog2(bitbucket.internal.feature.pullRequest.merge.dialog(d.dialog));(0,c.default)("body").append(b.$el);var e=void 0,k=void 0,g=void 0;(0,c.default)(document).on("click","#merge-strategy-opts aui-item-link",function(a){var f=(0,c.default)(a.currentTarget);g=f.data("strategy");b.$el.find("#merge-strategy-button").text(f.find(".strategy-name").text());a.preventDefault()});(0,c.default)("#merge-strategy-opts").on("aui-dropdown2-show",function(a){setTimeout(function(){var f=
(0,c.default)(a.target).find('div[role\x3d"group"]'),b=f.find("aui-item-link a").last(),d=(0,c.default)(window);b.offset().top+b.outerHeight()<d.scrollTop()+d.height()||f.css({"overflow-y":"scroll","max-height":(0,c.default)(window).height()-f.offset().top-10})},0)});b.$el.find(".confirm-button").on("click",function(a){a=(0,c.default)("#merge-strategy-button").length?(0,c.default)("#merge-strategy-button"):a.target;var f=new G.default(a,"before");a=p.default.rest().currentPullRequest().merge().withParams({avatarSize:y.AvatarSize.XSMALL,
version:h.default.getPullRequest().getVersion()}).build();(0,q.default)(b,!0);f.show();a=e=r.default.rest(babelHelpers.extends({},d.ajax,{url:a,type:"POST",data:{autoSubject:!1,message:b.$el.find("#commit-message").val().trim(),strategyId:g}}));e.always(function(){e=null;f.hide();(0,q.default)(b,!1)});if(!k)try{k=require("bitbucket/internal/feature/pull-request-cleanup/pull-request-cleanup").getMergePromiseDecorator}catch(H){}k&&(a=k(a,function(){return b.hide()})||a);a.done(function(a){l.default.trigger("bitbucket.internal.feature.pullRequest.merged",
null,{user:h.default.getCurrentUser().toJSON(),pullRequest:a});d.callback(a)})});b.$el.find(".cancel-button").on("click",function(){e&&(e.abort(),e=null);b.hide()});b.on("hide",function(a){a.target===a.currentTarget&&(a=b.$el.find("#commit-message"),a.val(a.attr("data-original-value")))});b.$el.on("click",".view-merge-veto-details-button",function(){b.hide();l.default.trigger("bitbucket.internal.pull-request.show.cant.merge.help")});return b}Object.defineProperty(m,"__esModule",{value:!0});var n=
babelHelpers.interopRequireDefault(u),c=babelHelpers.interopRequireDefault(v),p=babelHelpers.interopRequireDefault(x),h=babelHelpers.interopRequireDefault(z),r=babelHelpers.interopRequireDefault(A),l=babelHelpers.interopRequireDefault(B),q=babelHelpers.interopRequireDefault(C),G=babelHelpers.interopRequireDefault(E),d=void 0;m.default={onMergeClick:function(){d.show();d.$el.find(".confirm-button").focus();(0,D.getCommitMessageEditor)(d.$el.find("#commit-message")[0])},initMergeDialog:function(c){var b=
c.callback,e=c.mergeTimeout;r.default.rest({url:p.default.rest().currentRepo().pullRequestSettings().build(),type:"GET"}).done(function(c){var g=h.default.getPullRequest(),a=c.mergeConfig.strategies.filter(function(a){return a.enabled}).filter(function(a){return a.id!==c.mergeConfig.defaultStrategy.id});a.unshift(c.mergeConfig.defaultStrategy);a={dialog:{person:h.default.getCurrentUser()&&h.default.getCurrentUser().toJSON(),pullRequest:g.toJSON(),mergeStrategies:a,defaultStrategy:c.mergeConfig.defaultStrategy},
ajax:{statusCode:{400:function(a,b,c,e,g){a=d.$el.find(".aui-dialog2-content");e.errors&&(a.children(".aui-message").remove(),a.prepend(bitbucket.internal.feature.pullRequest.merge.errors({errors:e.errors})));return!1},401:function(a,b,c,e,g){d.hide();return babelHelpers.extends({},g,{title:n.default.I18n.getText("bitbucket.web.pullrequest.merge.error.401.title"),message:n.default.I18n.getText("bitbucket.web.pullrequest.merge.error.401.message"),fallbackUrl:!1,shouldReload:!0})},409:function(a,b,
c,e,h){a=(0,w.get)(e,"errors.0",{});b=d.$el.find(".aui-dialog2-content");b.children(".aui-message").remove();if("com.atlassian.bitbucket.pull.PullRequestOutOfDateException"===a.exceptionName)d.hide();else return l.default.trigger("bitbucket.internal.pull-request.cant.merge",null,g,a.conflicted||a.isConflicted,a.vetoes),b.prepend(bitbucket.internal.feature.pullRequest.merge.errors({errors:e.errors})),"false"!==d.$el.attr("aria-hidden")&&l.default.trigger("bitbucket.internal.pull-request.show.cant.merge.help"),
!1},"*":function(){d.hide()}},timeout:1E3*e},callback:function(a){b(a);d.hide()}};d=F(a)})}};t.exports=m["default"]});