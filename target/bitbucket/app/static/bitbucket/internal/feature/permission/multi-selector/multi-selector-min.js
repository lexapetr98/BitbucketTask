define("bitbucket/internal/feature/permission/multi-selector/multi-selector","module exports @atlassian/aui backbone-brace jquery lodash bitbucket/internal/feature/user/group-multi-selector/group-multi-selector bitbucket/internal/feature/user/user-multi-selector/user-multi-selector".split(" "),function(m,c,f,n,g,p,q,h){Object.defineProperty(c,"__esModule",{value:!0});var k=babelHelpers.interopRequireDefault(f);f=babelHelpers.interopRequireDefault(n);var d=babelHelpers.interopRequireDefault(g),b=babelHelpers.interopRequireDefault(p);
g=babelHelpers.interopRequireDefault(q);var r={user:babelHelpers.interopRequireDefault(h).default,group:g.default};h=f.default.View.extend({events:{"click .add-button":"_onClickAdd"},initialize:function(a){var e=this.$el.find(".permission-multi-selector");this._$addButton=this.$el.find(".add-button");var l=r[a.entityType];if(!l)throw Error("Unknown entity type: "+a.entityType);this._delegate=new l(e,{dataSource:a.dataSource});if(!b.default.isFunction(a.add))throw Error("must provide an add function");
a=this.$el.find(".permission-type-dropdown");a.on("click","a",b.default.bind(this._onSelectPermission,this));this._permission=a.find("li:first-child").attr("data-value");this._delegate.on("change",b.default.bind(this._onChangeEntitySelection,this));this._onChangeEntitySelection();this.$el.on("keydown",b.default.bind(function(a){a.which===k.default.keyCode.ENTER&&"INPUT"===a.target.tagName&&this.getSelected().length&&(a.preventDefault(),this._addSelected())},this))},getSelected:function(){return this._delegate.getSelectedItems()},
getPermission:function(){return this._permission},showError:function(a){this.clearError();var e=this._$errors=(0,d.default)("\x3cdiv\x3e\x3c/div\x3e");a=b.default.get(a,"errors.length")?a.errors:[{message:k.default.I18n.getText("bitbucket.web.permission.multiselector.unexpected.error")}];b.default.forEach(a,function(a){(0,d.default)('\x3cp class\x3d"error-message"\x3e\x3c/p\x3e').text(a.message).appendTo(e)});e.appendTo(this.$el.children("th"))},clearError:function(){this._$errors&&(this._$errors.remove(),
this._$errors=null)},clear:function(){this.clearError();this._delegate.clearSelectedItems();this._setAddButtonDisabled(!0)},_addSelected:function(){this._setAddButtonDisabled(!0);d.default.when(this.options.add({entities:this.getSelected(),permission:this.getPermission()})).always(b.default.bind(this._setAddButtonDisabled,this,!1)).done(b.default.bind(this.clear,this)).fail(b.default.bind(function(a,b,d,c){this.showError(c)},this))},_setAddButtonDisabled:function(a){this._$addButton.toggleClass("disabled",
a).prop("disabled",a)},_onClickAdd:function(a){a.preventDefault();this._addSelected()},_onSelectPermission:function(a){a.preventDefault();a=(0,d.default)(a.target);this._permission=a.closest("li").attr("data-value");this.$el.find(".permission-type-trigger").text(a.text())},_onChangeEntitySelection:function(){this._setAddButtonDisabled(!this.getSelected().length)}});c.default=h;m.exports=c["default"]});