define("bitbucket/internal/feature/tasks/tasks-overview/tasks-counter","module exports baconjs jquery lodash bitbucket/internal/feature/tasks/model/task-state bitbucket/internal/util/bacon bitbucket/internal/util/function".split(" "),function(h,e,k,l,m,n,p,q){function c(){this.init.apply(this,arguments)}Object.defineProperty(e,"__esModule",{value:!0});var r=babelHelpers.interopRequireDefault(k),t=babelHelpers.interopRequireDefault(l),f=babelHelpers.interopRequireDefault(m),d=babelHelpers.interopRequireDefault(n),
g=babelHelpers.interopRequireDefault(p),u=babelHelpers.interopRequireDefault(q);c.prototype.init=function(){var b=this;this._destroyCallbacks=[];f.default.bindAll(this,"_mapEventData");this._taskCounterStream=r.default.mergeAll(f.default.map(["created","resolved","reopened","deleted","failed-transition"],function(a){return g.default.events("bitbucket.internal.feature.pull-request-tasks."+a).map(b._mapEventData)})).merge(g.default.events("bitbucket.internal.feature.pull-request-tasks.set-counts"))};
c.prototype.emptyCounter=function(b){return{openTaskCount:0,resolvedTaskCount:0,pullRequestId:b&&b.pullRequestId||null,repositoryId:b&&b.repositoryId||null}};c.prototype._mapEventData=function(b){var a=this.emptyCounter(b.task);switch(b.task.state){case d.default.OPEN:a.openTaskCount=1;break;case d.default.RESOLVED:a.resolvedTaskCount=1}switch(b.task.lastState){case d.default.OPEN:a.openTaskCount=-1;break;case d.default.RESOLVED:a.resolvedTaskCount=-1}return a};c.prototype.countPropertyForPullRequest=
function(b,a){var c=this;a=this._taskCounterStream.merge(a).filter(function(a){return a.pullRequestId===b.pullRequestId&&a.repositoryId===b.repositoryId}).scan(this.emptyCounter(b),function(a,b){b.isReset&&(a=c.emptyCounter(b));a.openTaskCount+=b.openTaskCount;a.resolvedTaskCount+=b.resolvedTaskCount;return a});this._destroyCallbacks.push(a.onValue(t.default.noop));return a};c.prototype.destroy=function(){u.default.applyAll(this._destroyCallbacks)};e.default=c;h.exports=e["default"]});