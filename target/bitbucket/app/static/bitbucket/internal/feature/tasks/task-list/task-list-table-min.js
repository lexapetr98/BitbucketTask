define("bitbucket/internal/feature/tasks/task-list/task-list-table","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/tasks/model/task bitbucket/internal/feature/tasks/model/task-state bitbucket/internal/feature/tasks/task-list/task-list-row-view bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/widget/paged-table/paged-table".split(" "),function(q,h,r,t,u,v,w,x,y,z,A,B){function a(b,a,c,f){var e=this;this._scrollable=
(0,m.default)(a);this.$target=(0,m.default)(b);this.collection=c;this.context=f;this._destroyables=[];this._resolvedHeaderOutput=!1;d.default.bindAll(this,"_onTaskDestroy","_handleEdit","_handleMoveNext","_handleMovePrevious","_handleOpen","_handleTransitionToNextState","_handleDelete");this.collection.on("destroy",this._onTaskDestroy);this._taskRowViews=[];g.default.call(this,{target:this.$target,noneFoundMessageHtml:bitbucket.internal.feature.tasks.taskList.dialogEmptyMessage,scrollPaneSelector:a,
rowSelector:"\x3e li",taskContainerSelector:".task-container",paginationContext:"task-list",focusOptions:{rowSelector:"\x3e li",focusedClass:"focused"},statusCode:{"*":function(b,a,c,f,d){return"timeout"===c||500<=b.status&&599>=b.status?(bitbucket.internal.widget.paragraph({text:d.message}),e._addNoRowsMessage(d.message),!1):!0}}});this.prNavBuilder=n.default.project(f.projectKey).repo(f.repository).pullRequest(f.pullRequestId);this.bindNavigationHandlers()}Object.defineProperty(h,"__esModule",{value:!0});
var C=babelHelpers.interopRequireDefault(r),m=babelHelpers.interopRequireDefault(t),d=babelHelpers.interopRequireDefault(u),n=babelHelpers.interopRequireDefault(v),D=babelHelpers.interopRequireDefault(w),k=babelHelpers.interopRequireDefault(x),E=babelHelpers.interopRequireDefault(y),p=babelHelpers.interopRequireDefault(z),l=babelHelpers.interopRequireDefault(A),g=babelHelpers.interopRequireDefault(B);d.default.assign(a.prototype,g.default.prototype);p.default.addLocalEventMixin(a.prototype);a.prototype._addNoRowsMessage=
function(b){this.$table.addClass("no-rows").after(this._new$Message(b||this.options.noneFoundMessageHtml()))};a.prototype.update=function(b){this._resolvedHeaderOutput=!1;d.default.invokeMap(this._taskRowViews,"remove");this._taskRowViews=[];g.default.prototype.update.call(this,b).done(this.trigger.bind(this,"dataLoaded"))};a.prototype.buildUrl=function(b,a){return n.default.rest().project(this.context.projectKey).repo(this.context.repository).pullRequest(this.context.pullRequestId).addPathComponents("tasks").withParams({start:b,
limit:a,withComments:!0}).build()};a.prototype.handleNewRows=function(b,a){var c=this,e=[];d.default.forEach(b.values,function(b){var a=c.collection.get(b.id);a?a.set(b):(a=new D.default(b),a.setPullRequestId(c.context.pullRequestId),c.collection.add(a));b=new E.default({prNavBuilder:c.prNavBuilder,model:a});c._taskRowViews.push(b);a.getState()!==k.default.RESOLVED||c._resolvedHeaderOutput||(a=bitbucket.internal.feature.tasks.taskList.dialogContentSection({title:C.default.I18n.getText("bitbucket.web.tasks.dialog.resolved.subtitle")}),
e.push(a),c._resolvedHeaderOutput=!0);e.push(b.render().$el)});c.$table.show()["html"!==a?a:"append"](e)};a.prototype.bindNavigationHandlers=function(){this._destroyables.push(p.default.chain().on("bitbucket.internal.feature.tasks.dialog.action.edit",this._handleEdit).on("bitbucket.internal.feature.tasks.dialog.action.moveNext",this._handleMoveNext).on("bitbucket.internal.feature.tasks.dialog.action.movePrevious",this._handleMovePrevious).on("bitbucket.internal.feature.tasks.dialog.action.open",this._handleOpen).on("bitbucket.internal.feature.tasks.dialog.action.transitionToNextState",
this._handleTransitionToNextState).on("bitbucket.internal.feature.tasks.dialog.action.delete",this._handleDelete));this._destroyables.push(g.default.prototype.initShortcuts.call(this))};a.prototype.destroy=function(){g.default.prototype.destroy.call(this);d.default.invokeMap(this._destroyables,"destroy")};a.prototype.getTaskListRowViewForTask=function(b){var a=this._taskRowViews.filter(function(a){return a.model.getId()===b.getId()});return a&&a[0]};a.prototype.focusInitialRow=function(){this._$focusedRow=
this.$target.find(this.options.focusOptions.rowSelector+this.options.taskContainerSelector).first().addClass(this.options.focusOptions.focusedClass)};a.prototype.scrollToRow=function(a){var b=this._scrollable.offset().top,c=this._scrollable.scrollTop();a=a.offset().top;this._scrollable.scrollTop(a-b+c)};a.prototype._handleMoveNext=function(){this._focusRow("nextAll")};a.prototype._handleMovePrevious=function(){this._focusRow("prevAll")};a.prototype._focusRow=function(a,d){a=this._$focusedRow[a](this.options.taskContainerSelector);
a.length&&(this._$focusedRow.removeClass(this.options.focusOptions.focusedClass),this._$focusedRow=a.first().addClass(this.options.focusOptions.focusedClass),d||this.scrollToRow(this._$focusedRow))};a.prototype._handleOpen=function(){this._$focusedRow.find(".task-link-button").trigger("click")};a.prototype._handleEdit=function(){this.getTaskListRowViewForTask(this.getTaskFromFocusedRow()).setCollapsed(!1);this._$focusedRow.find(".task-edit").trigger("click")};a.prototype._handleTransitionToNextState=
function(){var a=this.getTaskFromFocusedRow();a&&a.transitionToNextState()};a.prototype._handleDelete=function(){this._$focusedRow.find(".task-delete").trigger("click")};a.prototype.getTaskFromFocusedRow=function(){var a=this._$focusedRow.find(".task").data("task-id");return a&&this.collection.get(a)};a.prototype._onTaskDestroy=function(a){var b=d.default.find(this._taskRowViews,l.default.dotEq("model",a));if(b){var c=this._$focusedRow.is(this.options.taskContainerSelector+":last")?"prevAll":"nextAll";
this._focusRow(c,!0);b.remove();this._taskRowViews=d.default.without(this._taskRowViews,b);a.getLastState()===k.default.RESOLVED&&(a=d.default.flow(l.default.invoke("model.getState"),l.default.eq(k.default.RESOLVED)),this._taskRowViews.some(a)||(this._resolvedHeaderOutput=!1,this.$table.find(".section-heading").remove()));0===this._taskRowViews.length&&this._addNoRowsMessage()}};h.default=a;q.exports=h["default"]});