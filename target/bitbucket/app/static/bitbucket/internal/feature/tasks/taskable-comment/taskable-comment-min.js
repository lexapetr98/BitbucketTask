define("bitbucket/internal/feature/tasks/taskable-comment/taskable-comment","module exports jquery lodash bitbucket/util/events bitbucket/util/state bitbucket/internal/feature/comments/comment-async-web-panel bitbucket/internal/feature/comments/utils bitbucket/internal/feature/tasks/model/task bitbucket/internal/feature/tasks/model/task-collection bitbucket/internal/feature/tasks/task-list/comment-task-list-view".split(" "),function(n,g,e,p,q,r,t,u,v,w,x){Object.defineProperty(g,"__esModule",{value:!0});
var h=babelHelpers.interopRequireDefault(e),l=babelHelpers.interopRequireDefault(p);e=babelHelpers.interopRequireDefault(q);var f=babelHelpers.interopRequireDefault(r),y=babelHelpers.interopRequireDefault(t),z=babelHelpers.interopRequireDefault(v),m=babelHelpers.interopRequireDefault(w),A=babelHelpers.interopRequireDefault(x),d=m.default.getCollection(),k={};e.default.on("bitbucket.internal.feature.tasks.createTask",function(a){var b=(0,h.default)(a).data("id");a=(0,u.getCommentSelection)(a.length?
a.get(0):a);var c=k[b];(b=c.createTask(a))?d.add(b):a&&(b=c.getCurrentTask(),c=(c=c.getCurrentTaskText())?c.trim()+" ":"",b.setText(c+a))});e.default.on("bitbucket.internal.feature.comments.commentDeleted",function(a){var b=d.find(function(c){return c.getAnchor().id===a.id});b&&d.remove(b)});e.default.on("bitbucket.internal.comment.commentContainerDestroyed",function(a){var b=a.find(".task").map(function(c,a){return+a.dataset.commentId});d.filter(function(a){return l.default.includes(b,a.getAnchor().id)&&
a.isNew()}).forEach(function(a){return a.destroy()})});g.default={_commentTaskListViews:k,newTaskableCommentView:function(a){var b=a.comment,c=new m.default;l.default.forEach(b.tasks,function(a){var b=d.get(a.id);b||(b=new z.default(a),b.setPullRequestId(f.default.getPullRequest().id),b.setRepositoryId(f.default.getRepository().id),d.add(b));c.add(b)});return y.default.getWebPanelEl(function(a){var d=(0,h.default)(bitbucket.internal.feature.tasks.taskableComment.taskListPlaceholder());a.replaceWith(d);
a=(0,h.default)(d);a=new A.default({collection:c,el:a,comment:b,pullRequestId:f.default.getPullRequest().id,repositoryId:f.default.getRepository().id});a.render();k[b.id]=a})},isPullRequest:function(a){return!!a.pullRequest}};n.exports=g["default"]});