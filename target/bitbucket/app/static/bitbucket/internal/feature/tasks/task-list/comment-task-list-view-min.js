define("bitbucket/internal/feature/tasks/task-list/comment-task-list-view","module exports backbone lodash bitbucket/internal/feature/tasks/model/task bitbucket/internal/feature/tasks/task-list/task-list-row-view bitbucket/internal/feature/tasks/task-view/task-view bitbucket/internal/util/events bitbucket/internal/util/feature-detect bitbucket/internal/util/function".split(" "),function(n,e,f,d,p,q,r,t,u,v){Object.defineProperty(e,"__esModule",{value:!0});f=babelHelpers.interopRequireDefault(f);var h=
babelHelpers.interopRequireDefault(d),k=babelHelpers.interopRequireDefault(p),w=babelHelpers.interopRequireDefault(q),l=babelHelpers.interopRequireDefault(r),x=babelHelpers.interopRequireDefault(t),m=babelHelpers.interopRequireDefault(u),y=babelHelpers.interopRequireDefault(v);d=f.default.View.extend({defaults:{pullRequestId:null},initialize:function(a){var b=this;this.comment=a.comment;["add","remove"].forEach(function(a){b.listenTo(b.collection,a,b.render.bind(b,a))});this.options=h.default.assign({},
this.defaults,a);this.taskRowViews=[]},getCurrentTask:function(){return this.collection.find(y.default.invoke("isNew"))},getCurrentTaskText:function(){return this.getCurrentTaskRowView().getEditorText()||""},getCurrentTaskRowView:function(){return this._findRowViewForTask(this.getCurrentTask())},createTask:function(a){var b=this.getCurrentTaskRowView();if(b)return b.focusEditor(),null;b=new k.default({anchor:{id:this.comment.id,type:k.default.Anchor.COMMENT},pullRequestId:this.options.pullRequestId,
repositoryId:this.options.repositoryId,text:a});this.collection.unshift(b);a&&(b.prefilled=!0,b.save().fail(this.collection.remove.bind(this.collection,b)));return b},render:function(a,b,c,g){function e(a){return new w.default({model:a,initialTaskViewMode:a.isNew()&&""===a.getText()?l.default.Mode.EDIT:l.default.Mode.VIEW,isCollapsible:!1,showLink:!1})}function f(a){d.$el.removeClass("transition-height").css({height:"auto"});a&&x.default.trigger("bitbucket.internal.webpanel.resize",null,{location:"bitbucket.comments.extra",
el:d.$el.get(0)})}var d=this;this.$(".pending-delete").removeClass("pending-delete");c=this.$el.outerHeight(!0);this.$el.css({height:c});c=!1;switch(a){case "remove":if(a=this._findRowViewForTask(b))a.$el.addClass("pending-delete").trigger("comment-child-removed"),a.remove(),this.taskRowViews=h.default.without(this.taskRowViews,a);c=!0;break;case "add":c=g.at;a=e(b);this.taskRowViews.splice(c,0,a);g=a.render().$el;c=this.$(this.$("li").get(c));c.length?c.before(g):this.$el.append(g);b.isNew()&&""!==
b.getText()&&a.highlight();g.trigger("comment-child-added");c=!0;break;default:h.default.invokeMap(this.taskRowViews,"remove"),this.taskRowViews=this.collection.map(e),this.$el.append(this.taskRowViews.map(function(a){return a.render().$el}))}b=this.taskRowViews.reduce(function(a,b){return a+b.$el.outerHeight(!0)},0);if(m.default.cssTransition()&&c)this.$el.addClass("transition-height").css({height:b}).one(m.default.transitionEndEventName(),f.bind(d,!0));else f(!1);return this},_findRowViewForTask:function(a){return h.default.find(this.taskRowViews,
{model:a})}});e.default=d;n.exports=e["default"]});