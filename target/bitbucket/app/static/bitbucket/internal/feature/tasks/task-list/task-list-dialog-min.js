define("bitbucket/internal/feature/tasks/task-list/task-list-dialog","module exports @atlassian/aui jquery lodash bitbucket/util/events bitbucket/util/navbuilder bitbucket/util/server bitbucket/internal/feature/tasks/model/task-state bitbucket/internal/feature/tasks/task-list/task-list-table".split(" "),function(m,f,g,n,p,q,r,t,u,v){function a(b){this.init.apply(this,arguments)}function k(b){var d={E:"bitbucket.internal.feature.tasks.dialog.action.edit",J:"bitbucket.internal.feature.tasks.dialog.action.moveNext",
K:"bitbucket.internal.feature.tasks.dialog.action.movePrevious",O:"bitbucket.internal.feature.tasks.dialog.action.open",SPACE:"bitbucket.internal.feature.tasks.dialog.action.transitionToNextState",DELETE:"bitbucket.internal.feature.tasks.dialog.action.delete"},c={69:"E",74:"J",75:"K",79:"O",32:"SPACE",46:"DELETE"}[b.keyCode];"TEXTAREA"!==b.target.nodeName&&c&&(h.default.trigger(d[c]),b.preventDefault())}Object.defineProperty(f,"__esModule",{value:!0});var w=babelHelpers.interopRequireDefault(g),e=
babelHelpers.interopRequireDefault(n),x=babelHelpers.interopRequireDefault(p),h=babelHelpers.interopRequireDefault(q);g=babelHelpers.interopRequireDefault(r);var y=babelHelpers.interopRequireDefault(t),l=babelHelpers.interopRequireDefault(u),z=babelHelpers.interopRequireDefault(v),A=g.default.rest().currentPullRequest().addPathComponents("tasks","count").build();a.prototype.init=function(b){x.default.bindAll(this,"openDialog","updateDialog","closeDialog","_updateTaskCounts");var d=bitbucket.internal.feature.tasks.taskList.dialog(),
c=(0,e.default)("#task-list-dialog");0<c.length&&c.remove();(0,e.default)(document.body).append(d);this._dialog=w.default.dialog2("#task-list-dialog");this._table=null;this._taskCollection=b;(0,e.default)("#dialog-close-button").click(this.closeDialog);h.default.on("bitbucket.internal.feature.tasks.visit-task",this.closeDialog);this._dialog.on("show",function(){(0,e.default)(document).on("keydown",k)});this._dialog.on("hide",function(){(0,e.default)(document).off("keydown",k)})};a.prototype.updateDialog=
function(){this._table&&this._table.update()};a.prototype.openDialog=function(b){this._dialog.show();if(!this._table){var d=this._dialog.$el.find(".aui-dialog2-content"),c=this._dialog.$el.find("#task-list-dialog-list");this._table=new z.default(c,d,this._taskCollection,b);this._table.on("dataLoaded",this._updateTaskCounts.bind(this,b))}this._table.update()};a.prototype._updateTaskCounts=function(b,d){var c=new e.default.Deferred;if(d.isLastPage){var a=this._taskCollection.groupBy("state");d=a[l.default.OPEN];
a=a[l.default.RESOLVED];c.resolve({open:d?d.length:0,resolved:a?a.length:0})}else c=y.default.rest({url:A});c.done(function(a){h.default.trigger("bitbucket.internal.feature.pull-request-tasks.set-counts",null,{openTaskCount:a.open,resolvedTaskCount:a.resolved,pullRequestId:b.pullRequestId,repositoryId:b.repository.id,isReset:!0})})};a.prototype.closeDialog=function(){this._dialog.hide()};f.default=a;m.exports=f["default"]});