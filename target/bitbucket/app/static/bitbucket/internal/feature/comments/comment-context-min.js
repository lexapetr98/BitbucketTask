define("bitbucket/internal/feature/comments/comment-context","module exports backbone jquery lodash bitbucket/internal/feature/comments/comment-container bitbucket/internal/util/client-storage bitbucket/internal/util/events".split(" "),function(k,e,f,g,l,m,n,p){Object.defineProperty(e,"__esModule",{value:!0});f=babelHelpers.interopRequireDefault(f);g=babelHelpers.interopRequireDefault(g);var c=babelHelpers.interopRequireDefault(l),q=babelHelpers.interopRequireDefault(m),h=babelHelpers.interopRequireDefault(n),
d=babelHelpers.interopRequireDefault(p);e.default=f.default.View.extend({initialize:function(){this._containers={};this.checkForNewContainers();var a=this;d.default.on("bitbucket.internal.feature.comments.commentAdded",this._commentAddedHandler=function(b,c){a.$el.find(c).length&&1===a.$el.find(".comment").length&&d.default.trigger("bitbucket.internal.feature.comments.firstCommentAdded",null,a.$el)});var b=this.getDrafts()||[];this.unrestoredDrafts=this.drafts=c.default.isArray(b)?b:[b];this.restoreDrafts()},
includesContainer:function(a){return c.default.has(this._containers,a)},registerContainer:function(a,b){var c=b.getId();this.includesContainer(c)||this._registerContainer(c,a,b)},_registerContainer:function(a,b,c){this._containers[a]=new q.default({name:a,context:this,el:b,anchor:c});return this._containers[a]},checkForNewContainers:function(){var a=this;c.default.forEach(this.findContainerElements(),function(b){a.registerContainer(b,a.getAnchor(b))})},findContainerElements:function(){return this.$(".comment-container")},
getAnchor:function(){return this.options.anchor},clarifyAmbiguousDraftProps:function(a){return c.default.omit(a,"text")},deleteDraftComment:function(a,b){b=c.default.isBoolean(b)?b:!0;a=c.default.isEqual.bind(c.default,this.clarifyAmbiguousDraftProps(a));this.drafts=c.default.reject(this.drafts,c.default.flow(this.clarifyAmbiguousDraftProps.bind(this),a));b&&this.saveDraftComments()},getDrafts:function(){return h.default.getSessionItem(this.getDraftsKey())},getDraftsKey:function(){return h.default.buildKey(["draft-comment",
this.options.anchor.getId()],"user")},restoreDrafts:g.default.noop,saveDraftComment:function(a){this.deleteDraftComment(a,!1);a.text&&this.drafts.push(a);this.saveDraftComments()},saveDraftComments:function(){h.default.setSessionItem(this.getDraftsKey(),this.drafts)},destroy:function(a,b){a?(a.remove(),delete this._containers[a.options.name],this.$el.has(".comment").length||b||d.default.trigger("bitbucket.internal.feature.comments.lastCommentDeleted",null,this.$el)):(c.default.invokeMap(this._containers,
"destroy",!0),this._containers=null,this._commentAddedHandler&&(d.default.off("bitbucket.internal.feature.comments.commentAdded",this._commentAddedHandler),delete this._commentAddedHandler))}});k.exports=e["default"]});