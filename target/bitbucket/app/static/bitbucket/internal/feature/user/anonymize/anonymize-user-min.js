define("bitbucket/internal/feature/user/anonymize/anonymize-user","module exports @atlassian/aui jquery lodash react bitbucket/util/navbuilder bitbucket/util/server bitbucket/internal/bbui/aui-react/form bitbucket/internal/bbui/aui-react/spinner bitbucket/internal/util/analytics bitbucket/internal/util/client-storage".split(" "),function(y,n,b,e,J,f,z,A,q,B,C,D){Object.defineProperty(n,"__esModule",{value:!0});var r=babelHelpers.interopRequireDefault(b),t=babelHelpers.interopRequireDefault(e),a=babelHelpers.interopRequireDefault(f),
m=babelHelpers.interopRequireDefault(z),E=babelHelpers.interopRequireDefault(A),u=babelHelpers.interopRequireDefault(B),v=babelHelpers.interopRequireDefault(C),w=babelHelpers.interopRequireDefault(D),G=function(c){var p=c.canSubmit,k=c.errorMessage,l=c.isConfirmed,d=c.onAnonymize,h=c.onBack,F=c.onConfirmedChanged,e=c.onSubmit,g=c.processing;c=c.username;return a.default.createElement(f.Fragment,null,a.default.createElement("section",{className:"anonymize"},k&&a.default.createElement("div",{className:"aui-message aui-message-error"},
a.default.createElement("p",{className:"title"},b.I18n.getText("bitbucket.web.user.anonymize.confirm.error.title",c)),a.default.createElement("p",null,k)),a.default.createElement("div",{className:"anonymize-text-detailed"},a.default.createElement("p",{dangerouslySetInnerHTML:{__html:b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.introduction.html",r.default.escapeHtml(c))}}),a.default.createElement("p",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.anonymized")),
a.default.createElement("ul",null,a.default.createElement("li",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.anonymized.mentions")),a.default.createElement("li",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.anonymized.avatars")),a.default.createElement("li",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.anonymized.project"))),a.default.createElement("p",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.preserved")),
a.default.createElement("ul",null,a.default.createElement("li",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.preserved.comments")),a.default.createElement("li",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.preserved.git")),a.default.createElement("li",null,b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.data.preserved.addons"))),a.default.createElement("p",{dangerouslySetInnerHTML:{__html:b.I18n.getText("bitbucket.web.user.anonymize.confirm.details.username.html",
r.default.escapeHtml(c))}})),a.default.createElement("div",{className:"anonymize-form"},a.default.createElement("form",{className:"aui",onSubmit:e},a.default.createElement(q.Checkbox,{checked:l,disabled:null!=k||g,label:b.I18n.getText("bitbucket.web.user.anonymize.confirm.description"),name:"user-anonymize-confirm",onChange:F}),a.default.createElement("div",{className:"anonymize-buttons"},a.default.createElement("div",{className:"buttons"},g&&a.default.createElement(u.default,null),a.default.createElement("button",
{className:"anonymize-button aui-button aui-button-primary",disabled:!p,onClick:d,type:"button"},b.I18n.getText("bitbucket.web.user.anonymize.anonymize")),a.default.createElement("button",{className:"back-button aui-button aui-button-link",disabled:g,onClick:h,type:"button"},b.I18n.getText("bitbucket.web.user.anonymize.back"))))))))},H=function(c){var p=c.errorMessage,k=c.onContinue,l=c.onSubmit,d=c.onUsernameChanged,h=c.processing;c=c.username;return a.default.createElement(f.Fragment,null,a.default.createElement("section",
{className:"anonymize"},a.default.createElement("p",{className:"anonymize-text"},b.I18n.getText("bitbucket.web.user.anonymize.description")," ",a.default.createElement("a",{className:"aui-button aui-button-link",href:bitbucket_help_url("bitbucket.help.anonymize")},b.I18n.getText("bitbucket.web.user.anonymize.help"))),a.default.createElement("div",{className:"anonymize-form"},a.default.createElement("form",{className:"aui",onSubmit:l},a.default.createElement(q.TextField,{autoComplete:!1,autoFocus:!0,
description:b.I18n.getText("bitbucket.web.user.anonymize.username.description"),errors:[p],name:"username",onChange:function(a){return d(a.target.value)},title:b.I18n.getText("bitbucket.web.user.anonymize.username.title"),value:c?c:""}),a.default.createElement("div",{className:"anonymize-buttons"},a.default.createElement("div",{className:"buttons"},h&&a.default.createElement(u.default,null),a.default.createElement("button",{className:"continue-button aui-button aui-button-primary",disabled:!c||h,
onClick:k,type:"button"},b.I18n.getText("bitbucket.web.user.anonymize.continue")),a.default.createElement("a",{className:"aui-button aui-button-link",href:m.default.admin().users().build()},b.I18n.getText("bitbucket.web.user.anonymize.cancel"))))))))},x=function(a){var c=a.method,b=a.username,l=a.skipErrorDialogOnTimeout;return E.default.rest({url:m.default.rest().admin().users().erasure(b).build(),type:c,statusCode:babelHelpers.extends({0:function(a,c){return l&&"timeout"===c?t.default.Deferred().reject({timeout:!0}):
!0}},I)})};e=function(a,b){return function(){return t.default.Deferred().reject({statusCode:a,message:b})}};var I={401:e(401,b.I18n.getText("bitbucket.web.user.anonymize.validation.error.nopermissions")),404:e(404,b.I18n.getText("bitbucket.web.user.anonymize.validation.error.notexists")),409:e(409,b.I18n.getText("bitbucket.web.user.anonymize.validation.error.notdeleted"))};e=function(c){function b(){var a,c,d,h;babelHelpers.classCallCheck(this,b);for(var e=arguments.length,f=Array(e),g=0;g<e;g++)f[g]=
arguments[g];return h=(c=(d=babelHelpers.possibleConstructorReturn(this,(a=b.__proto__||Object.getPrototypeOf(b)).call.apply(a,[this].concat(f))),d),d.state={confirmationStep:!1,errorMessage:null,isConfirmed:!1,processing:!1,username:void 0},d.handleErrors=function(a){var b=a.message;v.default.add("user.anonymize.validation.error",{statusCode:a.statusCode});d.setState({errorMessage:"string"===typeof b?b:null,processing:!1})},d.onAnonymize=function(){d.setState({processing:!0});v.default.add("user.anonymize");
x({username:d.state.username,method:"POST",skipErrorDialogOnTimeout:!0}).then(function(){w.default.setSessionItem("anonymization.successful",d.state.username);window.location.href=m.default.admin().users().build()},function(a){if(a.timeout)return w.default.setSessionItem("anonymization.continued.in.background",d.state.username),window.location.href=m.default.admin().users().build(),!1;d.handleErrors(a)})},d.onBack=function(){d.setState({confirmationStep:!1,errorMessage:null,isConfirmed:!1})},d.onConfirmedChanged=
function(a){d.setState({isConfirmed:a.target.checked})},d.onContinue=function(){d.setState({processing:!0});x({username:d.state.username,method:"GET"}).then(function(){d.setState({confirmationStep:!0,errorMessage:null,processing:!1})},d.handleErrors)},d.onSubmit=function(a){a.preventDefault();a=d.state;var b=a.username;if(!a.confirmationStep&&b)d.onContinue()},d.onUsernameChanged=function(a){d.setState({errorMessage:null,username:a?a:void 0})},c),babelHelpers.possibleConstructorReturn(d,h)}babelHelpers.inherits(b,
c);babelHelpers.createClass(b,[{key:"render",value:function(){var b=this.state,c=b.errorMessage,d=b.isConfirmed,e=b.processing,f=b.username;return b.confirmationStep?a.default.createElement(G,{canSubmit:d&&!c&&!e,errorMessage:c,onAnonymize:this.onAnonymize,onBack:this.onBack,onConfirmedChanged:this.onConfirmedChanged,onSubmit:this.onSubmit,isConfirmed:d,processing:e,username:f}):a.default.createElement(H,{errorMessage:c,onContinue:this.onContinue,onUsernameChanged:this.onUsernameChanged,onSubmit:this.onSubmit,
processing:e,username:f})}}]);return b}(f.PureComponent);n.default=e;y.exports=n["default"]});