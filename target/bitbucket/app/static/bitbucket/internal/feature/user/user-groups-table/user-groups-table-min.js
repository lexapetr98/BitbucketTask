define("bitbucket/internal/feature/user/user-groups-table/user-groups-table","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/user/group-multi-selector/group-multi-selector bitbucket/internal/feature/user/group-table/group-table bitbucket/internal/util/ajax bitbucket/internal/util/error".split(" "),function(n,l,e,p,q,r,t,u,v,w){function b(a){d.default.call(this,f.default.extend({},{filterable:!1,noneFoundMessageHtml:(0,e.escapeHtml)(e.I18n.getText("bitbucket.web.user.groups.noneFound"))},
a));this.username=this.$table.attr("data-username");this.onError=a.onError||x.default.showNonFieldErrors;this._initBindings=g.default.once(this._initBindings)}Object.defineProperty(l,"__esModule",{value:!0});var f=babelHelpers.interopRequireDefault(p),g=babelHelpers.interopRequireDefault(q),k=babelHelpers.interopRequireDefault(r),y=babelHelpers.interopRequireDefault(t),d=babelHelpers.interopRequireDefault(u),m=babelHelpers.interopRequireDefault(v),x=babelHelpers.interopRequireDefault(w);f.default.extend(b.prototype,
d.default.prototype);b.prototype.buildUrl=function(a,c,b){return k.default.admin().users().addPathComponents("more-members").withParams({context:this.username,start:a,limit:c}).build()};b.prototype.init=function(){d.default.prototype.init.call(this);this._initBindings()};b.prototype.handleErrors=function(a){var c=this;g.default.forEach(a,function(a){c.onError(a.message)})};b.prototype.handleNewRows=function(a,c){this.$table.find("tbody")[c](bitbucket.internal.feature.user.userGroupsRows({groups:a.values}))};
b.prototype.remove=function(a){var c=this;if(d.default.prototype.remove.call(this,a)){var b=this.$table.find("tbody \x3e tr[data-name]").filter(function(){return(0,f.default)(this).attr("data-name")===a.name});b.fadeOut("fast",function(){b.remove();c.updateTimestamp()})}};b.prototype._initBindings=function(){var a=this,b=new y.default((0,f.default)(".groups-multi-selector",a.$table),{url:k.default.admin().users().addPathComponents("more-non-members").withParams({context:a.username}).build()});a.$table.on("click",
".add-button",function(c){c.preventDefault();var h=b.getSelectedItems(),d=g.default.map(h,"name");a._addGroups(a.username,d).done(function(){b.clearSelectedItems();(0,e.flag)({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.added({name:d[0],entityType:"group",count:h.length})});a.add(g.default.map(h,function(a){return f.default.extend({justAdded:!0},a)}))}).fail(function(b,c,d,h){a.handleErrors(a._extractErrors(h,d))})});a.$table.on("click",".delete-button",function(b){b.preventDefault();
var c=(0,f.default)(b.target).closest("a").attr("data-for");a._removeGroups(a.username,c).done(function(){a.remove({name:c});(0,e.flag)({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.deleted({name:c,entityType:"group"})})}).fail(function(b,c,d,e){a.handleErrors(a._extractErrors(e,d))})})};b.prototype._addGroups=function(a,b){return m.default.rest({data:{user:a,groups:b},statusCode:{403:!1,404:!1},type:"POST",url:k.default.admin().users().addPathComponents("add-groups").build()})};
b.prototype._removeGroups=function(a,b){return m.default.rest({data:{context:a,itemName:b},statusCode:{403:!1,404:!1,409:!1},type:"POST",url:k.default.admin().users().addPathComponents("remove-group").build()})};b.prototype._extractErrors=function(a){return g.default.get(a,"errors.length")?a.errors:[{message:(0,e.escapeHtml)(e.I18n.getText("bitbucket.web.user.group.unknown.error"))}]};l.default=b;n.exports=l["default"]});