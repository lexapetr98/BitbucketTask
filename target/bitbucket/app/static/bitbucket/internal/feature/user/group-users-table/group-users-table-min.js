define("bitbucket/internal/feature/user/group-users-table/group-users-table","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/user/user-multi-selector/user-multi-selector bitbucket/internal/util/ajax bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/widget/paged-table/paged-table".split(" "),function(p,m,d,q,r,t,u,v,w,x,y){function b(a){h.default.call(this,e.default.extend({filterable:!1,noneFoundMessageHtml:(0,d.escapeHtml)(d.I18n.getText("bitbucket.web.user.group.members.none")),
idForEntity:z.default.dot("name"),paginationContext:"group-users-table"},a));this.group=this.$table.attr("data-group");this.$notifications=this.$table.prev(".notifications");this._initBindings=f.default.once(this._initBindings)}Object.defineProperty(m,"__esModule",{value:!0});var e=babelHelpers.interopRequireDefault(q),f=babelHelpers.interopRequireDefault(r),k=babelHelpers.interopRequireDefault(t),A=babelHelpers.interopRequireDefault(u),n=babelHelpers.interopRequireDefault(v),l=babelHelpers.interopRequireDefault(w),
z=babelHelpers.interopRequireDefault(x),h=babelHelpers.interopRequireDefault(y);e.default.extend(b.prototype,h.default.prototype);b.prototype.init=function(){h.default.prototype.init.call(this);this._initBindings()};b.prototype.buildUrl=function(a,c,B){a={context:this.group,start:a,limit:c,avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:"small"})};return k.default.admin().groups().addPathComponents("more-members").withParams(a).build()};b.prototype.handleNewRows=function(a,c){this.$table.find("tbody")[c](bitbucket.internal.feature.user.groupUserRows({page:a}))};
b.prototype.handleErrors=function(a){var c=this.$notifications.empty();f.default.forEach(a,function(a){c.append(aui.message.error({content:(0,d.escapeHtml)(a.message)}))})};b.prototype.remove=function(a){var c=this;if(h.default.prototype.remove.call(this,a)){var b=this.$table.find("tbody \x3e tr[data-name]").filter(function(){return(0,e.default)(this).attr("data-name")===a.name});b.fadeOut("fast",function(){b.remove();c.updateTimestamp()})}};b.prototype._initBindings=function(){var a=this,b=new A.default((0,
e.default)(".users-multi-selector",a.$table),{url:k.default.admin().groups().addPathComponents("more-non-members").withParams({context:a.group}).build()});a.$table.on("click",".add-button",function(c){c.preventDefault();var g=b.getSelectedItems();c=f.default.map(g,"name");a._addUsers(a.group,c).done(function(){b.clearSelectedItems();(0,d.flag)({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.added({name:g[0].name,entityType:"user",count:g.length})});a.add(f.default.map(g,
function(a){return e.default.extend({justAdded:!0},a)}));l.default.trigger("bitbucket.internal.group.users.add.success")}).fail(function(b,c,g,d){a.handleErrors(a._extractErrors(d));l.default.trigger("bitbucket.internal.group.users.add.failed")})});a.$table.on("click",".delete-button",function(b){b.preventDefault();var c=(0,e.default)(b.target).closest("a").attr("data-for");a._removeUser(a.group,c).done(function(){a.remove({name:c});(0,d.flag)({type:"success",close:"auto",body:bitbucket.internal.feature.permission.flag.deleted({name:c,
entityType:"user"})});l.default.trigger("bitbucket.internal.group.users.remove.success")}).fail(function(b,c,d,e){a.handleErrors(a._extractErrors(e));l.default.trigger("bitbucket.internal.group.users.remove.failed")})})};b.prototype._addUsers=function(a,b){return n.default.rest({data:{group:a,users:b},statusCode:{403:!1,404:!1,500:!1},type:"POST",url:k.default.admin().groups().addPathComponents("add-users").build()})};b.prototype._removeUser=function(a,b){return n.default.rest({data:{context:a,itemName:b},
statusCode:{403:!1,404:!1,409:!1,500:!1},type:"POST",url:k.default.admin().groups().addPathComponents("remove-user").build()})};b.prototype._extractErrors=function(a){return f.default.get(a,"errors.length")?a.errors:[{message:(0,d.escapeHtml)(d.I18n.getText("bitbucket.web.user.group.unknown.error"))}]};m.default=b;p.exports=m["default"]});