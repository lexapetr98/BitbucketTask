define("bitbucket/internal/feature/dashboard/containers/pull-requests","exports @atlassian/aui lodash react react-redux redux bitbucket/util/events bitbucket/util/scheduler bitbucket/internal/util/property bitbucket/internal/util/shortcuts ../action-creators/load-pull-requests ../action-creators/more-pull-requests ../components/pull-request-table ../more-items-type ../pull-request-type ../selectors/pull-requests".split(" "),function(m,f,n,p,y,z,t,w,A,B,q,C,D,E,a,l){Object.defineProperty(m,"__esModule",
{value:!0});m.PullRequests=void 0;var k=babelHelpers.interopRequireDefault(p),x=babelHelpers.interopRequireDefault(t),F=babelHelpers.interopRequireDefault(w);t=babelHelpers.interopRequireDefault(A);var u=babelHelpers.interopRequireDefault(B),G=babelHelpers.interopRequireDefault(q),H=babelHelpers.interopRequireDefault(C),I=babelHelpers.interopRequireDefault(D),v=babelHelpers.interopRequireDefault(E),J=t.default.getFromProvider("dashboard.poll.pull-requests.interval");p=m.PullRequests=function(d){function e(b){babelHelpers.classCallCheck(this,
e);b=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b));b.state={focusedPullRequestIndex:0};return b}babelHelpers.inherits(e,d);babelHelpers.createClass(e,[{key:"componentDidMount",value:function(){var b=this;u.default.bind("requestMoveToNextHandler",this.moveFocus(1));u.default.bind("requestMoveToPreviousHandler",this.moveFocus(-1));u.default.bind("requestOpenItemHandler",this.openItem);document.addEventListener("keydown",function(b){b.target.getAttribute("type")||
b.keyCode!==f.keyCode.ENTER||(b.preventDefault(),document.querySelector("tr.focused .title a").click())});J.done(function(c){1>c||(b.schedule=new F.default({backoff:{onBlur:!0,onInactive:!0},maxInterval:10*w.MINUTE,interval:c,job:function(){return b.props.updatePullRequestsByTypes(b.props.pullRequestCountsByType)}}),b.schedule.start())})}},{key:"componentWillUnmount",value:function(){this.schedule&&this.schedule.stop()}},{key:"onMorePullRequests",value:function(b){var c=this.props[b].hasMore,h=void 0;
switch(c){case v.default.LOCAL:this.props.morePullRequests(b);h=1;break;case v.default.REMOTE:this.props.loadPullRequests(b,q.MAX_PAGE_SIZE);h=2;break;default:console.warn("onMorePullRequests("+b+") called when hasMoreType is "+c)}x.default.trigger("bitbucket.internal.ui.nav.pagination",null,{context:"dashboard-pull-request-list",page:h})}},{key:"onItemClick",value:function(b,c){var h=b.target.dataset;b=h.pullRequestId;var a=h.repositoryId;h=h.projectId;x.default.trigger("bitbucket.internal.ui.dashboard.pullrequest-list."+
c.toLowerCase()+".item.clicked",null,{pullRequestId:b,repositoryId:a,projectId:h})}},{key:"getDisplayableNumber",value:function(b){var c=b.limit,a=b.locallyLoadedCount;b=b.isLastRemotePage;c=Math.min(c,99);return a>c||a===c&&!b?c+"+":""+a}},{key:"moveFocus",value:function(b){var a=this;return function(){a.setState({focusedPullRequestIndex:Math.max(Math.min(a.state.focusedPullRequestIndex+b,a.props.allPullRequests.length-1),0)})}}},{key:"pullRequestsTable",value:function(b,a){var c=this,r=2<arguments.length&&
void 0!==arguments[2]?arguments[2]:{},g=r.showMore;g=void 0===g?!0:g;var e=r.showStateLozenge;e=void 0===e?!1:e;var d=r.collapsible;d=void 0===d?!1:d;var f=this.props[b];return k.default.createElement(I.default,{type:b,title:a,pullRequests:f.pullRequests,focusedPullRequest:r.focusedPullRequest,focusedPullRequestIndex:this.state.focusedPullRequestIndex,loading:f.loading,lozengeDisplayCount:this.getDisplayableNumber(f),hasMore:g&&f.hasMore!==v.default.NONE,onLoadMoreClick:function(){return c.onMorePullRequests(b)},
onItemClick:function(a){return c.onItemClick(a,b)},showStateLozenge:e,collapsible:d})}},{key:"pullRequestTableList",value:function(){var b=this;(0,n.find)([a.REVIEWING,a.CREATED,a.CLOSED],function(a){return b.props[a].pullRequests.length});var c=this.props.allPullRequests[this.state.focusedPullRequestIndex];return k.default.createElement("div",{className:"dashboard-pull-requests-table"},this.pullRequestsTable(a.REVIEWING,f.I18n.getText("bitbucket.web.dashboard.pullrequests.title.reviewing"),{focusedPullRequest:c}),
this.pullRequestsTable(a.CREATED,f.I18n.getText("bitbucket.web.dashboard.pullrequests.title.created"),{focusedPullRequest:c}),this.pullRequestsTable(a.CLOSED,f.I18n.getText("bitbucket.web.dashboard.pullrequests.title.closed"),{showMore:!1,showStateLozenge:!0,collapsible:!0,focusedPullRequest:c}))}},{key:"pullRequestTableEmptyState",value:function(){return k.default.createElement("div",{className:"dashboard-pull-requests-all-empty"},k.default.createElement("h3",null,f.I18n.getText("bitbucket.web.dashboard.pullrequests.empty.heading")),
k.default.createElement("p",null,f.I18n.getText("bitbucket.web.dashboard.pullrequests.empty.description")))}},{key:"render",value:function(){var b=this;return k.default.createElement("div",{className:"dashboard-pull-requests"},[a.REVIEWING,a.CREATED,a.CLOSED].reduce(function(a,e){return a+b.props[e].pullRequests.length},0)?this.pullRequestTableList():this.pullRequestTableEmptyState())}}]);return e}(p.Component);m.default=(0,y.connect)(function(){var d=function(b){return function(a){return{pullRequests:(0,
l.getPullRequestsForType)(b)(a),hasMore:(0,l.hasMorePullRequestsForType)(b)(a),locallyLoadedCount:(0,l.countLocallyLoadedRequests)(b)(a),loading:(0,n.get)(a,["ui","pullRequests",b,"loading"]),isLastRemotePage:(0,n.get)(a,["paging","pullRequests",b,"lastPageMeta","isLastPage"],!1),limit:(0,n.get)(a,["paging","pullRequests",b,"lastPageMeta","limit"],q.DEFAULT_PAGE_SIZE)}}},e=d(a.REVIEWING),b=d(a.CREATED),c=d(a.CLOSED),f=(0,l.getPullRequestsForTypes)([a.REVIEWING,a.CREATED,a.CLOSED]);return function(d){var g;
return g={},babelHelpers.defineProperty(g,a.REVIEWING,e(d)),babelHelpers.defineProperty(g,a.CREATED,b(d)),babelHelpers.defineProperty(g,a.CLOSED,c(d)),babelHelpers.defineProperty(g,"allPullRequests",f(d)),babelHelpers.defineProperty(g,"pullRequestCountsByType",(0,l.getPullRequestCountsForTypes)([a.REVIEWING,a.CREATED,a.CLOSED])(d)),g}},function(a){return(0,z.bindActionCreators)({loadPullRequests:G.default,morePullRequests:H.default,updatePullRequestsByTypes:q.updatePullRequestsByTypes},a)})(p)});