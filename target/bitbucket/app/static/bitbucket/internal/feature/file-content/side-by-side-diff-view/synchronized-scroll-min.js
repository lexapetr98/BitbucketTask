define("bitbucket/internal/feature/file-content/side-by-side-diff-view/synchronized-scroll","module exports jquery lodash bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/util/math bitbucket/internal/util/synchronized-scroll".split(" "),function(z,y,A,B,C,D,E,F,G){function H(a){function c(){d&&(d.end=f,d.from.end=b,d.to.end=g,m.push(d))}var d=null,f=0,b=0,g=0,m=[];e.default.forEach(a,function(a){d&&a.segment===
d.segment||(c(),d={segment:a.segment,lineInfos:[],start:f,end:-1,from:{start:b,end:-1,lineInfos:[]},to:{start:g,end:-1,lineInfos:[]}});f++;d.lineInfos.push(a);a.segment.type!==v.default.ADDED&&(b++,d.from.lineInfos.push(a));a.segment.type!==v.default.REMOVED&&(g++,d.to.lineInfos.push(a))});c();return m}function p(a,c){this._id=a;this._editor=c;this._programmatic=!1}function u(a,c,d,f,b,e){this._editor=a;this._startIndex=c;this._endIndex=d;this._numLines=d-c;this._id=f;this._seg=b;this._cachedInfo=
null;this._lineInfos=e}function I(a,c){var d,f,b;return{_linkedRegions:a,_seg:a[0]._seg,_id:"combined_"+e.default.map(a,"_id").join("_"),_scrollable:b,_setCombinedScrollable:function(a){this._scrollable=b=a},getHeight:function(){null==d&&(d=a.map(function(a){return a.getHeight()}).reduce(l.default.binary(Math.max),0));return d},_getOffset:function(){null==f&&(f=c());return f},getOffsetTop:function(){return this._getOffset()-b._getScrollTop()},_invalidateCache:function(){f=d=null}}}function J(a,c){function d(a){b=
w.default.clamp(0,c.getScrollHeight()-c.getClientHeight())(a)}this._id=a;a=l.default.constant(0);c=x.default.extend({initialScrollTop:0,getClientHeight:a,getScrollHeight:a},c);var e=!1,b=c.initialScrollTop,g,m=x.default.Callbacks();this._getScrollTop=function(){return w.default.clamp(0,c.getScrollHeight()-c.getClientHeight())(b)};this.scrollToNative=function(a,b){null!=b&&(d(b),g&&g(),m.fire(a,b,"native"))};this._setScrollHandler=function(a){g=a};this.getScrollInfo=function(){return{top:this._getScrollTop(),
left:0,height:c.getScrollHeight(),width:0,clientHeight:c.getClientHeight(),clientWidth:0}};this.scrollTo=function(a,b){null!=b&&(e=!0,d(b),m.fire(a,b,"sync"))};this.on=function(a,b){"scroll"===a&&m.add(b)};this.getAndUnsetProgrammaticScrollMarker=function(){var a=e;e=!1;return a}}function K(a,c,d,f,b){function g(a,b,c,d,e){return new u(a,b.start,b.end,e+"_"+b.start+"_"+b.end,c,d)}function m(a,b){a=g(d,a.from,a.segment,a.from.lineInfos,"from");b=g(f,b.to,b.segment,b.to.lineInfos,"to");h.push(a);k.push(b)}
function t(a){return e.default.invokeMap.bind(e.default,a,"_invalidateCache")}var h=[],k=[];c=H(c);var n=e.default.reduce(c,function(a,b){if(a&&b.segment.type===v.default.ADDED)return m(a,b),null;a&&m(a,a);if(b.segment.type===v.default.REMOVED)return b;m(b,b);return null},null);n&&m(n,n);n=e.default.zip(h,k);var p=e.default.flow(e.default.take,l.default.partialRight(e.default.invokeMap,"getHeight"),l.default.partialRight(e.default.reduce,w.default.add,0));b=b.includeCombinedRegions?e.default.reduce(n,
function(a,b,c){c=e.default.partial(p,a,c);a.push(I(b,c));return a},[]):[];var q={};b.length?e.default.chain(h).zip(k,b).forEach(l.default.spread(function(a,b,c){q[a._id]=[b,c];q[b._id]=[a,c];q[c._id]=[a,b]})).value():e.default.forEach(n,l.default.spread(function(a,b){q[a._id]=[b];q[b._id]=[a]}));d.on("change",t(h.concat(b)));f.on("change",t(k.concat(b)));var r=t(h.concat(k,b));(0,x.default)(window).on("resize",r);a.on("widgetAdded",r);a.on("widgetChanged",r);a.on("widgetCleared",r);a.on("internal.acceptedModification",
r);var M=L.default.chain().on("bitbucket.internal.feature.commit.difftree.collapseAnimationFinished",r);return{combinedSegments:c,fromRegions:h,toRegions:k,combinedRegions:b,linkedFromAndToRegions:n,linkedRegionsByRegionId:q,destroy:function(){M.destroy();(0,x.default)(window).off("resize",r)}}}function N(a,c,d,f,b,g){function m(a,b){a=q(a)||[];return e.default.find(a,l.default.dotEq("_editor",b._editor))}function t(a){a.scrollable.scrollTo(a.scrollLeft,a.scrollTop)}function h(b){a.operation(e.default.forEach.bind(e.default,
b,t));a.trigger("sync-scroll")}function k(a,b,c){if(c.includeHorizontal)var d=h;else d=l.default.partialRight(e.default.map,l.default.unary(l.default.partialRight(e.default.omit,"scrollLeft"))),d=e.default.flow(d,h);return O.default.getScrollHandler({self:a,others:b,getRegions:p,getLinkedRegion:m,executeCommands:d,focusHeightFraction:c.focusHeightFraction})}var n={};n[c._id]=b.fromRegions;n[d._id]=b.toRegions;f&&(n[f._id]=b.combinedRegions);var p=e.default.flow(l.default.dot("_id"),l.default.lookup(n)),
q=e.default.flow(l.default.dot("_id"),l.default.lookup(b.linkedRegionsByRegionId));b={includeHorizontal:!0,focusHeightFraction:g.focusHeightFraction};b={fromHandler:k(c,e.default.compact([d,f]),b),toHandler:k(d,e.default.compact([c,f]),b)};f&&(b.combinedHandler=k(f,[c,d],{includeHorizontal:!1,focusHeightFraction:g.focusHeightFraction}));return b}Object.defineProperty(y,"__esModule",{value:!0});var x=babelHelpers.interopRequireDefault(A),e=babelHelpers.interopRequireDefault(B),v=babelHelpers.interopRequireDefault(C),
L=babelHelpers.interopRequireDefault(D),l=babelHelpers.interopRequireDefault(E),w=babelHelpers.interopRequireDefault(F),O=babelHelpers.interopRequireDefault(G);p.prototype.getScrollInfo=function(){return this._editor.getScrollInfo()};p.prototype.scrollTo=function(a,c){this._programmatic=this._programmatic||null!=a||null!=c;this._editor.scrollTo(a,c)};p.prototype.getAndUnsetProgrammaticScrollMarker=function(){var a=this._programmatic;this._programmatic=!1;return a};u.prototype.getHeight=function(){return this._getCachedInfo().height};
u.prototype.getOffsetTop=function(){return this._getCachedInfo().offsetTop-this._editor.getScrollInfo().top};u.prototype._getCachedInfo=function(){if(!this._cachedInfo){this._cachedInfo={height:0,offsetTop:this._editor.heightAtLine(this._startIndex,"local")};if(!this._numLines)return this._cachedInfo;var a=this._editor.heightAtLine(this._endIndex,"local");this._cachedInfo.height=a-this._cachedInfo.offsetTop}return this._cachedInfo};u.prototype._invalidateCache=function(){this._cachedInfo=null};y.default=
{setupScrolling:function(a,c,d,f,b){b=b||{};var g=K(a,c,d,f,{includeCombinedRegions:b.includeCombinedScrollable});c=new p("from",d);var m=new p("to",f),l=0,h;b.includeCombinedScrollable&&(h=new J("combined",{getScrollHeight:function(){return e.default.chain(g.combinedRegions).invokeMap("getHeight").reduce(w.default.add,0).value()},getClientHeight:function(){return l}}));var k=N(a,c,m,h,g,b);d.on("scroll",k.fromHandler.handle);f.on("scroll",k.toHandler.handle);b={combinedSegments:g.combinedSegments,
combinedRegions:g.combinedRegions,combinedScrollable:h,linkedFromAndToRegions:g.linkedFromAndToRegions,destroy:function(){d.off("scroll",k.fromHandler.handle);f.off("scroll",k.toHandler.handle);g.destroy()}};h&&(h._setScrollHandler(k.combinedHandler.handle),h.setClientHeight=function(a){l=h.clientHeight=a;k.combinedHandler.reset()},e.default.invokeMap(g.combinedRegions,"_setCombinedScrollable",h),b.combinedScrollable=h);c=e.default.invokeMap.bind(e.default,k,"reset");a.on("widgetCleared",c);a.on("widgetChanged",
c);a.on("widgetAdded",c);return b}};z.exports=y["default"]});