define("bitbucket/internal/feature/file-content/text-view/text-view-api","module exports jquery lodash bitbucket/internal/util/array bitbucket/internal/util/deprecation bitbucket/internal/util/function bitbucket/internal/util/mixin bitbucket/internal/util/object".split(" "),function(p,k,l,q,r,g,t,u,v){function w(a){a.classList.add("bitbucket-gutter-marker");return a}Object.defineProperty(k,"__esModule",{value:!0});var x=babelHelpers.interopRequireDefault(l),d=babelHelpers.interopRequireDefault(q),
y=babelHelpers.interopRequireDefault(r),h=babelHelpers.interopRequireDefault(t);l=babelHelpers.interopRequireDefault(u);var z=babelHelpers.interopRequireDefault(v),A="add-comment-trigger bitbucket-coverage blame CodeMirror-linewidget gutter-border line-number line-number-from line-number-to".split(" "),B=(0,g.getMessageLogger)("registerGutter","Code Insights to show extra information on a diff","5.16.0","6.0.0");g={addLineClass:function(a,c,b){this._editorForHandle(a).addLineClass(a._handle,c,b);
return a},addLineWidget:function(a,c,b){var m=this,f=this._editorForHandle(a),e=f.getDoc().lineInfo(a._handle).widgets||[],d=void 0;null==b.weight&&null!=b.insertAt&&e[b.insertAt]?b.weight=e[b.insertAt].weight:(null==b.weight&&(b.weight=100),e=e.findIndex(function(a){return a.weight>b.weight}),b.insertAt=-1===e?null:e);d=f.addLineWidget(a._handle,c,b);this.trigger("widgetAdded");return{clear:function(){d.off("redraw");d.clear();m.trigger("widgetCleared")},changed:function(){d.changed();m.trigger("widgetChanged")},
onRedraw:function(a){d.on("redraw",a)},getHeight:function(){return d.height}}},getLine:function(a){return a._handle.text},getLineHandle:function(a){a&&null==a.lineNumber&&(a=(0,x.default)(a),a.is(".line-locator")||(a=a.closest(".line").find(".line-locator")),a={fileType:a.attr("data-file-type"),lineType:a.attr("data-line-type"),lineNumber:a.attr("data-line-number")});var c=a&&this._internalLines[a.lineType||"CONTEXT"][a.lineNumber]&&this._internalLines[a.lineType||"CONTEXT"][a.lineNumber].handles;
return c&&(c[a.fileType]||c.all[0])},getGutterWidth:function(){return this._editors.map(function(a){return a.getGutterElement().offsetWidth})},operation:function(a){if(this._editors){a=this._editors.reduce(function(a,b){return b.operation.bind(b,a)},h.default.arity(a.bind(null),0));try{return this._inOp||(this._opCallbacks=[],this._inOp=0),this._inOp++,a()}finally{if(this._inOp--,!this._inOp){try{h.default.applyAll(this._opCallbacks)}catch(c){setTimeout(function(){throw c;},0)}this._opCallbacks=null}}}},
registerGutter:function(a,c){c=c||{};if(this._editors){A.includes(a)||B();this._gutters.push({name:a,weight:c.weight||0,fileType:c.fileType});this._gutters=z.default.uniqueFromArray(this._gutters,["name","fileType"]).sort(function(a,c){return a.weight-c.weight||a.name.localeCompare(c.name)});var b=this;this._editors.forEach(function(a){var c=b._getGutters(a._gutterFilter);d.default.isEqual(a.getOption("gutters"),c)||a.setOption("gutters",c)})}},clearGutter:function(a){this._editors.forEach(function(c){c.clearGutter(a)})},
removeLineClass:function(a,c,b){this._editorForHandle(a).removeLineClass(a._handle,c,b);return a},setGutterMarker:function(a,c,b){this._editorForHandle(a).setGutterMarker(a._handle,c,w(b));return a},addContainerClass:function(a){this._$container.addClass(a);this.refresh()},removeContainerClass:function(a){this._$container.removeClass(a);this.refresh()},refresh:function(){return(void 0).refresh()}};var C=Object.keys(g),n={destroy:0,load:1,change:1};k.default={mixInto:(0,l.default)(g).into,setupAPI:function(a){var c=
{};a._api={};var b=[a].concat(C);d.default.bindAll.apply(d.default,b);d.default.assign(a._api,{on:function(b,f){if(d.default.has(n,b)){c[b]||(c[b]=[]);var e=h.default.arity(f.bind(a._api),n[b]);c[b].push({f:f,wrappedF:e});a.on(b,e)}},off:function(b,d){c[b]&&(d=y.default.findIndex(h.default.dotEq("f",d))(c[b]||[]),-1!==d&&(a.off(b,c[b][d].wrappedF),c[b].splice(d,1)))}},d.default.pick.apply(d.default,b))}};p.exports=k["default"]});