define("bitbucket/internal/feature/file-content/file-blame/file-blame","module exports @atlassian/aui jquery lodash bitbucket/util/events bitbucket/util/navbuilder bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/feature/file-content/file-blame/blame-diff bitbucket/internal/feature/file-content/file-blame/blame-gutter bitbucket/internal/feature/file-content/file-blame/blame-source bitbucket/internal/model/content-tree-node-types bitbucket/internal/model/file-change-types bitbucket/internal/model/file-content-modes bitbucket/internal/util/analytics bitbucket/internal/util/promise bitbucket/internal/util/shortcuts bitbucket/internal/widget/button-trigger/button-trigger".split(" "),
function(q,e,r,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K){function L(a,b){if(a.type===f.default.ADD||a.type===f.default.DELETE)a=d.default.head(b.diff.hunks),a={firstAddedLine:a.destinationLine,lastAddedLine:a.destinationSpan,firstRemovedLine:a.sourceLine,lastRemovedLine:a.sourceSpan};else{var c=d.default.chain(b.diff.hunks).flatMap("segments").reject(d.default.matchesProperty("type",g.default.CONTEXT)).groupBy("type").mapValues(function(a){return d.default.flatMap(a,"lines")}).value();a=c[g.default.ADDED]||
[];c=c[g.default.REMOVED]||[];a={firstAddedLine:a.length&&d.default.head(a).destination,lastAddedLine:a.length&&d.default.last(a).destination,firstRemovedLine:c.length&&d.default.head(c).source,lastRemovedLine:c.length&&d.default.last(c).source}}a.since=b.fromHash;a.until=b.toHash;return a}function M(a,b){return{firstLine:b.firstLine,lastLine:b.firstLine+b.linesAdded-1,haveWholeFile:1===b.firstLine&&b.isLastPage}}Object.defineProperty(e,"__esModule",{value:!0});var N=babelHelpers.interopRequireDefault(w),
d=babelHelpers.interopRequireDefault(x),k=babelHelpers.interopRequireDefault(y),O=babelHelpers.interopRequireDefault(z),g=babelHelpers.interopRequireDefault(A),P=babelHelpers.interopRequireDefault(B),Q=babelHelpers.interopRequireDefault(C),R=babelHelpers.interopRequireDefault(D),S=babelHelpers.interopRequireDefault(E),f=babelHelpers.interopRequireDefault(F),l=babelHelpers.interopRequireDefault(G),T=babelHelpers.interopRequireDefault(H),U=babelHelpers.interopRequireDefault(I),V=babelHelpers.interopRequireDefault(J),
W=babelHelpers.interopRequireDefault(K),X={"/browse":"source-view","/diff":"diff-to-previous","/commits/":"commit","/compare":"compare-branch","/pull-requests?create":"create-pullrequest","/pull-requests":"pullrequest"};e.default={init:function(){function a(a,c){function b(a){m.initBlameOptions(f(n,a))}var n=c.fileChange,h=c.$toolbar.find(".file-blame"),e="";if(n.nodeType===S.default.SUBMODULE)h.attr({disabled:!0,"aria-disabled":!0,title:r.I18n.getText("bitbucket.web.file.content.sourceview.blame.submodule.disabled")});
else{c.contentMode===l.default.SOURCE?e=r.I18n.getText("bitbucket.web.file.content.sourceview.blame.file"):c.contentMode===l.default.DIFF&&(e=r.I18n.getText("bitbucket.web.file.content.sourceview.blame.diff"));h.attr({disabled:!1,"aria-disabled":!1,title:e});var g=d.default.once(function(a){var c=O.default.currentRepo().buildAbsolute(),b=d.default.find(X,function(a,b){return d.default.startsWith(location.href,c+b)?a:!1});T.default.add("blame.shown",{type:a,source:b})});if(h.length){if(c.contentMode===
l.default.SOURCE){var m=new R.default(n);var t="bitbucket.internal.feature.fileContent.sourceViewContentLoaded";var f=M}else if(c.contentMode===l.default.DIFF)m=new P.default(n),t="bitbucket.internal.feature.fileContent.diffViewDataLoaded",f=L;else return;k.default.on(t,b);var p=new Q.default(a,m),v=(0,N.default)('\x3cdiv class\x3d"blame-spinner"\x3e\x3c/div\x3e'),u=new W.default(h,{stopEvent:!1,triggerHandler:function(){this.setTriggerActive(!this.isTriggerActive());U.default.spinner(v.insertBefore(h),
p.setEnabled(this.isTriggerActive()));g(c.contentMode)}}),q=V.default.bind("showBlame",u.triggerClicked.bind(u));a.on("destroy",function(){q();v.remove();k.default.off(t,b);d.default.isFunction(p.destroy)&&p.destroy();m=u=p=null})}}}k.default.on("bitbucket.internal.feature.fileContent.textViewInitializing",a);return{destroy:function(){k.default.off("bitbucket.internal.feature.fileContent.textViewInitializing",a)}}}};q.exports=e["default"]});