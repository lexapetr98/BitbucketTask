define("bitbucket/internal/feature/file-content/diff-view-context/diff-view-context-internal","module exports jquery lodash bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/model/file-change-types bitbucket/internal/util/function".split(" "),function(r,m,t,u,v,w,x){Object.defineProperty(m,"__esModule",{value:!0});var n=babelHelpers.interopRequireDefault(t),f=babelHelpers.interopRequireDefault(u),g=babelHelpers.interopRequireDefault(v),p=babelHelpers.interopRequireDefault(w),
y={destinationLine:1,destinationSpan:0,sourceLine:1,sourceSpan:0},q=babelHelpers.interopRequireDefault(x).default.eq(g.default.ADDED);m.default={getSeparatedHunkHtml:function(b,d,e){function c(a){return{line:h?a.destinationLine:a.sourceLine,span:h?a.destinationSpan:a.sourceSpan,isLastPage:a.isLastPage}}a:switch(d){case p.default.ADD:var k=g.default.ADDED;break a;case p.default.DELETE:k=g.default.REMOVED;break a;default:k=g.default.CONTEXT}var h=q(k);d=f.default.map(f.default.zip([y].concat(b),b.concat({})),
function(a){var b=c(a[0]),l=c(a[1]),z=1<l.line,d=0<b.span;b=b.line+b.span;l=l.line-1;h?a=0:(a=a[0],a=a.sourceLine+a.sourceSpan-(a.destinationLine+a.destinationSpan));return e(b,l,a,k,z,d)});return b[b.length-1].isLastPage?d.slice(0,d.length-1):d},fetchContext:function(b,d,e,c,k){function h(a,b,c){return a&&f.default.assign({},a,{lines:a.lines.slice(b,c)})}var a=isNaN(d)?k.maxLimit:d-b+1,g=function(l){return n.default.when(0===b?null:l(b,c+(d?0:1)),d?l(b+a-c,c):null).then(function(a,b){return b?a?
{startSep:a.start+c,endSep:b.start,contexts:[a,b]}:{startSep:0,endSep:b.start,contexts:[null,b]}:(b=a.lines.length>c,{startSep:a.start+a.lines.length+(b?-1:0),contexts:b?[h(a,0,-1),null]:[a]})})};return a<k.maxLimit?e(b,a).then(function(b){return a<=2*c?n.default.Deferred().resolve({startSep:0,endSep:0,contexts:[b]}):g(function(a){return n.default.Deferred().resolve({start:a,lines:b.lines})}).then(function(a){return f.default.assign({},a,{contexts:[h(a.contexts[0],0,c),h(a.contexts[1],-c)]})})}):
g(e)},toHunks:function(b,d){return function(e){e=f.default.map(f.default.compact(e.contexts),function(c){return{segments:[{type:d,lines:f.default.map(c.lines,function(b){return{line:b.text}})}],sourceLine:c.start+1,destinationLine:c.start+1-b,isLastPage:c.isLastPage}});return e.length?e:""}},isAdded:q};r.exports=m["default"]});