define("bitbucket/internal/feature/file-content/unified-diff-view/unified-diff-view","module exports jquery lodash bitbucket/internal/feature/file-content/diff-line-info bitbucket/internal/feature/file-content/diff-view-context/diff-view-context bitbucket/internal/feature/file-content/diff-view-file-types bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/feature/file-content/diff-view/diff-view bitbucket/internal/feature/file-content/line-handle bitbucket/internal/feature/file-content/text-view/attach-simple-scroll-behavior bitbucket/internal/model/file-change-types bitbucket/internal/util/events bitbucket/internal/util/function bitbucket/internal/util/object bitbucket/internal/util/promise bitbucket/internal/feature/file-content/stash-codemirror/search".split(" "),
function(y,k,m,z,A,B,C,D,E,F,G,H,I,J,K,L){function M(a){var b=a.destinationLine,c=a.sourceLine;a.segments[0].lines=g.default.map(a.segments[0].lines,function(a){a.destination=b++;a.source=c++;return a});return a}function N(a,b){if(b.linesAdded&&!a._options.isExcerpt){var c=b.diff,e=q.default.getSeparatedHunkHtml(c.hunks,a._options.fileChange.type),d,h=[],l,f;b.eachLine(function(a){var b=a.handles.FROM||a.handles.TO;a.hunk!==f&&(f=a.hunk,h.push(b));l=b}).done(function(){switch(b.type){case "INSERT":var f=
a._editor.getLineNumber(h[0]._handle),O=0===f,k=a._editor.lastLine()-b.linesAdded;f=f>k;1<c.hunks.length?(h.shift(),e.shift(),e.pop(),l=void 0):(O||(h.shift(),e.shift()),f?d=e.pop():(e.pop(),l=void 0));break;case "INITIAL":h.length===e.length-1&&(d=e.pop());break;default:throw Error("Unrecognized change type: "+b.type);}a.operation(function(){g.default.forEach(g.default.zip(e,h),n.default.spread(n.default.binary(g.default.partial(r,a,!0))));d&&!a._isEntireFile()&&r(a,!1,d,l)})})}}function r(a,b,c,
e){if(c){c=(0,t.default)(c);var d=a.addLineWidget(e,c[0],{coverGutter:!0,noHScroll:!0,above:b,weight:500});b&&a.addLineClass(e,"wrap","first-line-of-hunk");c.data("widget",d)}}function P(a){a&&a.clear()}function u(a,b){return{lineNumber:a===p.default.ADDED?b.destination:b.source,lineType:a}}function d(a,b){f.default.apply(this,arguments)}Object.defineProperty(k,"__esModule",{value:!0});var t=babelHelpers.interopRequireDefault(m),g=babelHelpers.interopRequireDefault(z),v=babelHelpers.interopRequireDefault(A),
q=babelHelpers.interopRequireDefault(B),w=babelHelpers.interopRequireDefault(C),p=babelHelpers.interopRequireDefault(D),f=babelHelpers.interopRequireDefault(E),Q=babelHelpers.interopRequireDefault(F),R=babelHelpers.interopRequireDefault(G),x=babelHelpers.interopRequireDefault(H),S=babelHelpers.interopRequireDefault(I),n=babelHelpers.interopRequireDefault(J);m=babelHelpers.interopRequireDefault(K);var T=babelHelpers.interopRequireDefault(L).default.tryWithLogging;m.default.inherits(d,f.default);d.defaults=
f.default.defaults;d.prototype.init=function(){if(this._$container){var a=this;this._$container.addClass("unified-diff");this.on("internal-change",g.default.partial(N,this));this._options.isExcerpt||q.default.attachExpandContext(this._$container,{fileChange:this._options.fileChange,expansionCallback:this._expandContextLines,diffViewType:this._options.diffViewType});this._$container.append(bitbucket.internal.feature.fileContent.unifiedDiffView.layout());var b=this._options.commentContext&&this._options.commentContext.getGutterId();
b&&this.registerGutter(b,{weight:100});this.registerGutter("line-number-from",{weight:200});this.registerGutter("line-number-to",{weight:300});this.registerGutter("gutter-border",{weight:1500});this._editor=this._createEditor({},this._$container.children(".diff-editor"));this._isEntireFile()&&(b=n.default.dot("hunks.0.segments.0.lines.0.line")(this._data.diff),this._syntaxHighlighting(this._options.fileChange.path.name,b,this._editor));this._addDestroyable(function(){a._editor=null});this._scrollingReady.finally(T(function(){a._editor&&
(a._editor.setOption("scrollLineIntoViewFunc",function(b){b=a._editor.getLineHandle(b.from.line)._stashHandle;a.scrollHandleIntoFocus(b)}),a._modifyDiff("INITIAL",a._data.diff,v.default.convertToLineInfos(a._data.diff,a._options)))}));f.default.prototype.init.call(this)}};d.prototype._acceptModification=function(a,b,c,e){e=e||0;var d=this._editor;b=f.default._combineTexts(c);switch(a){case "INITIAL":d.setValue(b);break;case "INSERT":d._insert(b,e,!0);break;default:throw Error("Unrecognized change type: "+
a);}g.default.forEach(c,function(a,b){b=new Q.default(void 0,a.lineType,a.lineNumber,d.getLineHandle(b+e));a.lineType!==p.default.ADDED&&a._setHandle(w.default.FROM,b);a.lineType!==p.default.REMOVED&&a._setHandle(w.default.TO,b)})};d.prototype._getFocusSegment=function(a){var b=this._editor,c=b.getScrollInfo();a=Math.ceil(c.clientHeight*this._options.focusPoint)-Math.floor(a);if(0>a)return null;c=Math.min(b.lastLine(),b.lineAtHeight(c.top+a+1,"local"));b=b.getLineHandle(c);return(b=this._internalLines[b._stashHandle.lineType][b._stashHandle.lineNumber])&&
b.segment};d.prototype._setFocusSegment=function(a){var b=a[0];this.scrollHandleIntoFocus(this.getLineHandle(u(b.type,b.lines[0])));a=g.default.chain(a).flatMap("lines").map(u.bind(null,b.type)).map(this.getLineHandle).value();this._markLinesFocused([{editor:this._editor,handles:a}])};d.prototype._getFocusLine=function(){var a=this._editor,b=a.getScrollInfo(),c=this._$fileToolbar&&this._$fileToolbar.outerHeight();c=this._$container[0].getBoundingClientRect().top-c;var d=Math.ceil(b.clientHeight*this._options.focusPoint)-
(this._editorInnerOffset()-Math.abs(c));c=0>=c?d:0;b=Math.min(a.lastLine(),a.lineAtHeight(b.top+c+1,"local"));return a.getLineHandle(b)._stashHandle};d.prototype._findNextAnchor=function(a,b,c){return this._findNextAnchorInEditor(this._editor,b,a,c)};d.prototype._attachScrollBehavior=function(){return this._$container?(0,R.default)(this,this._editor,this._$container.children(".diff-editor")):t.default.Deferred().reject()};d.prototype._editorForHandle=function(){return this._editor};d.prototype._isEntireFile=
function(){return(this._options.fileChange.type===x.default.ADD||this._options.fileChange.type===x.default.DELETE)&&!this._options.isExcerpt};d.prototype._expandContextLines=function(a,b,c){if(this._editor){var d=this.getLineHandle(b);a=this._editor.getLineNumber(d._handle);var f=this._editor.lastLine()===a?a+1:a;this.removeLineClass(d,"wrap","first-line-of-hunk");c.forEach(function(a){a.sourceSpan=a.destinationSpan=a.segments[0].lines.length;M(a)});c.length&&c[0].segments.length&&c[0].segments[0].lines.length&&
(d={hunks:c},this._modifyDiff("INSERT",d,v.default.convertToLineInfos(d,this._options),f));P(b.data("widget"));S.default.trigger("bitbucket.internal.feature.fileContent.diffViewExpanded",null,{$context:b,hunk:c,at:a})}};k.default=d;y.exports=k["default"]});