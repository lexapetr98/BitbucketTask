define("bitbucket/internal/feature/file-content/diff-line-info",["module","exports","lodash","bitbucket/internal/feature/file-content/diff-view-segment-types"],function(n,l,p,q){function m(d,h,a,e,b,c,g){this.lineType=d;this.lineNumber=h;this.line=a;this.segment=e;this.hunk=b;this.diff=c;this.handles={FROM:null,TO:null,all:[]};this.attributes=g}Object.defineProperty(l,"__esModule",{value:!0});var f=babelHelpers.interopRequireDefault(p),k=babelHelpers.interopRequireDefault(q),r={ADDED:"destination",
REMOVED:"source",CONTEXT:"source"};m.prototype._setHandle=function(d,h){this.handles[d]=h;this.handles.all.push(h);this.handles.all=f.default.uniq(this.handles.all)};l.default={convertToLineInfos:function(d,h){return f.default.chain(d.hunks).flatMap(function(a){return f.default.map(a.segments,function(e,b){var c=a.segments;var g=h.relevantContextLines;var d=c[b-1];b=c[b+1];if(e.type!==k.default.CONTEXT)g=null;else{c=0;var f=e.lines.length;!d||d.type!==k.default.ADDED&&d.type!==k.default.REMOVED||
(c=g);!b||b.type!==k.default.ADDED&&b.type!==k.default.REMOVED||(f-=g);g=f>c?{start:c-1,end:f}:null}return{hunk:a,segment:e,expandedRange:g}})}).flatMap(function(a){var e=a.segment;return f.default.map(e.lines,function(b,c){return new m(e.type,b[r[e.type]],b,e,a.hunk,d,{expanded:a.expandedRange&&c<a.expandedRange.end&&c>a.expandedRange.start})})}).value()}};n.exports=l["default"]});