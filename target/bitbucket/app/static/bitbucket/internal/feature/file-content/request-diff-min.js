define("bitbucket/internal/feature/file-content/request-diff","module exports jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/file-content/diff-view-options bitbucket/internal/model/path bitbucket/internal/util/ajax bitbucket/internal/util/deprecation".split(" "),function(n,e,p,q,r,t,u,v,w){function x(b,a){if(g.default.isArray(a.diffs)&&a.diffs.length){var c=h.default.find(a.diffs,function(a){return a.destination?a.destination.toString===(new k.default(b.path)).toString():b.srcPath?
a.source.toString===(new k.default(b.srcPath)).toString():!1})||a.diffs[0];a=h.default.assign({diff:c},a,c);Object.keys(c).forEach(function(b){l.default.prop(a,b,b,"diff."+b,"4.5","5.0")});delete a.diffs}return a}function y(b){var a=z.default.rest().project(b.repository.project.key).repo(b.repository.slug),c=b.commitRange.pullRequest;return(c?a.pullRequest(c.id):a.commit(b.commitRange)).diff(b)}Object.defineProperty(e,"__esModule",{value:!0});var g=babelHelpers.interopRequireDefault(p),h=babelHelpers.interopRequireDefault(q),
z=babelHelpers.interopRequireDefault(r),A=babelHelpers.interopRequireDefault(t),k=babelHelpers.interopRequireDefault(u),m=babelHelpers.interopRequireDefault(v),l=babelHelpers.interopRequireDefault(w),f={};e.default=function(b,a){var c=b.toJSON?b.toJSON():b;if(c.diff){a=g.default.extend({lineComments:a.lineComments||[],fileComments:a.fileComments||[]},c.diff);var e=g.default.extend({diff:a,fromHash:c.diff.properties&&c.diff.properties.fromHash,toHash:c.diff.properties&&c.diff.properties.toHash},a);
Object.keys(a).forEach(function(a){l.default.prop(e,a,a,"diff."+a,"4.5","5.0")});return g.default.Deferred().resolve(e)}a=a||{};b=a.diffViewOptions||A.default;b=a.hasOwnProperty("ignoreWhitespace")?a.ignoreWhitespace:b.get("ignoreWhitespace");var h=isNaN(Number(a.contextLines))?-1:Math.floor(a.contextLines),d=(a.diffUrlBuilder||y)(c).withParams({avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:a.avatarSize||"medium"}),markup:!0,whitespace:b?"ignore-all":"",contextLines:h,withComments:a.withComments,
autoSrcPath:a.autoSrcPath}).build();if(f.hasOwnProperty(d)&&"rejected"!==f[d].state())return f[d];a=m.default.rest({url:d,statusCode:a.statusCode||m.default.ignore404WithinRepository()});b=a.then(function(a){if(a.errors&&a.errors.length)return g.default.Deferred().rejectWith(this,[this,null,null,a]);a=x(c,a);setTimeout(function(){delete f[d]});return a});f[d]=b.promise(a);return f[d]};n.exports=e["default"]});