define("bitbucket/internal/feature/file-content/file-blame/blame-source","module exports jquery lodash bitbucket/util/navbuilder bitbucket/util/server bitbucket/internal/util/property".split(" "),function(e,c,f,g,h,k,l){function b(a){this._fileChange=a;this._optionsPromise=d.default.Deferred();this._blamePromise=null}Object.defineProperty(c,"__esModule",{value:!0});var d=babelHelpers.interopRequireDefault(f),m=babelHelpers.interopRequireDefault(g),n=babelHelpers.interopRequireDefault(h),p=babelHelpers.interopRequireDefault(k),
q=babelHelpers.interopRequireDefault(l);b.prototype.get=function(){this._blamePromise||(this._blamePromise=d.default.when(this._optionsPromise,q.default.getFromProvider("display.max.source.lines")).then(this._requestBlame.bind(this)));return this._blamePromise};b.prototype.initBlameOptions=function(a){this._optionsPromise.resolve(a)};b.prototype._calculateBlameWindowStart=function(a,b){return Math.max(0,Math.floor((a.firstLine+a.lastLine)/2)-b/2)};b.prototype._requestBlame=function(a,b){return p.default.rest({url:n.default.rest().currentRepo().browse().path(this._fileChange.path).at(this._fileChange.commitRange.untilRevision.id).build(),
data:{blame:!0,noContent:!0,start:a.haveWholeFile?a.firstLine-1:this._calculateBlameWindowStart(a,b),limit:a.haveWholeFile?a.lastLine-a.firstLine+1:b,avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:"xsmall"})}}).then(m.default.identity)};c.default=b;e.exports=c["default"]});