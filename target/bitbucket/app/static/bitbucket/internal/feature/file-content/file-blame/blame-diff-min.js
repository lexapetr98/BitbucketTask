define("bitbucket/internal/feature/file-content/file-blame/blame-diff","module exports jquery lodash bitbucket/util/navbuilder bitbucket/util/server bitbucket/internal/model/file-change-types bitbucket/internal/util/property".split(" "),function(m,f,n,p,q,r,t,u){function b(a){this._fileChange=a;this._optionsPromise=c.default.Deferred();this._blamePromise=null}Object.defineProperty(f,"__esModule",{value:!0});var c=babelHelpers.interopRequireDefault(n),g=babelHelpers.interopRequireDefault(p),k=babelHelpers.interopRequireDefault(q),
l=babelHelpers.interopRequireDefault(r),e=babelHelpers.interopRequireDefault(t),v=babelHelpers.interopRequireDefault(u);b.prototype.get=function(){this._blamePromise||(this._blamePromise=c.default.when(this._optionsPromise,v.default.getFromProvider("display.max.source.lines")).then(this._requestBlame.bind(this)));return this._blamePromise};b.prototype.initBlameOptions=function(a){this._optionsPromise.resolve(a)};b.prototype._calculateBlameWindowStart=function(a,c){var d=g.default.chain([a.firstAddedLine,
a.firstRemovedLine]).compact().min().value()-1;return Math.max(0,Math.floor((d+(Math.max(a.lastAddedLine,a.lastRemovedLine)-1))/2)-c/2)};b.prototype._requestBlame=function(a,b){var d=[],f=this._fileChange.type===e.default.MODIFY&&!a.firstAddedLine,h=this._fileChange.type===e.default.MODIFY&&!a.firstRemovedLine;this._fileChange.type===e.default.DELETE||f?d.push(c.default.Deferred().resolve()):d.push(l.default.rest({url:k.default.rest().currentRepo().browse().path(this._fileChange.path).at(a.until).build(),
data:{blame:!0,noContent:!0,start:h?this._calculateBlameWindowStart(a,b):a.firstAddedLine-1,limit:h?b:a.lastAddedLine-a.firstAddedLine+1,avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:"xsmall"})}}).then(g.default.identity));this._fileChange.type===e.default.ADD||h?d.push(c.default.Deferred().resolve()):d.push(l.default.rest({url:k.default.rest().currentRepo().browse().path(this._fileChange.srcPath||this._fileChange.path).at(a.since).build(),data:{blame:!0,noContent:!0,start:this._fileChange.type===
e.default.DELETE?a.firstRemovedLine-1:this._calculateBlameWindowStart(a,b),limit:this._fileChange.type===e.default.DELETE?a.lastRemovedLine-a.firstRemovedLine+1:b,avatarSize:bitbucket.internal.widget.avatarSizeInPx({size:"xsmall"})}}).then(g.default.identity));return c.default.when.apply(c.default,d)};f.default=b;m.exports=f["default"]});