define("bitbucket/internal/feature/file-content/ediff/ediff-markers","module exports baconjs jquery lodash bitbucket/internal/bbui/ediff/ediff bitbucket/internal/feature/file-content/diff-view-segment-types bitbucket/internal/util/bacon bitbucket/internal/util/function".split(" "),function(r,g,t,u,v,w,x,y,z){function A(b,a){var d=h.default.fromBinder(function(b){a.eachLine(b).done(c.default.partial(b,new h.default.End));return B.default.noop});m(d).onValue(function(a){b.markText(a.line,a.from,a.to,
a.options)})}function m(b){var a=e.default.dot("0.line.conflictMarker");return C.default.split(b,e.default.dot("segment")).slidingWindow(2,2).filter(e.default.partialRight(c.default.every,e.default.not(a))).filter(e.default.spread(function(b,a){return b[0].segment.type===n.default.REMOVED&&a[0].segment.type===n.default.ADDED})).flatMap(e.default.spread(function(b,a){function f(b,a){return h.default.fromArray(a).map(function(a){return c.default.assign({},a,{line:b[a.line]})})}var d=D(b[0].segment,
a[0].segment);return f(b,d.from).merge(f(a,d.to))}))}function D(b,a){function d(a){a=c.default.map(a.lines,"line").join("\n");return{text:a,tokens:p.default.tokenizeString(a)}}a=d(a);b=d(b);if(!(750>a.tokens.length&&750>b.tokens.length))return{to:[],from:[]};var l=p.default.diff(b.tokens,a.tokens);return{from:c.default.map(l.originalRegions,c.default.partial(q,b.text)),to:c.default.map(l.revisedRegions,c.default.partial(q,a.text))}}function q(b,a){var d=b.slice(0,a.start),c=b.slice(a.start,a.end),
f=d.lastIndexOf("\n")+1,e=c.lastIndexOf("\n")+1;b=a.start-f;f=a.end-(e?e+a.start:f);d=d.split("\n").length-1;c=c.split("\n").length-1;return{line:d,from:{lineOffset:0,ch:b},to:{lineOffset:c,ch:f},options:{className:"ediff-"+a.type}}}function E(b){b.off("internal-change",k)}Object.defineProperty(g,"__esModule",{value:!0});var h=babelHelpers.interopRequireDefault(t),B=babelHelpers.interopRequireDefault(u),c=babelHelpers.interopRequireDefault(v),p=babelHelpers.interopRequireDefault(w),n=babelHelpers.interopRequireDefault(x),
C=babelHelpers.interopRequireDefault(y),e=babelHelpers.interopRequireDefault(z),k;g.default={init:function(b){k=c.default.partial(A,b.diffView);b.diffView.on("internal-change",k);return{destroy:c.default.partial(E,b.diffView)}},_convertLinesToMarkers:m};r.exports=g["default"]});