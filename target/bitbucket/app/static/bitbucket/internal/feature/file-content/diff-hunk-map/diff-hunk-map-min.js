define("bitbucket/internal/feature/file-content/diff-hunk-map/diff-hunk-map","module exports jquery lodash bitbucket/internal/util/function bitbucket/internal/util/math bitbucket/internal/util/scroll".split(" "),function(k,f,l,m,n,p,q){function a(b,c,a){this.init.apply(this,arguments)}Object.defineProperty(f,"__esModule",{value:!0});var d=babelHelpers.interopRequireDefault(l),h=babelHelpers.interopRequireDefault(m),r=babelHelpers.interopRequireDefault(n),e=babelHelpers.interopRequireDefault(p),t=
babelHelpers.interopRequireDefault(q),g={CONTEXT:"#ffffff",ADDED:"#97f295",REMOVED:"#ffb6ba",CONFLICT:"#FFF986"};a.prototype.init=function(b,c,a){this.regions=c;this.options=d.default.extend({},a);this.$hunkMap=(0,d.default)(bitbucket.internal.feature.fileContent.diffHunkMap()).appendTo(b);this.hunkMapWidth=this.$hunkMap.width();this.$indicator=(0,d.default)(bitbucket.internal.feature.fileContent.diffHunkMapViewportIndicator()).appendTo(this.$hunkMap);this.indicatorScroll=t.default.fakeScroll(this.$indicator[0],
{withDocument:!0});this.addCanvas(e.default.Size(this.hunkMapWidth,this.$hunkMap.height()));this.redraw();if("function"===typeof this.options.scrollToFn)this.$hunkMap.on("click",this._hunkMapClicked.bind(this,this.options.scrollToFn))};a.prototype.setIndicator=function(){var b=this.hunkMapHeight/this.totalHeight*this.hunkMapHeight,c=0===this.hunkMapHeight||b===this.hunkMapHeight;this.$indicator.toggleClass("hidden",c);c||this.$indicator.height(b)};a.prototype.diffScrolled=function(b){this.indicatorScroll(0,
b.top/b.height*this.hunkMapHeight)};a.prototype._hunkMapClicked=function(b,c){c=c.pageY-this.$hunkMap.offset().top;b(c/this.hunkMapHeight)};a.prototype.mapHeights=function(){var b=h.default.invokeMap(this.regions,"getHeight"),c=this;this.totalHeight=b.reduce(e.default.add,0);this.hunkMapHeight=Math.min(this.$hunkMap.height(),this.totalHeight);h.default.chain(this.regions).zip(b).forEach(r.default.spread(function(b,a){b.fraction=a/c.totalHeight})).value()};a.prototype.addHunkToMap=function(b,a){if(0===
a.fraction)return b;var c=this.getHunkHeight(a);this.setFillStyle(a._seg.lines[0].conflictMarker?g.CONFLICT:g[a._seg.type]||g.CONTEXT);this.drawHunk(e.default.Point(0,b),e.default.Size(this.hunkMapWidth,c));return b+c};a.prototype.getHunkHeight=function(b){return Math.max(b.fraction*this.hunkMapHeight,1)};a.prototype.clear=function(){this.canvasContext.clearRect(0,0,this.hunkMapWidth,this.hunkMapHeight)};a.prototype.draw=function(){this.$canvas.attr("height",this.hunkMapHeight);this.regions.reduce(this.addHunkToMap.bind(this),
0);this.setIndicator()};a.prototype.redraw=function(){this.clear();this.mapHeights();this.draw()};a.prototype.addCanvas=function(b){this.$canvas=(0,d.default)(bitbucket.internal.feature.fileContent.diffHunkMapCanvas({size:b})).appendTo(this.$hunkMap);this.canvasContext=this.$canvas[0].getContext("2d")};a.prototype.setFillStyle=function(b){this.canvasContext.fillStyle=b};a.prototype.drawHunk=function(b,a){this.canvasContext.fillRect(b.x,b.y,a.width,a.height)};a.prototype.destroy=function(){this.$hunkMap.remove()};
f.default=a;k.exports=f["default"]});