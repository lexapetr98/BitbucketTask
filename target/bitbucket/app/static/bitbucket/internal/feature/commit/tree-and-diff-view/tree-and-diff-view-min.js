define("bitbucket/internal/feature/commit/tree-and-diff-view/tree-and-diff-view","module exports @atlassian/aui jquery lodash bitbucket/util/state bitbucket/internal/feature/commit/difftree/difftree bitbucket/internal/feature/file-content/diff-view-options bitbucket/internal/feature/file-content/diff-view-type bitbucket/internal/feature/file-content/file-content bitbucket/internal/model/conflict bitbucket/internal/model/file-change bitbucket/internal/model/file-content-modes bitbucket/internal/model/page-state bitbucket/internal/model/path-and-line bitbucket/internal/util/dom-event bitbucket/internal/util/events bitbucket/internal/util/feature-detect bitbucket/internal/util/shortcuts".split(" "),
function(ba,z,A,ca,da,ea,fa,B,ha,C,ia,ja,ka,la,ma,na,oa,pa,qa){function J(a){var n=D(a);var b=a.data("srcPath")&&new u.default(a.data("srcPath"));var c=a.data("changeType"),d=a.data("nodeType");var k=a.data("conflict")&&new ra.default(a.data("conflict"));var e=a.data("executable");a=a.data("srcExecutable");return new sa.default({repository:K.default.getRepository(),commitRange:f,srcPath:b&&b.path,path:n.path,type:c,nodeType:d,line:n.line,search:E,conflict:k,srcExecutable:a,executable:e})}function F(a,
b,d){g||(g=new L.default(v,"commit-file-content"));b||(b=a.getLine());M(g,d);d||(d=ta.default.proxy(),d.on("change",ua));w=a;e=new u.default(a.getPath(),a.getLine());K.default.setFilePath(a.getPath());v.height(v.height());var n=h.scrollTop();return g.init(a,Object.assign(r,{anchor:b,diffViewOptions:d})).done(function(){m=(0,c.default)("#commit-file-content");if(0!==m.length){m.find(".file-toolbar");m.find(".content-view");var a=n,b=m.offset();n=b?Math.min(a,b.top):a;h.scrollTop(n)}})}function M(a,
b){(a=l.default.get(a,"_options.diffViewOptions"))&&b!==a&&a.destroy()}function N(){var a=c.default.Deferred();w=e=null;g&&(M(g,null),g.destroy(),g=null);(0,c.default)("#commit-file-content").empty();return a.resolve()}function D(a){return new u.default(a.data("path"))}function O(){var a=P=h.height();(0,c.default)(".file-tree-container").children(":not(.file-tree-wrapper):visible").each(function(){a-=(0,c.default)(this).outerHeight(!0)});return a}function Q(){x=O();y.css({"max-height":x+"px","border-bottom-width":0})}
function ua(a){l.default.includes(["hideComments","hideEdiff","showWhitespaceCharacters"],a.key)||R(this)}function S(){G=!0;var a=H();if((!!a^!!e||a&&a.path.toString()!==e.path.toString())&&b){if(b.selectFile(a.path.getComponents()),R(),a.line)d.default.once("bitbucket.internal.feature.fileContent.diffViewContentChanged",function(){d.default.trigger("bitbucket.internal.feature.diffView.lineChange",null,a.line)})}else a.toString()!==e.toString()&&(d.default.trigger("bitbucket.internal.feature.diffView.lineChange",
null,a.line),e=a);G=!1}function R(a){var c=b.getSelectedFile();c&&0<c.length?F(J(c),void 0,a):w&&F(w,void 0,a)}function va(a){p||(p=(0,c.default)('\x3cdiv class\x3d"spinner"/\x3e'));p.appendTo("#content .file-tree-wrapper").spin("large",{zIndex:10});y.siblings(".file-tree-header").replaceWith(bitbucket.internal.feature.fileTreeHeader({commit:r.linkToCommit?f.getUntilRevision().toJSON():null,repository:wa.default.getRepository()}));return b.init(a).always(function(){p&&(p.spinStop().remove(),p=null)}).done(function(){(0,
c.default)(".file-tree");x=O();y.css("max-height",x)})}function H(){return new u.default(decodeURI(window.location.hash.substring(1)))}function T(){function a(){d.default.trigger("bitbucket.internal.feature.commit.difftree.collapseAnimationFinished",null,g)}var b=(0,c.default)(".collapse-file-tree"),e=(0,c.default)(".commit-files"),f=(0,c.default)(".file-tree-container"),g,l,h=!1,m=function(b){var c=e.hasClass("collapsed");"undefined"===typeof b&&(b=!c);e.toggleClass("collapsed",b).toggleClass("quick-reveal-mode",
h);g=e.hasClass("collapsed");g!==c&&(d.default.trigger("bitbucket.internal.feature.commit.difftree.toggleCollapse",null,g),xa.default.cssTransition()||a())};q=function(a){a=h?!1:a;"object"===("undefined"===typeof a?"undefined":babelHelpers.typeof(a))&&(a=void 0);h=!1;clearTimeout(l);m(a)};k.push(d.default.chainWith(b).on("click",U.default.preventDefault(q)));k.push(d.default.chainWith(f).on("mouseleave",function(){clearTimeout(l);h&&(h=!1,q(!0))}).on("transitionend",U.default.filterByTarget(f,a)));
k.push(d.default.chainWith(f.children().not(".diff-tree-toolbar")).on("mouseenter",function(){clearTimeout(l);e.hasClass("collapsed")&&(l=setTimeout(function(){h=!0;m(!1)},200))}));k.push(d.default.chainWith(f.find(".diff-tree-toolbar")).on("focus","input",function(){q(!1)}))}function V(){(0,c.default)(".no-changes-placeholder").remove();var a=e?e:H();return va(a.path.getComponents()).then(function(b){return(b=b.getSelectedFile())&&b.length?F(J(b),a.line):N().done(function(){(0,c.default)(".commit-files").append((0,
c.default)('\x3cdiv class\x3d"message no-changes-placeholder"\x3e\x3c/div\x3e').text(ya.default.I18n.getText("bitbucket.web.no.changes.to.show")))})})}function W(a){return new za(".file-tree-wrapper",".diff-tree-toolbar .aui-toolbar2-primary",f,{maxChanges:a.maxChanges,hasOtherParents:1<a.numberOfParents,urlBuilder:a.changesUrlBuilder,searchUrlBuilder:a.diffUrlBuilder,diffViewType:a.diffViewType})}function X(a,b){G||b||(window.location.hash=a?encodeURI(D(a).toString()):"")}Object.defineProperty(z,
"__esModule",{value:!0});var ya=babelHelpers.interopRequireDefault(A),c=babelHelpers.interopRequireDefault(ca),l=babelHelpers.interopRequireDefault(da),wa=babelHelpers.interopRequireDefault(ea);A=babelHelpers.interopRequireDefault(fa);var ta=babelHelpers.interopRequireDefault(B);B=babelHelpers.interopRequireDefault(ha);var L=babelHelpers.interopRequireDefault(C),ra=babelHelpers.interopRequireDefault(ia),sa=babelHelpers.interopRequireDefault(ja);C=babelHelpers.interopRequireDefault(ka);var K=babelHelpers.interopRequireDefault(la),
u=babelHelpers.interopRequireDefault(ma),U=babelHelpers.interopRequireDefault(na),d=babelHelpers.interopRequireDefault(oa),xa=babelHelpers.interopRequireDefault(pa),I=babelHelpers.interopRequireDefault(qa),za=A.default.DiffTree,r,f,w,e,E,G=!1,k=[],b,t={},g,h=(0,c.default)(window),Y,v,p,P,x,m,Z,y;d.default.on("bitbucket.internal.feature.diffView.highlightSearch",function(a){E=a});var q,aa={breadcrumbs:!0,changeTypeLozenge:!0,changeModeLozenge:!0,contentMode:C.default.DIFF,linkToCommit:!1,sourceLink:!0,
toolbarWebFragmentLocationPrimary:null,toolbarWebFragmentLocationSecondary:null,diffViewType:B.default.EFFECTIVE};z.default={getSelectedPath:function(){if(!b)return null;var a=b.getSelectedFile();return D(a).toString()},updateCommitRange:function(a){a.getId()!==f.getId()&&(f=a,b.reset(),Object.prototype.hasOwnProperty.call(t,f.getId())?b=t[f.getId()]:(b=W(r),t[f.getId()]=b),V())},init:function(a,g){r=c.default.extend({},aa,g);(0,c.default)("#footer");Y=(0,c.default)("#content");v=Y.find(".commit-files");
Z=(0,c.default)(".file-tree-container");y=Z.children(".file-tree-wrapper");P=h.height();m=(0,c.default)("#commit-file-content");f=a;b=W(r);t[f.getId()]=b;e=H();h.on("hashchange",S);V();T();k.push(d.default.chain().on("window.resize",Q).on("bitbucket.internal.feature.fileContent.diffViewExpanded",Q).on("bitbucket.internal.feature.commit.difftree.selectedNodeChanged",X));k.push({destroy:I.default.bind("requestToggleDiffTreeHandler",l.default.ary(q,0))});k.push({destroy:I.default.bind("requestMoveToNextHandler",
l.default.ary(b.openNextFile.bind(b),0))});k.push({destroy:I.default.bind("requestMoveToPreviousHandler",l.default.ary(b.openPrevFile.bind(b),0))});k.push(d.default.chainWith(b).on("search-focus",l.default.partial(q,!1)))},_initDiffTreeToggle:T,reset:function(){b&&b.reset();b=f=void 0;t={};E=e=void 0;h.off("hashchange",S);l.default.invokeMap(k,"destroy");k=[];return N()},_onSelectedNodeChanged:X,defaults:aa,commentMode:L.default.commentMode};ba.exports=z["default"]});