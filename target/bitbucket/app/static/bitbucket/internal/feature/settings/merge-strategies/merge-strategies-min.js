define("bitbucket/internal/feature/settings/merge-strategies/merge-strategies","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/util/server bitbucket/internal/enums bitbucket/internal/feature/repository/inherit-settings-toggle/inherit-settings-toggle bitbucket/internal/util/scope-type".split(" "),function(A,f,e,B,g,C,q,D,k,E){function r(a,b){return{mergeConfig:{defaultStrategy:{id:a},strategies:b.map(function(a){return{id:a}})}}}function l(){var a=(0,d.default)('input[name\x3d"enabledIds"]:checked').map(function(a,
b){return b.value}).get(),b=(0,d.default)('input[name\x3d"defaultId"]:checked').val();return r(b,a)}function F(a){var b=l();if(t())return(0,q.rest)({url:x.default.rest()[(0,E.scopeNavMethod)(a)]().pullRequestSettings().build(),data:b,type:"POST"})}function y(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;(0,d.default)("#merge-config-form").replaceWith(bitbucket.internal.feature.settings.mergeStrategies.mergeConfig({mergeConfig:a,disabled:b}))}function G(a){m&&(m.close(),m=null);
var b=(0,d.default)(a.target).closest(".merge-strategy-container").find(".default-merge-strategy input");!a.target.checked&&b.prop("checked")&&((0,d.default)(".lozenge-default-strategy").remove(),b.prop("checked",!1).removeAttr("checked").trigger("change"));b.attr("disabled",!a.target.checked);a=(0,d.default)(".merge-strategy[checked]");1===a.length&&a.closest(".merge-strategy-container").find(".default-merge-strategy input").click();t()}function H(a){var b=document.getElementById(a.target.value),
c=(0,d.default)(u);(0,g.forEach)(document.querySelectorAll('input[name\x3d"'+a.target.name+'"]'),function(a){return a.removeAttribute("checked")});a.target.setAttribute("checked","checked");c.find(".default-merge-strategy label").text(e.I18n.getText("bitbucket.web.settings.mergestrategy.set.default"));(0,d.default)(".is-default-strategy").removeClass("is-default-strategy");a.target.checked&&((0,d.default)(".lozenge-default-strategy").remove(),(0,d.default)(bitbucket.internal.feature.settings.mergeStrategies.defaultLozenge()).insertAfter(b),
(0,d.default)(a.target).next(".default-merge-strategy label").text("("+e.I18n.getText("bitbucket.web.settings.mergestrategy.default")+")").closest(".merge-strategy-container").addClass("is-default-strategy"));t()}function t(){var a=(0,d.default)(u),b=(0,d.default)("#merge-strategy-errors"),c=a.find(".merge-strategy[checked]").length;a=a.find(".default-merge-strategy input:checked").length;var e=c&&a;b.html(bitbucket.internal.feature.settings.mergeStrategies.errors({hasStrategy:c,hasDefault:a}));v(document.getElementById("merge-strategies-submit"),
!e);return e}function I(a,b){a=a.mergeConfig;b=b.mergeConfig;return a.defaultStrategy.id!==b.defaultStrategy.id?!0:!(0,g.isEqual)(z(a.strategies),z(b.strategies))}function J(){var a=function(){return I(r(c.mergeConfig.defaultStrategy.id,c.mergeConfig.strategies.filter(function(a){return a.enabled}).map(function(a){return a.id})),l())||!c.inheriting&&c.mergeConfig.type===n.REPOSITORY};(new K.default(document.getElementById("inherit-settings-toggle"),a)).on("change",function(b){b===k.InheritanceType.INHERIT?
(w(!0),(c.mergeConfig.type===n.REPOSITORY||a())&&(0,q.rest)({url:x.default.rest().currentRepo().pullRequestSettings().build(),data:{mergeConfig:{}},type:"POST"}).done(function(a){p({inheriting:!0,mergeConfig:a.mergeConfig});y(c.mergeConfig,!0)}).fail(function(){w(!1)})):(p({inheriting:!1}),w(!1))})}function w(a){(0,g.forEach)(document.querySelectorAll("#merge-strategies-submit,#merge-strategies-cancel,#merge-config-form,#merge-config-form aui-toggle"),function(b){return v(b,a)})}function v(a,b){a.disabled=
b;a.setAttribute("aria-disabled",b)}Object.defineProperty(f,"__esModule",{value:!0});var d=babelHelpers.interopRequireDefault(B),x=babelHelpers.interopRequireDefault(C),K=babelHelpers.interopRequireDefault(k),n={DEFAULT:"DEFAULT",PROJECT:"PROJECT",REPOSITORY:"REPOSITORY",SCM:"SCM"},m=void 0,c={mergeConfig:{},inheriting:!1},p=function(a){return c=babelHelpers.extends({},c,a)},u=void 0,z=function(a){return a.map(function(a){return a.id}).sort()};f.default={onReady:function(a,b){u=a;a=(0,d.default)(u);
var f=b.mergeConfig,g=b.mergeConfigType,q=b.mergeStrategiesHelpUrl,h=b.repository;b=f.type;var r=x.default.currentProject().settings().mergeStrategies().build(),l=h&&h.project.type===D.ProjectType.PERSONAL;h=h&&b!==n.REPOSITORY&&!l;p({inheriting:h,mergeConfig:f,mergeConfigType:g});a.html(bitbucket.internal.feature.settings.mergeStrategies.pageContent({effectiveMergeConfigType:b,mergeConfig:f,inheriting:h,mergeConfigType:g,mergeStrategiesHelpUrl:q,projectSettingsUrl:r,personalRepository:l}));a.on("click",
"#merge-strategies-submit",function(a){var b=(0,d.default)(a.target);b.spin().addClass("waiting");F(g).done(function(a){m=(0,e.flag)({type:"success",close:"auto",body:e.I18n.getText("bitbucket.web.settings.mergestrategy.saved.success")});p({mergeConfig:a.mergeConfig})}).fail(function(){m=(0,e.flag)({type:"error",close:"auto",body:e.I18n.getText("bitbucket.web.settings.mergestrategy.saved.error")})}).always(function(){v(b.get(0),!1);b.removeClass("waiting").spinStop()});v(b.get(0),!0)});a.on("click",
"#merge-strategies-cancel",function(){y(c.mergeConfig);var a=c.mergeConfig.type!==n.REPOSITORY?k.InheritanceType.INHERIT:k.InheritanceType.CUSTOM;p({inherit:a===k.InheritanceType.INHERIT});document.querySelector('input[name\x3d"inherit-settings-selection"][value\x3d"'+a+'"]').checked=!0;t();w(c.inherit)});a.on("change",".merge-strategy",G);a.on("change",".default-merge-strategy input",H);J()},MergeConfigType:n};A.exports=f["default"]});