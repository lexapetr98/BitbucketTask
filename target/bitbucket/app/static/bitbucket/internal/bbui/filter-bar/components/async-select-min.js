define("bitbucket/internal/bbui/filter-bar/components/async-select","module exports classnames jquery lodash prop-types react react-dom bitbucket/internal/util/navigator ../../aui-react/spinner ./filter".split(" "),function(q,k,l,r,t,u,v,w,x,y,z){Object.defineProperty(k,"__esModule",{value:!0});var p=babelHelpers.interopRequireDefault(l),m=babelHelpers.interopRequireDefault(r),A=babelHelpers.interopRequireDefault(t),d=babelHelpers.interopRequireDefault(u),g=babelHelpers.interopRequireDefault(v),e=
babelHelpers.interopRequireDefault(w),n=babelHelpers.interopRequireDefault(y);l=function(k){function f(){var b;babelHelpers.classCallCheck(this,f);for(var a=arguments.length,c=Array(a),h=0;h<a;h++)c[h]=arguments[h];a=babelHelpers.possibleConstructorReturn(this,(b=f.__proto__||Object.getPrototypeOf(f)).call.apply(b,[this].concat(c)));a._state={pendingItems:[],pendingQuery:null,term:"",searchBoxSpinnerContainer:document.createElement("div"),moreResultsEl:null};return a}babelHelpers.inherits(f,k);babelHelpers.createClass(f,
null,[{key:"propTypes",get:function(){return{id:d.default.string.isRequired,label:d.default.string.isRequired,loading:d.default.bool,menu:d.default.any,onChange:d.default.func,onMoreItemsRequested:d.default.func.isRequired,onResetRequested:d.default.func.isRequired,onTermChanged:d.default.func.isRequired,searchPlaceholder:d.default.string,value:d.default.string}}}]);babelHelpers.createClass(f,[{key:"componentDidMount",value:function(){var b=this,a={allowClear:!0,containerCssClass:(0,p.default)("filter-bar-async",
this.props.menu.containerCssClass),dropdownCssClass:(0,p.default)("filter-bar-async","filter-bar-dropdown-"+this.props.id,this.props.menu.dropdownCssClass),query:function(a){if(!b._state.pendingQuery||a.page!==b._state.pendingQuery.page||a.term!==b._state.pendingQuery.term){if(1>=a.page||b._state.pendingQuery)b.props.onResetRequested();if(b._state.term!==a.term)b.props.onTermChanged(a.term);b._setState({pendingQuery:a,term:a.term,moreResultsEl:document.getElementsByClassName("select2-more-results")[0]},
function(c){b.props.onMoreItemsRequested(function(h){c.pendingQuery===a&&b._setState({pendingItems:c.pendingItems.concat(h)})})})}},formatLoadMore:function(){return" "},formatResult:function(a,c){e.default.render(b.props.menu.formatResult(a),c[0])},formatSelection:function(a,c){e.default.render(b.props.menu.formatSelection(a),c[0])},ajax:void 0},c=this.get$Input();c.auiSelect2(A.default.assign({minimumInputLength:0,minimumResultsForSearch:0,dropdownAutoWidth:!0,formatSearching:function(){return AJS.I18n.getText("bitbucket.component.filter.bar.searching")},
formatNoMatches:function(){return AJS.I18n.getText("bitbucket.component.filter.bar.nomatches")}},this.props.menu,a));c.on("change",function(){return b.props.onChange()});c.on("select2-opening",function(a){c.select2("val")&&(a.preventDefault(),e.default.unmountComponentAtNode(c.select2("container").find(".select2-chosen")[0]),c.select2("val","",!0))});if(this.props.searchPlaceholder&&!(0,x.isIE)())c.one("select2-open",function(){(0,m.default)(".filter-bar-dropdown-"+b.props.id+" .select2-search \x3e input").attr("placeholder",
b.props.searchPlaceholder).after(b._state.searchBoxSpinnerContainer);b.props.loading&&e.default.render(g.default.createElement(n.default,null),b._state.searchBoxSpinnerContainer)})}},{key:"_setState",value:function(){var b=arguments[1],a=babelHelpers.extends({},this._state,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{});this.reconcileComponent(this.props,a);this._state=a;b&&b(a)}},{key:"reconcileComponent",value:function(b,a){if(b.loading&&a.pendingQuery)1>=a.pendingQuery.page&&a.searchBoxSpinnerContainer.parentNode&&
e.default.render(g.default.createElement(n.default,null),a.searchBoxSpinnerContainer),a.moreResultsEl&&e.default.render(g.default.createElement(n.default,null),a.moreResultsEl);else if(!b.loading&&this._state.pendingQuery&&a.pendingQuery){a.moreResultsEl&&e.default.unmountComponentAtNode(a.moreResultsEl);a.searchBoxSpinnerContainer.children.length&&e.default.unmountComponentAtNode(a.searchBoxSpinnerContainer);var c=a.pendingQuery,d=a.pendingItems,f=!b.allFetched;this._setState({pendingQuery:null,
pendingItems:[]},function(){c.callback({context:c.context,results:d,more:f})})}}},{key:"shouldComponentUpdate",value:function(b){this.reconcileComponent(b,this._state);return!1}},{key:"get$Input",value:function(){return(0,m.default)(e.default.findDOMNode(this)).children("input")}},{key:"render",value:function(){return g.default.createElement("li",null,g.default.createElement("label",{htmlFor:this.props.id,className:"assistive"},this.props.label),g.default.createElement("input",{type:"hidden",id:this.props.id,
value:this.props.value||""}))}},{key:"value",value:function(){return this.props.value}},{key:"domValue",value:function(){return this.get$Input().val()}},{key:"set",value:function(b){var a=this.get$Input();e.default.unmountComponentAtNode(a.select2("container").find(".select2-chosen")[0]);a.select2("val",b);return m.default.Deferred().resolve()}}]);return f}(babelHelpers.interopRequireDefault(z).default);k.default=l;q.exports=k["default"]});