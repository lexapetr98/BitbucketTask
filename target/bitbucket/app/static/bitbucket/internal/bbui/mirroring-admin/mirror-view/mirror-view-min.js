define("bitbucket/internal/bbui/mirroring-admin/mirror-view/mirror-view","module exports @atlassian/aui jquery lodash bitbucket/internal/impl/request ../../widget/widget ../nav-builder".split(" "),function(p,g,f,h,q,r,t,k){Object.defineProperty(g,"__esModule",{value:!0});var e=babelHelpers.interopRequireDefault(h),l=babelHelpers.interopRequireDefault(q),m=babelHelpers.interopRequireDefault(r);h=babelHelpers.interopRequireDefault(t);var n=babelHelpers.interopRequireDefault(k);k=function(g){function d(a,
c){babelHelpers.classCallCheck(this,d);var b=babelHelpers.possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c));b.$el=(0,e.default)(a);b.$el.html(bitbucket.internal.component.mirroringAdmin.mirrorView.main(c));b.$panel=b.$el.find("#mirror-details-panel");b.mirror=b.options.item;b.init();return b}babelHelpers.inherits(d,g);babelHelpers.createClass(d,[{key:"destroy",value:function(){babelHelpers.get(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"destroy",this).call(this);
this.loadingPanelRequest&&(this.loadingPanelRequest.abort(),delete this.loadingPanelRequest);this._cancelLoadingTimer();this.$el.empty();delete this.$el}},{key:"init",value:function(){var a=this;(0,e.default)("#mirror-remove-button").on("click",this.showRemoveMirrorDialog);this.$panel.on("click","#mirror-reload",function(c){c.preventDefault();a.showMirrorPanel()});this.showMirrorPanel()}},{key:"showRemoveMirrorDialog",value:function(){var a=this,c=(0,e.default)(bitbucket.internal.component.mirroringAdmin.mirrorView.deleteDialog({mirrorName:this.mirror.name}));
this.$el.append(c);var b=(0,f.dialog2)("#delete-mirror-dialog");b.on("hide",function(){c.remove()});c.find("#dialog-delete-button").click(function(){a.removeMirror();b.hide()});c.find("#dialog-cancel-button").click(function(){return b.hide()});b.show()}},{key:"showMirrorPanel",value:function(){var a=this;this._delayShowLoadingSpinner();this.loadingPanelRequest=m.default.rest({type:"GET",dataType:"html",url:n.default.rest().mirroring().panel(this.mirror.id).build(),statusCode:{"*":!1}}).always(function(){a._hideLoadingSpinner();
delete a.loadingPanelRequest}).done(function(c){a.$panel.html(c)}).fail(function(c,b){"abort"!==b&&a._renderErrorView()})}},{key:"removeMirror",value:function(){var a=this;d._showRemoveSpinner();m.default.rest({type:"DELETE",url:n.default.rest().mirroring().path("mirrorServers",this.mirror.id).build(),statusCode:{409:!1}}).done(function(c){a._removeMirrorSuccessful();a.trigger("mirror-removed",{id:a.mirror.id,type:"mirror",responseJSON:c})}).fail(function(c){var b=l.default.get(c,"responseJSON.errors");
if(b)return a._removeMirrorFailed(b);throw c;}).always(d._stopRemoveSpinner)}},{key:"_removeMirrorFailed",value:function(a){(0,f.flag)({type:"error",title:f.I18n.getText("bitbucket.component.mirroring.admin.mirror.remove.failure",this.mirror.name),body:a.map(function(a){return(0,f.escapeHtml)(a.message)}).join(",")})}},{key:"_removeMirrorSuccessful",value:function(){(0,f.flag)({type:"success",title:f.I18n.getText("bitbucket.component.mirroring.admin.mirror.remove.success",this.mirror.name),persistent:!1,
close:"auto",body:""})}},{key:"_renderErrorView",value:function(){this.$panel.html(bitbucket.internal.component.mirroringAdmin.mirrorView.mirrorConnectionError())}},{key:"_delayShowLoadingSpinner",value:function(){var a=this;this.loadingSpinnerTimer=window.setTimeout(function(){a.$panel.html(bitbucket.internal.component.mirroringAdmin.mirrorView.loading());a.$panel.find("#mirror-loading").spin("large");delete a.loadingSpinnerTimer},500)}},{key:"_hideLoadingSpinner",value:function(){this.$panel.find("#mirror-loading").spinStop();
this._cancelLoadingTimer()}},{key:"_cancelLoadingTimer",value:function(){l.default.isNumber(this.loadingSpinnerTimer)&&(window.clearTimeout(this.loadingSpinnerTimer),delete this.loadingSpinnerTimer)}}],[{key:"_showRemoveSpinner",value:function(){(0,e.default)("#mirror-remove-button").addClass("hidden");(0,e.default)("#mirror-remove-button-spinner").removeClass("hidden").spin()}},{key:"_stopRemoveSpinner",value:function(){(0,e.default)("#mirror-remove-button").removeClass("hidden");(0,e.default)("#mirror-remove-button-spinner").addClass("hidden").spinStop()}}]);
return d}(h.default);g.default=k;p.exports=g["default"]});