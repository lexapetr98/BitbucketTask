define("bitbucket/internal/bbui/mirroring-admin/request-view/request-view","module exports @atlassian/aui jquery lodash bitbucket/internal/impl/request ../../widget/widget ../nav-builder".split(" "),function(l,f,d,h,m,n,p,k){Object.defineProperty(f,"__esModule",{value:!0});var g=babelHelpers.interopRequireDefault(h),q=babelHelpers.interopRequireDefault(m),r=babelHelpers.interopRequireDefault(n);h=babelHelpers.interopRequireDefault(p);var t=babelHelpers.interopRequireDefault(k);k=function(f){function e(c,
a){babelHelpers.classCallCheck(this,e);var b=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a));b.$el=(0,g.default)(c);b.$el.html(bitbucket.internal.component.mirroringAdmin.requestView.main(a));b.item=a.item;b.$el.find("#approve-mirror-button").on("click",b.approveMirrorButtonClicked);b.$el.find("#decline-mirror-button").on("click",b.declineMirrorButtonClicked);return b}babelHelpers.inherits(e,f);babelHelpers.createClass(e,[{key:"destroy",value:function(){babelHelpers.get(e.prototype.__proto__||
Object.getPrototypeOf(e.prototype),"destroy",this).call(this);this.$el.empty();this.item=this.$el=null}},{key:"approveMirrorButtonClicked",value:function(c){c.preventDefault();this.resolveRequest("accept",this.$el.find("#all-projects-radio").is(":checked")?"all_projects":"selected_projects")}},{key:"confirmDeclineMirror",value:function(){var c=this,a=(0,g.default)(bitbucket.internal.component.mirroringAdmin.requestView.declineDialog({mirrorName:this.item.mirrorName}));this.$el.append(a);var b=(0,
d.dialog2)("#decline-mirror-request-dialog");b.on("hide",function(){a.remove()});a.find("#dialog-decline-button").click(function(){c.resolveRequest("reject");b.hide()});a.find("#dialog-cancel-button").click(function(){return b.hide()});b.show()}},{key:"declineMirrorButtonClicked",value:function(c){c.preventDefault();this.confirmDeclineMirror()}},{key:"resolveRequest",value:function(c,a){var b=this,d=this.item.id;this._showSpinner();r.default.rest({type:"POST",url:t.default.rest().mirroring().path("requests",
d,c).params(a?{mirroringMode:a}:null).build(),statusCode:{"*":!1}}).done(function(a){b._mirrorRequestActionSuccess(c);b.trigger("request-resolved",{id:d,type:"request",resolution:c,responseJSON:a})}).fail(function(a){var d=q.default.get(a,"responseJSON.errors");if(d)return b._mirrorRequestActionFailed(c,d);throw a;}).always(this._stopSpinner)}},{key:"_mirrorRequestActionFailed",value:function(c,a){var b=this.item.mirrorName;(0,d.flag)({type:"error",title:"accept"===c?d.I18n.getText("bitbucket.component.mirroring.admin.request.view.flags.request.approve.failure",
b):d.I18n.getText("bitbucket.component.mirroring.admin.request.view.flags.request.reject.failure",b),body:a.map(function(a){return(0,d.escapeHtml)(a.message)}).join(",")})}},{key:"_mirrorRequestActionSuccess",value:function(c){var a=this.item.mirrorName;(0,d.flag)({type:"success",title:"accept"===c?d.I18n.getText("bitbucket.component.mirroring.admin.request.view.flags.request.approve.success",a):d.I18n.getText("bitbucket.component.mirroring.admin.request.view.flags.request.reject.success",a),persistent:!1,
close:"auto",body:""})}},{key:"_showSpinner",value:function(){(0,g.default)("#mirror-action-button-spinner").spin()}},{key:"_stopSpinner",value:function(){(0,g.default)("#mirror-action-button-spinner").spinStop()}}]);return e}(h.default);f.default=k;l.exports=f["default"]});