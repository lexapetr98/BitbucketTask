define("bitbucket/internal/util/string-replacer",["module","exports","lodash"],function(k,f,g){Object.defineProperty(f,"__esModule",{value:!0});var h=babelHelpers.interopRequireDefault(g);g=function(){function f(){babelHelpers.classCallCheck(this,f);this.replacers=[]}babelHelpers.createClass(f,[{key:"registerReplacer",value:function(d){this.replacers.push({replacer:d,weight:1<arguments.length&&void 0!==arguments[1]?arguments[1]:1E3});return this.replacers.sort(function(a,b){return a.weight-b.weight})}},
{key:"occurrenceIndexes",value:function(d,a){var b=a.find;a=!1!==a.multiple;for(var c=[],e=-1;(-1===e||a)&&-1!==(e=d.indexOf(b,e+1));)c.push(e);return c}},{key:"addIndexes",value:function(d,a){var b=this;return h.default.flattenDeep(a.map(function(c){c=babelHelpers.slicedToArray(c,2);var a=c[0];return c[1].map(function(c){return b.occurrenceIndexes(d,c).map(function(b){return{weight:a.weight,start:b,end:b+c.find.length,replacement:c}})})}))}},{key:"sortByWeightOrPosition",value:function(d){return d.sort(function(a,
b){return a.weight-b.weight||a.start-b.start})}},{key:"sortByPosition",value:function(d){return d.sort(function(a,b){return a.start-b.start})}},{key:"dedupe",value:function(d,a){return a.reduce(function(a,c){return a.some(function(a){return a.start<=c.start&&a.end>c.start||c.start<=a.start&&c.end>a.start})?a:a.concat(c)},[])}},{key:"replace",value:function(d,a,b){"undefined"===typeof b&&(b=function(a){return a});if(!a.length)return b(d);a=a.reduce(function(a,e){a.pointer<e.start&&a.replacements.push(b(d.substring(a.pointer,
e.start)));a.replacements.push(e.replacement.replace);return{pointer:e.end,replacements:a.replacements}},{pointer:0,replacements:[]});a.pointer<d.length&&a.replacements.push(b(d.substring(a.pointer,d.length)));return a.replacements.join("")}},{key:"process",value:function(d,a,b){var c=this,e=this.replacers.map(function(c){var b=c.replacer;return b(d,a).catch(function(a){console.error(a,b," failed");return[]})});return Promise.all(e).then(function(a){return c.addIndexes(d,h.default.zip(c.replacers,
a))}).then(this.sortByWeightOrPosition).then(function(a){return c.dedupe(d,a)}).then(this.sortByPosition).then(function(a){return c.replace(d,a,b)})}}]);return f}();f.default=g;k.exports=f["default"]});