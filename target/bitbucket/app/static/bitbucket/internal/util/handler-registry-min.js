define("bitbucket/internal/util/handler-registry",["module","exports","jquery","lodash"],function(n,c,p,q){function b(){this.handlers=[]}Object.defineProperty(c,"__esModule",{value:!0});var g=babelHelpers.interopRequireDefault(p),e=babelHelpers.interopRequireDefault(q);b.prototype.register=function(a){if(!e.default.isFunction(a.handle))throw Error("Handler must have a handle function");a.weight="number"!==typeof a.weight||isNaN(a.weight)?1E3:a.weight;this.handlers.push(a);this.handlers=e.default.sortBy(this.handlers,
function(a){return a.weight});var k=this;return function(){var b=k.handlers.indexOf(a);0<=b&&k.handlers.splice(b,1)}};b.prototype._handle=function(a){function b(a){if(h)return f.reject(Error("Handling aborted."));if(a<l.length)return d=l[a].handle(e)||g.default.Deferred().reject(),g.default.when(d).done(function(a){f.resolve(a||{},m)}).fail(function(c){c&&m.push(c);b(a+1)});f.reject(Error("No registered handlers were able to handle file"))}var c=a.useDefaultHandler,e=babelHelpers.objectWithoutProperties(a,
["useDefaultHandler"]),f=g.default.Deferred(),h,d,l=c?this.handlers.filter(function(a){return a.builtIn}):this.handlers,m=[];b(0);return f.promise({abort:function(){!h&&d&&d.abort&&d.abort();h=!0}})};b.prototype._clear=function(){this.handlers=[]};c.default=b;n.exports=c["default"]});