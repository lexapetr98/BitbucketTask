define("bitbucket/internal/util/rest-actor",["exports","lodash","bitbucket/util/server"],function(a,f,d){Object.defineProperty(a,"__esModule",{value:!0});a.restActorForType=a.requestFailure=a.requestSuccess=a.REQUEST_SUCCESS=a.REQUEST_FAILURE=a.duplicateStrategy=void 0;a.duplicateStrategy={ABORT_OLD:"ABORT_OLD",DEFAULT:"DEFAULT",DROP_NEW:"DROP_NEW"};var l=a.REQUEST_FAILURE="REQUEST_FAILURE",n=a.REQUEST_SUCCESS="REQUEST_SUCCESS",p=a.requestSuccess=function(a,d,b){return function(e){return b({type:(0,
f.get)(a,"meta.successType",n),payload:e,meta:{originalAction:a,request:d}})}},r=a.requestFailure=function(a,d,b){return function(e,g,h,q){return b({type:(0,f.get)(a,"meta.failureType",l),payload:{textStatus:g,err:h,response:q},meta:{originalAction:a,request:d}})}};a.restActorForType=function(a,l){var b,e=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).duplicateStrategy,g=void 0===e?"DEFAULT":e,h=(b={},babelHelpers.defineProperty(b,d.method.DELETE,{}),babelHelpers.defineProperty(b,d.method.GET,
{}),babelHelpers.defineProperty(b,d.method.PATCH,{}),babelHelpers.defineProperty(b,d.method.POST,{}),babelHelpers.defineProperty(b,d.method.PUT,{}),b);return function(b,e){if(b.type===a){var c=l(b);c.type=c.type||d.method.GET;var k=(0,f.get)(h,[c.type,c.url]);if("DROP_NEW"!==g||!k){"ABORT_OLD"===g&&k&&k.abort&&k.abort();var m=(0,d.rest)(c).done(p(b,c,e)).fail(r(b,c,e));"DROP_NEW"!==g&&"ABORT_OLD"!==g||(0,f.set)(h,[c.type,c.url],m.always(function(){(0,f.get)(h,[c.type,c.url])===m&&(0,f.unset)(h,[c.type,
c.url])}))}}}}});