define("bitbucket/internal/util/client-storage","module exports jquery lodash bitbucket/internal/model/page-state bitbucket/internal/util/feature-detect".split(" "),function(z,u,A,B,C,D){function v(a,b){g.default.isString(a)&&(a=[a]);if(!g.default.isArray(a))throw Error("keyBuilder requires an array of components");if(b)switch(a.push(b),b){case f.PULL_REQUEST:a.push(h.default.getPullRequest()&&h.default.getPullRequest().getId());case f.REPO:a.push(h.default.getRepository()&&h.default.getRepository().getSlug());
case f.PROJECT:a.push(h.default.getProject()&&h.default.getProject().getKey());case f.USER:a.push(h.default.getCurrentUser()&&h.default.getCurrentUser().getName())}return a.join("_")}function n(a,b){var c=void 0;a=w.default.localStorage()?window[(b||d.LOCAL)+"Storage"].getItem(a):g.default.has(l,a)?l[a]:null;try{c=JSON.parse(a)}catch(e){c=a}return c}function m(a,b){a=n(a,b);return E.default.isPlainObject(a)&&g.default.has(a,"data")?a.data:a}function x(a,b,c){if(!b||!g.default.includes(k,b))throw Error("getItemProgressively requires a context to be specified");
var e=v(a,b);if("user"===b)return m(e,c);b=k[k.indexOf(b)+1];return m(e,c)||x(a,b,c)}function p(a,b,c){if(w.default.localStorage())try{window[(c||d.LOCAL)+"Storage"].setItem(a,JSON.stringify(b))}catch(e){if(22===e.code||1014===e.code)console.warn("WARN: Ran out of space in localStorage"),q()&&p(a,b,c);else throw e;}else l[a]=JSON.stringify(b)}function r(a,b,c,e){b=g.default.assign({},c,{timestamp:(new Date).getTime(),data:b});p(a,b,e);e&&e!==d.LOCAL||g.default.defer(F)}function t(a,b){w.default.localStorage()?
window[(b||d.LOCAL)+"Storage"].removeItem(a):delete l[a]}function y(a){t("_flash."+a,d.SESSION)}function F(){if(!n("hasCheckedCleanUp",d.SESSION)){var a=n("lastCleanup");(!a||24192E5<(new Date).getTime()-a)&&q();p("hasCheckedCleanUp",!0,d.SESSION)}}function q(a){a=a||24192E5;var b=(new Date).getTime(),c=Object.keys(localStorage).length;Object.keys(localStorage).forEach(function(c){if("lastCleanup"!==c){var d=n(c);d&&d.timestamp&&!d.noCleanup&&b-d.timestamp>a&&t(c)}});p("lastCleanup",(new Date).getTime());
c-=Object.keys(localStorage).length;return!c&&6048E5<=a-6048E5?q(a-6048E5):c}Object.defineProperty(u,"__esModule",{value:!0});var E=babelHelpers.interopRequireDefault(A),g=babelHelpers.interopRequireDefault(B),h=babelHelpers.interopRequireDefault(C),w=babelHelpers.interopRequireDefault(D),d={SESSION:"session",LOCAL:"local"},f={PULL_REQUEST:"pull-request",REPO:"repo",PROJECT:"project",USER:"user"},k=[f.PULL_REQUEST,f.REPO,f.PROJECT,f.USER],l={};u.default={_doCleanup:q,LOCAL:d.LOCAL,SESSION:d.SESSION,
_resetDummy:function(){l={}},buildKey:v,contexts:f,getItem:m,getItemProgressively:x,getFlashItem:function(a){var b=m("_flash."+a,d.SESSION);y(a);return b},getSessionItem:function(a){return m(a,d.SESSION)},setItem:r,setItemProgressively:function(a,b,c){if(!b||!g.default.includes(k,b))throw Error("setItemProgressively requires a context to be specified");k.slice(k.indexOf(b)).forEach(function(b){r(v(a,b),c)})},setFlashItem:function(a,b,c){r.call(this,"_flash."+a,b,c,d.SESSION)},setSessionItem:function(a,
b,c){r.call(this,a,b,c,d.SESSION)},removeItem:t,removeFlashItem:y,removeSessionItem:function(a){t(a,d.SESSION)}};z.exports=u["default"]});