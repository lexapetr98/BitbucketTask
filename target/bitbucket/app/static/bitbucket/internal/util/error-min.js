define("bitbucket/internal/util/error","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/model/page-state bitbucket/internal/util/function bitbucket/internal/util/navigator".split(" "),function(B,m,C,D,E,F,G,H,I){function d(a,b,e,c,d){this._out={title:a,message:b,details:e,context:c,level:d||n.ERROR,fallbackUrl:void 0,fallbackTitle:void 0,shouldLogin:!1,shouldReload:!1,canRetry:!1,shouldRetry:!1,retryAfterDate:void 0}}function u(a,b,e,f){var g;if(g=401===b||
200<=b&&400>b)g=null==e||null==f?(e||null)===(f||null):null!=e.id&&null!=f.id?e.id===f.id:e.name===f.name,g=!g;if(g){if(401===b)a=(new d).doAccessDenied(null!=e);else if((g=e)||(g=!(204===b&&(0,I.isIE)()&&!a.getAllResponseHeaders())),g)a=(new d)[e?"shouldReload":"shouldLogin"]();else return null;if(f){if(!e)return a.title(c.default.I18n.getText("bitbucket.web.error.logged.out.title")).message(c.default.I18n.getText("bitbucket.web.error.logged.out")).build();if(401===b)return a.message(c.default.I18n.getText("bitbucket.web.error.logged.in.as.other.and.denied",
'"'+f.name+'"','"'+e.name+'"')).build()}else return 401===b?a.message(c.default.I18n.getText("bitbucket.web.error.logged.in.and.denied",'"'+e.name+'"')).build():a.title(c.default.I18n.getText("bitbucket.web.error.logged.in.title")).message(c.default.I18n.getText("bitbucket.web.error.logged.in",'"'+e.name+'"')).build();return a.title(c.default.I18n.getText("bitbucket.web.error.user.changed.title")).message(c.default.I18n.getText("bitbucket.web.error.logged.in.as.other",'"'+f.name+'"','"'+e.name+'"')).build()}return null}
function v(a){var b=a.getResponseHeader("X-AUSERID");a=a.getResponseHeader("X-AUSERNAME");return null!=a?{id:null!=b?parseInt(b,10):null,name:decodeURIComponent(a)}:null}function w(a,b,e){var f=Number(a.status);e=void 0!==e?e:l.default.getCurrentUser()?l.default.getCurrentUser().toJSON():null;b=void 0!==b?b:v(a);if(b=u(a,f,b,e))return b;if(0===f||400<=f&&600>f)switch(f){case 401:return(new d).doAccessDenied(!!e).build();case 404:return(new d).doNotFound().build();case 0:if(p&&"abort"!==a.statusText&&
100<(new Date).getTime()-x)return(new d).doServerDown().build();break;case 502:return(new d).doServerDown().build();case 503:return(new d).doRequestThrottled(a.getResponseHeader("Retry-After")).build();default:return(new d(null,c.default.I18n.getText("bitbucket.web.we.screwed.up"))).shouldReload().build()}return null}function y(a){(0,h.default)(a).find(".error").remove()}Object.defineProperty(m,"__esModule",{value:!0});var c=babelHelpers.interopRequireDefault(C),h=babelHelpers.interopRequireDefault(D),
q=babelHelpers.interopRequireDefault(E),z=babelHelpers.interopRequireDefault(F),l=babelHelpers.interopRequireDefault(G),A=babelHelpers.interopRequireDefault(H),p=!1,x=0;(0,h.default)(document).ready(function(){p=!0;var a=window.onbeforeunload;window.onbeforeunload=function(){p=!1;return a?a.apply(this,arguments):void 0}}).on("keydown",function(a){a.keyCode===c.default.keyCode.ESCAPE&&(x=(new Date).getTime())});var r=function(a,b){(0,h.default)(aui.message.error({content:c.default.escapeHtml(b)})).appendTo(a)},
n={INFO:"INFO",WARNING:"WARNING",ERROR:"ERROR",SUCCESS:"SUCCESS"};d.prototype.title=function(a){this._out.title=a;return this};d.prototype.message=function(a){this._out.message=a;return this};d.prototype.details=function(a){this._out.details=a;return this};d.prototype.context=function(a){this._out.context=a;return this};d.prototype.level=function(a){this._out.level=a||a.ERROR;return this};d.prototype.shouldLogin=function(){this._out.shouldLogin=!0;return this};d.prototype.shouldReload=function(){this._out.shouldReload=
!0;return this};d.prototype.shouldRetry=function(){this._out.shouldRetry=!0;return this.canRetry()};d.prototype.canRetry=function(){this._out.canRetry=!0;return this};d.prototype.fallbackUrl=function(a,b){this._out.fallbackUrl=a;this._out.fallbackTitle=b;return this};d.prototype.retryAfterDate=function(a){this._out.retryAfterDate=isNaN(a)?void 0:a;this._out.retryAfterDate&&this.shouldRetry();return this};d.prototype.doAccessDenied=function(a){this.title(this._out.title||k["401"]);a?(this.message(this._out.message||
c.default.I18n.getText("bitbucket.web.error.no.permission")),this.fallbackUrl(z.default.dashboard().build(),c.default.I18n.getText("bitbucket.web.ajax.back.to.dashboard"))):(this.message(this._out.message||c.default.I18n.getText("bitbucket.web.error.anonymous.disallowed")),this.shouldLogin());return this};d.prototype.doServerDown=function(){this.title(this._out.title||k["0"]);this.message(this._out.message||t["0"]);this.canRetry();return this};d.prototype.doRequestThrottled=function(a){this.title(this._out.title||
k["503"]);this.message(this._out.message||t["503"]);this.canRetry();this.retryAfterDate(isNaN(Number(a))?new Date(Date.parse(a)):new Date((new Date).getTime()+1E3*Number(a)));return this};d.prototype.doNotFound=function(a,b){this.title(this._out.title||k["404"]);this.message(this._out.message||t["404"]);this.fallbackUrl(a||this._out.fallbackUrl||z.default.dashboard().build(),b||this._out.fallbackTitle||c.default.I18n.getText("bitbucket.web.ajax.back.to.dashboard"));return this};d.prototype.build=
function(){this._out.title||this.title(c.default.I18n.getText("bitbucket.web.dialog.ajax.error.title"));return this._out};var k={401:c.default.I18n.getText("bitbucket.web.dialog.ajax.error.not.permitted.title"),404:c.default.I18n.getText("bitbucket.web.couldnt.find.title"),502:c.default.I18n.getText("bitbucket.web.server.unreachable.title"),0:c.default.I18n.getText("bitbucket.web.server.unreachable.title"),503:c.default.I18n.getText("bitbucket.web.server.busy.title")},t={404:c.default.I18n.getText("bitbucket.web.couldnt.find"),
502:c.default.I18n.getText("bitbucket.web.error.server.unresponsive"),0:c.default.I18n.getText("bitbucket.web.error.server.unresponsive"),503:c.default.I18n.getText("bitbucket.web.error.too.much.load")};m.default={showNonFieldErrors:function(a){var b=(0,h.default)("#content \x3e header \x3e .notifications").empty();"string"===typeof a?r(b,a):a&&a.length?(a=q.default.filter(a,A.default.not(A.default.dot("context"))),a.length&&q.default.forEach(a,function(a){r(b,a&&a.message?a.message:a)})):r(b,c.default.I18n.getText("bitbucket.web.unknownerror"))},
isErrorEntityWithinRepository:function(a){return a&&/branch|tag|repository object|commit|revision|comment/i.test(a.message)},level:n,getDominantAJAXError:w,getDominantRESTError:function(a,b){var c=l.default.getCurrentUser()?l.default.getCurrentUser().toJSON():null;if(b){var f=Number(b.status);var g=v(b);var h=u(b,f,g,c);if(h)return h}if(a&&a.errors&&a.errors.length){a=a.errors[0];a=new d(a.title||k[f],a.message,a.details,a.context,a.level||n.ERROR);switch(f){case 401:a.doAccessDenied(null!=c);break;
case 404:a.doNotFound();break;case 409:a.shouldReload();break;case 503:a.doRequestThrottled(b.getResponseHeader("Retry-After"))}return a.build()}return b?w(b,g,c):null},setFormErrors:function(a,b){var d=(0,h.default)(a);y(d);(a=q.default.chain(b).filter(function(a){if(!a.message)return!1;if(a.context){var b=d.find('[name\x3d"'+a.context+'"]').closest(".field-group");if(b.length)return(0,h.default)(document.createElement("div")).addClass("error").text(a.message).appendTo(b),!1}return!0}).map("message").map(c.default.escapeHtml).value().join("\x3cbr\x3e"))&&
d.prepend(aui.message.error({content:a}))},clearFormErrors:y};B.exports=m["default"]});