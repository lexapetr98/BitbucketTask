define("bitbucket/internal/util/region-scroll-forwarder","module exports baconjs jquery lodash bitbucket/internal/util/bacon bitbucket/internal/util/function".split(" "),function(l,f,t,u,v,w,x){Object.defineProperty(f,"__esModule",{value:!0});var p=babelHelpers.interopRequireDefault(t),y=babelHelpers.interopRequireDefault(u),d=babelHelpers.interopRequireDefault(v),q=babelHelpers.interopRequireDefault(w),r=babelHelpers.interopRequireDefault(x);f.default=function(g,c){function f(a,b){d.default.chain(a).filter(function(b,
a,c){return!d.default.some(c.slice(0,a),function(a){return b.groupId&&b.groupId===a.groupId})}).forEach(function(a){a.setScrollTop("bottom"===b(a)?a.getCachedHeight():0)}).value()}var n=new p.default.Bus;c=c.map(function(a){var b=null;return y.default.extend({},a,{getCachedHeight:function(){null==b&&(b=a.getHeight());return b},invalidateCache:function(){b=null}})});var e;g.subscribe(function(a){if(a.isInitial()){var b=a.value().top,m=0,e;d.default.forEach(c,function(a){var c=a.getCachedHeight(),d=
m+c>=b;!e&&d?(e=a,a.setScrollTop(b-m)):a.setScrollTop(d?0:c);m+=c})}})();g=g.takeUntil(n).slidingWindow(2,2).map(r.default.spread(function(a,b){var e=0,f,g=b.top-a.top,h,k=0;d.default.some(c,function(c){var d=c.getCachedHeight();!h&&k+d>=b.top&&(h=c,e=k);!f&&k+d>=a.top&&(f=c);k+=d;return h&&f});if(!h)throw Error("No forwardee handles "+b.top);return{scrollInfo:b,localTop:b.top-e,diff:g,forwardTo:h,previousRegion:f}}));var l=g.onValue(function(a){e=a;var b=a.previousRegion;if(b!==a.forwardTo){b=q.default.toArray(q.default.takeBetween(p.default.fromArray(c),
{start:b,end:a.forwardTo,startInclusive:!0,endInclusive:!1}));var d=0<a.diff;f(d?b.reverse():b,r.default.constant(d?"bottom":"top"))}a.forwardTo.setScrollTop(a.localTop)});return{regionChanges:g.map(".forwardTo").skipDuplicates(),forwardingInfo:g,heightsChanged:function(){d.default.invokeMap(c,"invalidateCache");if(e){var a=d.default.indexOf(c,e.forwardTo);f(d.default.reject(c,function(a){return a===e.forwardTo||a.groupId&&a.groupId===e.forwardTo.groupId}),function(b){return d.default.indexOf(c,b)<
a?"bottom":"top"});e.forwardTo.setScrollTop(Math.min(e.localTop,e.forwardTo.getCachedHeight()))}},destroy:function(){l();n.push(!0);n.end()}}};l.exports=f["default"]});