define("bitbucket/internal/page/admin/users/useredit","module exports @atlassian/aui jquery lodash bitbucket/util/navbuilder bitbucket/internal/feature/user/user-groups-table/user-groups-table bitbucket/internal/util/ajax bitbucket/internal/util/browser-location bitbucket/internal/util/error bitbucket/internal/util/notifications/notifications bitbucket/internal/widget/confirm-dialog/confirm-dialog bitbucket/internal/widget/delete-dialog/delete-dialog bitbucket/internal/widget/submit-spinner/submit-spinner bitbucket/internal/widget/user-avatar-form/user-avatar-form".split(" "),
function(y,n,d,z,A,B,C,D,p,E,F,G,H,I,J){function h(c,a){a=a||"info";(0,d.flag)({type:a,title:c,close:"auto"})}function u(c,a){(0,b.default)(c).parent(".field-group").append((0,b.default)("\x3cspan class\x3d'error'\x3e\x3c/span\x3e").text(a))}function q(){(0,b.default)(".panel-details .error, .content-body .notifications \x3e .error").remove()}function l(c){r.default.isArray(c)?r.default.forEach(c,function(a){a.message&&a.context&&"email"===a.context?u("#email",a.message):a.message&&a.context&&"displayName"===
a.context?u("#fullname",a.message):a.message?h(a.message,"error"):h(a,"error")}):r.default.isString(c)&&h(c,"error")}function K(c){L.default.bind(c,d.I18n.getText("bitbucket.web.user.delete"),d.I18n.getText("bitbucket.web.user.delete.success"),d.I18n.getText("bitbucket.web.user.delete.fail"),function(a){t.default.addFlash(d.I18n.getText("bitbucket.web.user.delete.success",a));window.location=v.default.admin().users().build();return!1},function(){return(0,b.default)("#fullname").val()})}function M(c){var a=
new N.default({id:"clear-captcha-dialog",titleText:d.I18n.getText("bitbucket.web.user.captcha.clear"),panelContent:bitbucket.internal.admin.users.clearCaptchaDialog({displayName:(0,b.default)("#fullname").val()}),submitText:d.I18n.getText("bitbucket.web.button.clear")},{type:"DELETE"});a.attachTo(c);a.addConfirmListener(function(f){f.done(function(){(0,b.default)(c).remove();a.destroy();h(d.I18n.getText("bitbucket.web.user.captcha.cleared"),"success")})})}function O(c,a){function f(a){var e=(new w.default(a.$el.find(".confirm-button"),
"before")).show(),g=a.$el.find("form"),b=k.default.formToJSON(g);m(a,!0);k.default.rest({url:g.attr("action"),type:"PUT",data:babelHelpers.extends({name:c.name},b),statusCode:{"*":!1}}).always(function(){e.remove()}).done(function(){a.hide();h(d.I18n.getText("bitbucket.web.user.password.update.success"),"success")}).fail(function(c,e,P,b){m(a,!1);x.default.setFormErrors(g,b&&b.errors&&b.errors[0]&&b.errors[0].message?b.errors:[{message:d.I18n.getText("bitbucket.web.user.change.password.failure")}])})}
(0,b.default)(a).click(function(a){a.preventDefault();var b=(0,d.dialog2)(bitbucket.internal.admin.users.passwordResetDialog({username:c.name}));b.$el.on("click","#cancel-password-button",function(a){return b.hide()}).on("click","#save-password-button",function(a){return f(b)}).on("keydown",function(a){a.keyCode===d.keyCode.ENTER?(a.preventDefault(),f(b)):a.keyCode===d.keyCode.ESCAPE&&(a.preventDefault(),b.hide())});b.show()})}function m(b,a){b.$el.find("input, button").attr({disabled:a});b.$el.attr("data-aui-modal",
a)}function Q(c,a){function f(a){var b=(new w.default(a.$el.find(".confirm-button"),"before")).show(),e=a.$el.find("form"),f=k.default.formToJSON(e);m(a,!0);k.default.rest({url:e.attr("action"),type:"POST",data:babelHelpers.extends({name:c.name},f),statusCode:{"*":!1}}).always(function(){b.remove()}).done(function(a){t.default.addFlash(d.I18n.getText("bitbucket.web.user.rename.success"));p.location.href=v.default.admin().users().view(a.name).build()}).fail(function(b,c,P,g){m(a,!1);x.default.setFormErrors(e,
g&&g.errors&&g.errors[0]&&g.errors[0].message?g.errors:[{message:d.I18n.getText("bitbucket.web.user.rename.failure")}])})}(0,b.default)(a).click(function(a){a.preventDefault();var b=(0,d.dialog2)(bitbucket.internal.admin.users.renameDialog({username:c.name}));b.$el.on("click","#save-rename-button",function(a){return f(b)}).on("click","#cancel-rename-button",function(a){return b.hide()}).on("keydown",function(a){a.keyCode===d.keyCode.ENTER?(a.preventDefault(),f(b)):a.keyCode===d.keyCode.ESCAPE&&(a.preventDefault(),
b.hide())});b.show()})}function R(){function c(a){a.find("input[type\x3dtext]").each(function(){var a=(0,b.default)(this);a.val(a.data("rollback"))})}function a(a,c){a.find("#fullname").val(c.displayName);a.find("#email").val(c.emailAddress);a.find("input[type\x3dtext]").each(function(){var a=(0,b.default)(this);a.data("rollback",a.val())})}function f(a){a.removeClass("editing").find("#fullname, #email").attr("readonly","readonly");(0,b.default)("#ajax-status-message").empty();q()}(0,b.default)("#edit-details").click(function(a){(0,
b.default)(".panel-details form.editable").addClass("editing").find("#fullname, #email").removeAttr("readonly");"email"!==a.target.id&&(0,b.default)("#fullname",".panel-details form.editable").focus();a.preventDefault()});(0,b.default)(".panel-details form.editable").keyup(function(a){a.which===d.keyCode.ESCAPE&&(0,b.default)("a.cancel",this).click()});(0,b.default)(".cancel",".panel-details form.editable").click(function(a){a.preventDefault();a=(0,b.default)(this).parents("form");c(a);f(a);return!1});
(0,b.default)(".panel-details form.editable").submit(function(c){c.preventDefault();q();var e=(0,b.default)(this),g=e.find("#fullname").val();k.default.rest({url:e.attr("action"),type:"PUT",data:{name:e.find("#name").val(),displayName:g,email:e.find("#email").val()},statusCode:{500:!1,404:!1,401:!1,400:!1}}).done(function(b){a(e,b);f(e);h(d.I18n.getText("bitbucket.web.user.update.success",g),"success")}).fail(function(a,b,c,e){a=e&&e.errors?e.errors:d.I18n.getText("bitbucket.web.user.update.failure");
l(a)})})}Object.defineProperty(n,"__esModule",{value:!0});var b=babelHelpers.interopRequireDefault(z),r=babelHelpers.interopRequireDefault(A),v=babelHelpers.interopRequireDefault(B),S=babelHelpers.interopRequireDefault(C),k=babelHelpers.interopRequireDefault(D),x=babelHelpers.interopRequireDefault(E),t=babelHelpers.interopRequireDefault(F),N=babelHelpers.interopRequireDefault(G),L=babelHelpers.interopRequireDefault(H),w=babelHelpers.interopRequireDefault(I),T=babelHelpers.interopRequireDefault(J);
n.default={onReady:function(c,a){t.default.showFlashes();K(a.deleteLinkSelector);M(a.clearCaptchaLinkSelector);O(c,a.passwordLinkSelector);Q(c,a.renameUserLinkSelector);R();var f=a.avatarFormSelector,e={name:"atl_token",value:(0,b.default)(".user-details-form input[name\x3datl_token]").val()};c=new T.default((0,b.default)(f),c,e);c.on("avatarChanged",q);c.on("avatarUploadError",l);c.on("avatarDeleteError",l);(new S.default({target:a.groupsTableSelector,onError:l})).init();p.location.hash&&(a=(0,b.default)(p.location.hash+
"-tab"),a.length&&d.tabs.change(a))}};y.exports=n["default"]});