define("bitbucket/internal/page/pull-request/view/pull-request-view-diff","module exports jquery lodash bitbucket/util/navbuilder bitbucket/util/state bitbucket/internal/feature/commit/request-commit bitbucket/internal/feature/pull-request/diff/pull-request-diff bitbucket/internal/model/commit-range bitbucket/internal/model/page-state bitbucket/internal/model/revision bitbucket/internal/util/history".split(" "),function(q,h,r,g,t,u,v,w,x,y,z,A){Object.defineProperty(h,"__esModule",{value:!0});var B=
babelHelpers.interopRequireDefault(r),c=babelHelpers.interopRequireDefault(t),k=babelHelpers.interopRequireDefault(u),C=babelHelpers.interopRequireDefault(v),n=babelHelpers.interopRequireDefault(w),D=babelHelpers.interopRequireDefault(x),a=babelHelpers.interopRequireDefault(y),E=babelHelpers.interopRequireDefault(z),F=babelHelpers.interopRequireDefault(A),e=void 0,f=void 0,G=function(b){return c.default.currentRepo().pullRequest(a.default.getPullRequest()).commit(b.id).buildAbsolute()},H=function(b){return c.default.currentRepo().pullRequest(a.default.getPullRequest()).commit(b.untilRevision.id).since(b.sinceRevision.id).buildAbsolute()},
l=function(b,d,c){a.default.setCommit(d&&new E.default(d));a.default.setCommitRange(c&&new D.default(c));b.innerHTML=bitbucket.internal.feature.pullRequest.diff({commit:k.default.getCommit(),repository:k.default.getRepository()});n.default.init({commit:k.default.getCommit(),commitRange:a.default.getCommitRange(),currentUser:a.default.getCurrentUser(),pullRequest:a.default.getPullRequest(),maxChanges:a.default.getPullRequestViewInternal().maxChanges,relevantContextLines:a.default.getPullRequestViewInternal().relevantContextLines,
seenCommitReview:a.default.getPullRequestViewInternal().seenCommitReview})},p=function(){return(0,g.startsWith)(location.href,c.default.currentPullRequest().commit("").buildAbsolute()+"/")&&!c.default.parse(location.href).getQueryParamValue("since")},m=function(){return(0,g.startsWith)(location.href,c.default.currentPullRequest().commit("").buildAbsolute()+"/")&&c.default.parse(location.href).getQueryParamValue("since")},I=function(){var a=c.default.parse(location.href).getQueryParamValue("since"),
d=c.default.parse(location.href).path().split("/").pop();return d&&a&&{untilRevision:{id:d},sinceRevision:{id:a}}};h.default={load:function(a){var d=F.default.state()||{},b=d.commit;d=d.commitRange;if(p())return b=p()&&e&&(0,g.startsWith)(location.href,G(e))&&e||b,(b?Promise.resolve(b):(0,C.default)({commitId:c.default.parse(location.href).path().split("/").pop()})).then(function(b){l(a,b,null)});if(m())return b=m()&&f&&(0,g.startsWith)(location.href,H(f))&&f||d&&d||m()&&I(),l(a,null,b);l(a,null,
null)},unload:function(b){e=a.default.getCommit()&&a.default.getCommit().toJSON()||e;a.default.setCommit(null);f=a.default.getCommitRange()&&a.default.getCommitRange().toJSON()||f;a.default.setCommitRange(null);return n.default.reset().done(function(){(0,B.default)(b).empty()})},keyboardShortcutContexts:["diff-tree","diff-view"]};q.exports=h["default"]});