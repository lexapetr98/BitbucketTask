(function(){var E,ha={}.hasOwnProperty,k=[].slice,v=function(a,b){function c(){this.constructor=a}for(var d in b)ha.call(b,d)&&(a[d]=b[d]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},F=function(a,b){return function(){return a.apply(b,arguments)}};var e={toString:function(){return"Bacon"},version:"0.7.42"};var M=("undefined"!==typeof global&&null!==global?global:this).Error;var l={indexOf:Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){var c,
d;var f=c=0;for(d=a.length;c<d;f=++c){var e=a[f];if(b===e)return f}return-1},indexWhere:function(a,b){var c,d;var f=c=0;for(d=a.length;c<d;f=++c){var e=a[f];if(b(e))return f}return-1},head:function(a){return a[0]},always:function(a){return function(){return a}},negate:function(a){return function(b){return!a(b)}},empty:function(a){return 0===a.length},tail:function(a){return a.slice(1,a.length)},filter:function(a,b){var c;var d=[];var f=0;for(c=b.length;f<c;f++){var e=b[f];a(e)&&d.push(e)}return d},
map:function(a,b){var c;var d=[];var f=0;for(c=b.length;f<c;f++){var e=b[f];d.push(a(e))}return d},each:function(a,b){var c;for(c in a){var d=a[c];b(c,d)}},toArray:function(a){return y(a)?a:[a]},contains:function(a,b){return-1!==l.indexOf(a,b)},id:function(a){return a},last:function(a){return a[a.length-1]},all:function(a,b){var c;null==b&&(b=l.id);var d=0;for(c=a.length;d<c;d++){var f=a[d];if(!b(f))return!1}return!0},any:function(a,b){var c;null==b&&(b=l.id);var d=0;for(c=a.length;d<c;d++){var f=
a[d];if(b(f))return!0}return!1},without:function(a,b){return l.filter(function(b){return b!==a},b)},remove:function(a,b){a=l.indexOf(b,a);if(0<=a)return b.splice(a,1)},fold:function(a,b,c){var d;var f=0;for(d=a.length;f<d;f++){var e=a[f];b=c(b,e)}return b},flatMap:function(a,b){return l.fold(b,[],function(b,d){return b.concat(a(d))})},cached:function(a){var b=B;return function(){b===B&&(b=a(),a=void 0);return b}},toString:function(a){var b,c;try{T++;if(null==a)return"undefined";if(r(a))return"function";
if(y(a))return 5<T?"[..]":"["+l.map(l.toString,a).toString()+"]";if(null!=(null!=a?a.toString:void 0)&&a.toString!==Object.prototype.toString)return a.toString();if("object"===typeof a){if(5<T)return"{..}";var d=[];for(c in a)if(ha.call(a,c)){try{var f=a[c]}catch(h){f=b=h}d.push(l.toString(c)+":"+l.toString(f))}return"{"+d+"}"}return a}finally{T--}}};var T=0;e._=l;e.scheduler={setTimeout:function(a,b){return setTimeout(a,b)},setInterval:function(a,b){return setInterval(a,b)},clearInterval:function(a){return clearInterval(a)},
now:function(){return(new Date).getTime()}};e.fromBinder=function(a,b){null==b&&(b=l.id);return new w(t(e,"fromBinder",a,b),function(c){var d;var f=d=!1;var h=function(){if(!d)return"undefined"!==typeof m&&null!==m?(m(),d=!0):f=!0};var m=a(function(){var a;var d=1<=arguments.length?k.call(arguments,0):[];var f=b.apply(this,d);y(f)&&l.last(f)instanceof N||(f=[f]);var m=e.more;var g=0;for(a=f.length;g<a;g++)if(d=f[g],m=c(d=Z(d)),m===e.noMore||d.isEnd()){h();break}return m});f&&h();return h})};e.$={};
e.$.asEventStream=function(a,b,c){if(r(b)){var d=[b,void 0];c=d[0];b=d[1]}return g(this.selector||this,"asEventStream",a,e.fromBinder(function(c){return function(d){c.on(a,b,d);return function(){return c.off(a,b,d)}}}(this),c))};null!=(E="undefined"!==typeof jQuery&&null!==jQuery?jQuery:"undefined"!==typeof Zepto&&null!==Zepto?Zepto:void 0)&&(E.fn.asEventStream=e.$.asEventStream);e.fromEventTarget=function(a,b,c){var d,f,h,m,n,ia;var z=null!=(d=null!=(f=null!=(h=a.addEventListener)?h:a.addListener)?
f:a.bind)?d:a.on;var u=null!=(m=null!=(n=null!=(ia=a.removeEventListener)?ia:a.removeListener)?n:a.unbind)?m:a.off;return g(e,"fromEventTarget",a,b,e.fromBinder(function(c){z.call(a,b,c);return function(){return u.call(a,b,c)}},c))};e.fromPromise=function(a,b){return g(e,"fromPromise",a,e.fromBinder(function(c){a.then(c,function(b){return c(G(b))});return function(){if(b)return"function"===typeof a.abort?a.abort():void 0}},function(b){return[b,p()]}))};e.noMore=["\x3cno-more\x3e"];e.more=["\x3cmore\x3e"];
e.later=function(a,b){return g(e,"later",a,b,e.fromPoll(a,function(){return[b,p()]}))};e.sequentially=function(a,b){var c=0;return g(e,"sequentially",a,b,e.fromPoll(a,function(){var a=b[c++];return c<b.length?a:c===b.length?[a,p()]:p()}))};e.repeatedly=function(a,b){var c=0;return g(e,"repeatedly",a,b,e.fromPoll(a,function(){return b[c++%b.length]}))};e.spy=function(a){return U.push(a)};var U=[];var O=function(a){var b;if(U.length&&!O.running)try{O.running=!0;var c=0;for(b=U.length;c<b;c++){var d=
U[c];d(a)}}finally{delete O.running}};var ja=function(a){return function(){var b=arguments[0];var c=2<=arguments.length?k.call(arguments,1):[];if("object"===typeof b&&c.length){var d=b;var f=c[0];b=function(){return d[f].apply(d,arguments)};c=c.slice(1)}return a.apply(null,[b].concat(k.call(c)))}};E=function(a,b){return ja(function(){var c=arguments[0];var d=2<=arguments.length?k.call(arguments,1):[];var f=ka(b,[function(b,a){return c.apply(null,k.call(b).concat([a]))}]);return g.apply(null,[e,a,
c].concat(k.call(d),[e.combineAsArray(d).flatMap(f)]))})};e.fromCallback=E("fromCallback",function(){var a=arguments[0];var b=2<=arguments.length?k.call(arguments,1):[];return e.fromBinder(function(c){aa(a,b)(c);return q},function(b){return[b,p()]})});e.fromNodeCallback=E("fromNodeCallback",function(){var a=arguments[0];var b=2<=arguments.length?k.call(arguments,1):[];return e.fromBinder(function(c){aa(a,b)(c);return q},function(b,a){return b?[G(b),p()]:[a,p()]})});e.fromPoll=function(a,b){return g(e,
"fromPoll",a,b,e.fromBinder(function(b){var c=e.scheduler.setInterval(b,a);return function(){return e.scheduler.clearInterval(c)}},b))};e.interval=function(a,b){null==b&&(b={});return g(e,"interval",a,b,e.fromPoll(a,function(){return H(b)}))};e.constant=function(a){return new I(t(e,"constant",a),function(b){b(ba(a));b(p());return q})};e.never=function(){return new w(t(e,"never"),function(a){a(p());return q})};e.once=function(a){return new w(t(e,"once",a),function(b){b(Z(a));b(p());return q})};e.fromArray=
function(a){ta(a);if(a.length){var b=0;return new w(t(e,"fromArray",a),function(c){var d=!1;var f=e.more;var h=function(){if(f!==e.noMore&&!d){var m=a[b++];f=c(Z(m));if(f!==e.noMore)return b===a.length?c(p()):C.afterTransaction(h)}};h();return function(){return d=!0}})}return g(e,"fromArray",a,e.never())};e.mergeAll=function(){var a=1<=arguments.length?k.call(arguments,0):[];y(a[0])&&(a=a[0]);return a.length?new w(t.apply(null,[e,"mergeAll"].concat(k.call(a))),function(b){var c=0;var d=l.map(function(d){return function(f){return d.dispatcher.subscribe(function(d){if(d.isEnd())return c++,
c===a.length?b(p()):e.more;d=b(d);d===e.noMore&&f();return d})}},a);return la.apply(null,d)}):e.never()};e.zipAsArray=function(){var a=1<=arguments.length?k.call(arguments,0):[];y(a[0])&&(a=a[0]);return g.apply(null,[e,"zipAsArray"].concat(k.call(a),[e.zipWith(a,function(){return 1<=arguments.length?k.call(arguments,0):[]})]))};e.zipWith=function(){var a=arguments[0];var b=2<=arguments.length?k.call(arguments,1):[];r(a)||(a=[a,b[0]],b=a[0],a=a[1]);b=l.map(function(b){return b.toEventStream()},b);
return g.apply(null,[e,"zipWith",a].concat(k.call(b),[e.when(b,a)]))};e.groupSimultaneous=function(){var a;var b=1<=arguments.length?k.call(arguments,0):[];1===b.length&&y(b[0])&&(b=b[0]);var c=function(){var c;var f=[];var e=0;for(c=b.length;e<c;e++)a=b[e],f.push(new ua(a));return f}();return g.apply(null,[e,"groupSimultaneous"].concat(k.call(b),[e.when(c,function(){return 1<=arguments.length?k.call(arguments,0):[]})]))};e.combineAsArray=function(){var a,b,c;var d=1<=arguments.length?k.call(arguments,
0):[];1===d.length&&y(d[0])&&(d=d[0]);var f=b=0;for(c=d.length;b<c;f=++b){var h=d[f];P(h)||(d[f]=e.constant(h))}return d.length?(f=function(){var b;var c=[];var f=0;for(b=d.length;f<b;f++)a=d[f],c.push(new A(a,!0));return c}(),g.apply(null,[e,"combineAsArray"].concat(k.call(d),[e.when(f,function(){return 1<=arguments.length?k.call(arguments,0):[]}).toProperty()]))):e.constant([])};e.onValues=function(){var a;var b=2<=arguments.length?k.call(arguments,0,a=arguments.length-1):(a=0,[]);a=arguments[a++];
return e.combineAsArray(b).onValues(a)};e.combineWith=function(){var a=arguments[0];var b=2<=arguments.length?k.call(arguments,1):[];return g.apply(null,[e,"combineWith",a].concat(k.call(b),[e.combineAsArray(b).map(function(b){return a.apply(null,b)})]))};e.combineTemplate=function(a){var b=[];var c=[];var d=function(b){return b[b.length-1]};var f=function(b,a,c){return d(b)[a]=c};var h=function(b,a){return function(c,d){return f(c,b,d[a])}};var m=function(b,a){return function(c){return f(c,b,a)}};
var n=function(b){return y(b)?[]:{}};var k=function(a,d){if(P(d))return c.push(d),b.push(h(a,c.length-1));if(d!==Object(d)||"function"===typeof d||d instanceof RegExp||d instanceof Date)return b.push(m(a,d));b.push(function(b){return function(a){var c=n(d);f(a,b,c);return a.push(c)}}(a));z(d);return b.push(function(b){return b.pop()})};var z=function(b){return l.each(b,k)};z(a);return g(e,"combineTemplate",a,e.combineAsArray(c).map(function(c){var d;var f=n(a);var e=[f];var h=0;for(d=b.length;h<d;h++){var m=
b[h];m(e,c)}return f}))};e.retry=function(a){if(!r(a.source))throw new M("'source' option has to be a function");var b=a.source;var c=a.retries||0;var d=a.maxRetries||c;var f=a.delay||function(){return 0};var h=a.isRetryable||function(){return!0};var m=function(a){var m={source:b,retries:c-1,maxRetries:d,delay:f,isRetryable:h};return e.later(f(a)).filter(!1).concat(e.once().flatMap(function(){return e.retry(m)}))};return g(e,"retry",a,b().flatMapError(function(b){return h(b)&&0<c?m({error:b,retriesDone:d-
c}):e.once(G(b))}))};var va=0;var N=function(){function a(){this.id=++va}a.prototype.isEvent=function(){return!0};a.prototype.isEnd=function(){return!1};a.prototype.isInitial=function(){return!1};a.prototype.isNext=function(){return!1};a.prototype.isError=function(){return!1};a.prototype.hasValue=function(){return!1};a.prototype.filter=function(){return!0};a.prototype.inspect=function(){return this.toString()};a.prototype.log=function(){return this.toString()};return a}();var V=function(a){function b(a,
d){b.__super__.constructor.call(this);!d&&r(a)||a instanceof b?(this.valueF=a,this.valueInternal=void 0):(this.valueF=void 0,this.valueInternal=a)}v(b,a);b.prototype.isNext=function(){return!0};b.prototype.hasValue=function(){return!0};b.prototype.value=function(){this.valueF instanceof b?(this.valueInternal=this.valueF.value(),this.valueF=void 0):this.valueF&&(this.valueInternal=this.valueF(),this.valueF=void 0);return this.valueInternal};b.prototype.fmap=function(b){if(this.valueInternal){var a=
this.valueInternal;return this.apply(function(){return b(a)})}var c=this;return this.apply(function(){return b(c.value())})};b.prototype.apply=function(a){return new b(a)};b.prototype.filter=function(b){return b(this.value())};b.prototype.toString=function(){return l.toString(this.value())};b.prototype.log=function(){return this.value()};return b}(N);var Q=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}v(b,a);b.prototype.isInitial=function(){return!0};b.prototype.isNext=
function(){return!1};b.prototype.apply=function(a){return new b(a)};b.prototype.toNext=function(){return new V(this)};return b}(V);var ma=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}v(b,a);b.prototype.isEnd=function(){return!0};b.prototype.fmap=function(){return this};b.prototype.apply=function(){return this};b.prototype.toString=function(){return"\x3cend\x3e"};return b}(N);var G=function(a){function b(b){this.error=b}v(b,a);b.prototype.isError=function(){return!0};
b.prototype.fmap=function(){return this};b.prototype.apply=function(){return this};b.prototype.toString=function(){return"\x3cerror\x3e "+l.toString(this.error)};return b}(N);var wa=0;var x=function(){function a(b){this.id=++wa;g(b,this);this.initialDesc=this.desc}a.prototype.subscribe=function(b){return C.wrappedSubscribe(this,b)};a.prototype.subscribeInternal=function(b){return this.dispatcher.subscribe(b)};a.prototype.onValue=function(){var b=J(arguments);return this.subscribe(function(a){if(a.hasValue())return b(a.value())})};
a.prototype.onValues=function(b){return this.onValue(function(a){return b.apply(null,a)})};a.prototype.onError=function(){var b=J(arguments);return this.subscribe(function(a){if(a.isError())return b(a.error)})};a.prototype.onEnd=function(){var b=J(arguments);return this.subscribe(function(a){if(a.isEnd())return b()})};a.prototype.errors=function(){return g(this,"errors",this.filter(function(){return!1}))};a.prototype.filter=function(){var b=arguments[0];var a=2<=arguments.length?k.call(arguments,
1):[];return R(this,b,a,function(b){return g(this,"filter",b,this.withHandler(function(a){return a.filter(b)?this.push(a):e.more}))})};a.prototype.takeWhile=function(){var b=arguments[0];var a=2<=arguments.length?k.call(arguments,1):[];return R(this,b,a,function(b){return g(this,"takeWhile",b,this.withHandler(function(a){if(a.filter(b))return this.push(a);this.push(p());return e.noMore}))})};a.prototype.endOnError=function(){var b=arguments[0];var a=2<=arguments.length?k.call(arguments,1):[];null==
b&&(b=!0);return R(this,b,a,function(b){return g(this,"endOnError",this.withHandler(function(a){return a.isError()&&b(a.error)?(this.push(a),this.push(p())):this.push(a)}))})};a.prototype.take=function(b){return 0>=b?e.never():g(this,"take",b,this.withHandler(function(a){if(a.hasValue()){b--;if(0<b)return this.push(a);0===b&&this.push(a);this.push(p());return e.noMore}return this.push(a)}))};a.prototype.map=function(){var b=arguments[0];var a=2<=arguments.length?k.call(arguments,1):[];return b instanceof
I?b.sampledBy(this,xa):R(this,b,a,function(b){return g(this,"map",b,this.withHandler(function(a){return this.push(a.fmap(b))}))})};a.prototype.mapError=function(){var b=J(arguments);return g(this,"mapError",b,this.withHandler(function(a){return a.isError()?this.push(H(b(a.error))):this.push(a)}))};a.prototype.mapEnd=function(){var b=J(arguments);return g(this,"mapEnd",b,this.withHandler(function(a){return a.isEnd()?(this.push(H(b(a))),this.push(p()),e.noMore):this.push(a)}))};a.prototype.doAction=
function(){var a=J(arguments);return g(this,"doAction",a,this.withHandler(function(b){b.hasValue()&&a(b.value());return this.push(b)}))};a.prototype.skip=function(a){return g(this,"skip",a,this.withHandler(function(b){return b.hasValue()&&0<a?(a--,e.more):this.push(b)}))};a.prototype.skipDuplicates=function(a){null==a&&(a=function(a,b){return a===b});return g(this,"skipDuplicates",this.withStateMachine(B,function(b,d){return d.hasValue()?d.isInitial()||b===B||!a(b.get(),d.value())?[new L(d.value()),
[d]]:[b,[]]:[b,[d]]}))};a.prototype.skipErrors=function(){return g(this,"skipErrors",this.withHandler(function(a){return a.isError()?e.more:this.push(a)}))};a.prototype.withStateMachine=function(a,c){var b=a;return g(this,"withStateMachine",a,c,this.withHandler(function(a){var d;a=c(b,a);var f=a[0];a=a[1];b=f;var g=e.more;f=0;for(d=a.length;f<d&&(g=a[f],g=this.push(g),g!==e.noMore);f++);return g}))};a.prototype.scan=function(a,c){var b;c=W(c);var f=na(a);var h=function(a){return function(d){var h=
!1;var m=q;var g=e.more;var n=function(){if(!h)return f.forEach(function(a){h=!0;g=d(new Q(function(){return a}));if(g===e.noMore)return m(),m=q})};m=a.dispatcher.subscribe(function(a){if(a.hasValue()){if(h&&a.isInitial())return e.more;a.isInitial()||n();h=!0;var b=f.getOrElse(void 0);var m=c(b,a.value());f=new L(m);return d(a.apply(function(){return m}))}a.isEnd()&&(g=n());if(g!==e.noMore)return d(a)});C.whenDoneWith(b,n);return m}}(this);return b=new I(t(this,"scan",a,c),h)};a.prototype.fold=function(a,
c){return g(this,"fold",a,c,this.scan(a,c).sampledBy(this.filter(!1).mapEnd().toProperty()))};a.prototype.zip=function(a,c){null==c&&(c=Array);return g(this,"zip",a,e.zipWith([this,a],c))};a.prototype.diff=function(a,c){c=W(c);return g(this,"diff",a,c,this.scan([a],function(a,b){return[b,c(a[0],b)]}).filter(function(a){return 2===a.length}).map(function(a){return a[1]}))};a.prototype.flatMap=function(){return ca(this,X(arguments))};a.prototype.flatMapFirst=function(){return ca(this,X(arguments),!0)};
a.prototype.flatMapWithConcurrencyLimit=function(){var a=arguments[0];var c=2<=arguments.length?k.call(arguments,1):[];return g.apply(null,[this,"flatMapWithConcurrencyLimit",a].concat(k.call(c),[ca(this,X(c),!1,a)]))};a.prototype.flatMapLatest=function(){var a=X(arguments);var c=this.toEventStream();return g(this,"flatMapLatest",a,c.flatMap(function(b){return oa(a(b)).takeUntil(c)}))};a.prototype.flatMapError=function(a){return g(this,"flatMapError",a,this.mapError(function(a){return G(a)}).flatMap(function(b){return b instanceof
G?a(b.error):e.once(b)}))};a.prototype.flatMapConcat=function(){return g.apply(null,[this,"flatMapConcat"].concat(k.call(arguments),[this.flatMapWithConcurrencyLimit.apply(this,[1].concat(k.call(arguments)))]))};a.prototype.bufferingThrottle=function(a){return g(this,"bufferingThrottle",a,this.flatMapConcat(function(b){return e.once(b).concat(e.later(a).filter(!1))}))};a.prototype.not=function(){return g(this,"not",this.map(function(a){return!a}))};a.prototype.log=function(){var a=1<=arguments.length?
k.call(arguments,0):[];this.subscribe(function(b){return"undefined"!==typeof console&&null!==console?"function"===typeof console.log?console.log.apply(console,k.call(a).concat([b.log()])):void 0:void 0});return this};a.prototype.slidingWindow=function(a,c){null==c&&(c=0);return g(this,"slidingWindow",a,c,this.scan([],function(b,c){return b.concat([c]).slice(-a)}).filter(function(a){return a.length>=c}))};a.prototype.combine=function(a,c){var b=W(c);return g(this,"combine",a,c,e.combineAsArray(this,
a).map(function(a){return b(a[0],a[1])}))};a.prototype.decode=function(a){return g(this,"decode",a,this.combine(e.combineTemplate(a),function(a,b){return b[a]}))};a.prototype.awaiting=function(a){return g(this,"awaiting",a,e.groupSimultaneous(this,a).map(function(a){return 0===a[1].length}).toProperty(!1).skipDuplicates())};a.prototype.name=function(a){this._name=a;return this};a.prototype.withDescription=function(){return t.apply(null,arguments).apply(this)};a.prototype.toString=function(){return this._name?
this._name:this.desc.toString()};a.prototype.internalDeps=function(){return this.initialDesc.deps()};return a}();x.prototype.reduce=x.prototype.fold;x.prototype.assign=x.prototype.onValue;x.prototype.inspect=x.prototype.toString;var ca=function(a,b,c,d){var f=[a];var h=[];var m=new w(t(a,"flatMap"+(c?"First":""),b),function(f){var m=new da;var g=[];var n=function(a){var c=oa(b(a.value()));h.push(c);return m.add(function(a,b){return c.dispatcher.subscribe(function(d){if(d.isEnd())return l.remove(c,
h),k(),D(b),e.noMore;d instanceof Q&&(d=d.toNext());d=f(d);d===e.noMore&&a();return d})})};var k=function(){var a;if(a=g.shift())return n(a)};var D=function(a){a();if(m.empty())return f(p())};m.add(function(b,h){return a.dispatcher.subscribe(function(a){return a.isEnd()?D(h):a.isError()?f(a):c&&1<m.count()?e.more:m.unsubscribed?e.noMore:d&&m.count()>d?g.push(a):n(a)})});return m.unsubscribe});m.internalDeps=function(){return h.length?f.concat(h):f};return m};var w=function(a){function b(a,d,f){r(a)&&
(f=d,d=a,a=[]);b.__super__.constructor.call(this,a);Y(d);this.dispatcher=new ea(d,f);O(this)}v(b,a);b.prototype.delay=function(a){return g(this,"delay",a,this.flatMap(function(b){return e.later(a,b)}))};b.prototype.debounce=function(a){return g(this,"debounce",a,this.flatMapLatest(function(b){return e.later(a,b)}))};b.prototype.debounceImmediate=function(a){return g(this,"debounceImmediate",a,this.flatMapFirst(function(b){return e.once(b).concat(e.later(a).filter(!1))}))};b.prototype.throttle=function(a){return g(this,
"throttle",a,this.bufferWithTime(a).map(function(a){return a[a.length-1]}))};b.prototype.bufferWithTime=function(a){return g(this,"bufferWithTime",a,this.bufferWithTimeOrCount(a,Number.MAX_VALUE))};b.prototype.bufferWithCount=function(a){return g(this,"bufferWithCount",a,this.bufferWithTimeOrCount(void 0,a))};b.prototype.bufferWithTimeOrCount=function(a,b){var c=function(c){if(c.values.length===b)return c.flush();if(void 0!==a)return c.schedule()};return g(this,"bufferWithTimeOrCount",a,b,this.buffer(a,
c,c))};b.prototype.buffer=function(a,b,f){null==b&&(b=q);null==f&&(f=q);var c={scheduled:!1,end:void 0,values:[],flush:function(){this.scheduled=!1;if(0<this.values.length){var a=this.push(H(this.values));this.values=[];if(null!=this.end)return this.push(this.end);if(a!==e.noMore)return f(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){if(!this.scheduled)return this.scheduled=!0,a(function(a){return function(){return a.flush()}}(this))}};var d=e.more;if(!r(a)){var n=a;
a=function(a){return e.scheduler.setTimeout(a,n)}}return g(this,"buffer",this.withHandler(function(a){c.push=function(a){return function(b){return a.push(b)}}(this);a.isError()?d=this.push(a):a.isEnd()?(c.end=a,c.scheduled||c.flush()):(c.values.push(a.value()),b(c));return d}))};b.prototype.merge=function(a){ya(a);return g(this,"merge",a,e.mergeAll(this,a))};b.prototype.toProperty=function(a){var b=0===arguments.length?B:na(function(){return a});var c=this.dispatcher;return new I(t(this,"toProperty",
a),function(a){var d=!1;var f=q;var h=e.more;var g=function(){if(!d)return b.forEach(function(b){d=!0;h=a(new Q(b));if(h===e.noMore)return f(),f=q})};f=c.subscribe(function(c){if(c.hasValue()){if(d&&c.isInitial())return e.more;c.isInitial()||g();d=!0;b=new L(c);return a(c)}c.isEnd()&&(h=g());if(h!==e.noMore)return a(c)});g();return f})};b.prototype.toEventStream=function(){return this};b.prototype.sampledBy=function(a,b){return g(this,"sampledBy",a,b,this.toProperty().sampledBy(a,b))};b.prototype.concat=
function(a){var c=this;return new b(t(c,"concat",a),function(b){var d=q;var f=c.dispatcher.subscribe(function(c){return c.isEnd()?d=a.dispatcher.subscribe(b):b(c)});return function(){f();return d()}})};b.prototype.takeUntil=function(a){var b={};return g(this,"takeUntil",a,e.groupSimultaneous(this.mapEnd(b),a.skipErrors()).withHandler(function(c){var d;if(c.hasValue()){var f=c.value();c=f[0];a=f[1];if(a.length)return this.push(p());var g=e.more;f=0;for(d=c.length;f<d;f++)g=c[f],g=g===b?this.push(p()):
this.push(H(g));return g}return this.push(c)}))};b.prototype.skipUntil=function(a){var b=a.take(1).map(!0).toProperty(!1);return g(this,"skipUntil",a,this.filter(b))};b.prototype.skipWhile=function(){var a=arguments[0];var b=2<=arguments.length?k.call(arguments,1):[];var f=!1;return R(this,a,b,function(a){return g(this,"skipWhile",a,this.withHandler(function(b){if(!f&&b.hasValue()&&a(b.value()))return e.more;b.hasValue()&&(f=!0);return this.push(b)}))})};b.prototype.holdWhen=function(a){var b=a.startWith(!1);
var c=b.filter(function(a){return!a});var h=b.filter(l.id);return g(this,"holdWhen",a,this.filter(!1).merge(b.flatMapConcat(function(a){return function(b){return b?a.scan([],function(a,b){return a.concat(b)}).sampledBy(c).take(1).flatMap(e.fromArray):a.takeUntil(h)}}(this))))};b.prototype.startWith=function(a){return g(this,"startWith",a,e.once(a).concat(this))};b.prototype.withHandler=function(a){return new b(t(this,"withHandler",a),this.dispatcher.subscribe,a)};return b}(x);var I=function(a){function b(a,
d,f){r(a)&&(f=d,d=a,a=[]);b.__super__.constructor.call(this,a);Y(d);this.dispatcher=new za(this,d,f);O(this)}v(b,a);b.prototype.sampledBy=function(a,d){if(null!=d)d=W(d);else{var c=!0;d=function(a){return a.value()}}var h=new A(this,!1,c);c=new A(a,!0,c);h=e.when([h,c],d);h=a instanceof b?h.toProperty():h;return g(this,"sampledBy",a,d,h)};b.prototype.sample=function(a){return g(this,"sample",a,this.sampledBy(e.interval(a,{})))};b.prototype.changes=function(){return new w(t(this,"changes"),function(a){return function(b){return a.dispatcher.subscribe(function(a){if(!a.isInitial())return b(a)})}}(this))};
b.prototype.withHandler=function(a){return new b(t(this,"withHandler",a),this.dispatcher.subscribe,a)};b.prototype.toProperty=function(){Aa(arguments);return this};b.prototype.toEventStream=function(){return new w(t(this,"toEventStream"),function(a){return function(b){return a.dispatcher.subscribe(function(a){a.isInitial()&&(a=a.toNext());return b(a)})}}(this))};b.prototype.and=function(a){return g(this,"and",a,this.combine(a,function(a,b){return a&&b}))};b.prototype.or=function(a){return g(this,
"or",a,this.combine(a,function(a,b){return a||b}))};b.prototype.delay=function(a){return this.delayChanges("delay",a,function(b){return b.delay(a)})};b.prototype.debounce=function(a){return this.delayChanges("debounce",a,function(b){return b.debounce(a)})};b.prototype.throttle=function(a){return this.delayChanges("throttle",a,function(b){return b.throttle(a)})};b.prototype.delayChanges=function(){var a;var b=2<=arguments.length?k.call(arguments,0,a=arguments.length-1):(a=0,[]);a=arguments[a++];return g.apply(null,
[this].concat(k.call(b),[pa(this,a(this.changes()))]))};b.prototype.takeUntil=function(a){var b=this.changes().takeUntil(a);return g(this,"takeUntil",a,pa(this,b))};b.prototype.startWith=function(a){return g(this,"startWith",a,this.scan(a,function(a,b){return b}))};b.prototype.bufferingThrottle=function(){var a;return(a=b.__super__.bufferingThrottle.apply(this,arguments)).bufferingThrottle.apply(a,arguments).toProperty()};return b}(x);var R=function(a,b,c,d){if(b instanceof I)return a=b.sampledBy(a,
function(a,b){return[a,b]}),d.call(a,function(a){return a[0]}).map(function(a){return a[1]});b=aa(b,c);return d.call(a,b)};var pa=function(a,b){var c=new w(t(a,"justInitValue"),function(b){var d=void 0;var h=a.dispatcher.subscribe(function(a){a.isEnd()||(d=a);return e.noMore});C.whenDoneWith(c,function(){null!=d&&b(d);return b(p())});return h});return c.concat(b).toProperty()};var ea=function(){function a(a,c){this._subscribe=a;this._handleEvent=c;this.subscribe=F(this.subscribe,this);this.handleEvent=
F(this.handleEvent,this);this.subscriptions=[];this.queue=[];this.ended=this.pushing=!1;this.unsubSrc=this.prevError=void 0}a.prototype.hasSubscribers=function(){return 0<this.subscriptions.length};a.prototype.removeSub=function(a){return this.subscriptions=l.without(a,this.subscriptions)};a.prototype.push=function(a){a.isEnd()&&(this.ended=!0);return C.inTransaction(a,this,this.pushIt,[a])};a.prototype.pushToSubscriptions=function(a){var b;try{var d=this.subscriptions;var f=0;for(b=d.length;f<b;f++){var h=
d[f];var g=h.sink(a);(g===e.noMore||a.isEnd())&&this.removeSub(h)}return!0}catch(n){throw a=n,this.pushing=!1,this.queue=[],a;}};a.prototype.pushIt=function(a){if(this.pushing)return this.queue.push(a),e.more;if(a!==this.prevError){a.isError()&&(this.prevError=a);this.pushing=!0;this.pushToSubscriptions(a);for(this.pushing=!1;this.queue.length;)a=this.queue.shift(),this.push(a);if(this.hasSubscribers())return e.more;this.unsubscribeFromSource();return e.noMore}};a.prototype.handleEvent=function(a){return this._handleEvent?
this._handleEvent(a):this.push(a)};a.prototype.unsubscribeFromSource=function(){this.unsubSrc&&this.unsubSrc();return this.unsubSrc=void 0};a.prototype.subscribe=function(a){if(this.ended)return a(p()),q;Y(a);var b={sink:a};this.subscriptions.push(b);1===this.subscriptions.length&&(this.unsubSrc=this._subscribe(this.handleEvent),Y(this.unsubSrc));return function(a){return function(){a.removeSub(b);if(!a.hasSubscribers())return a.unsubscribeFromSource()}}(this)};return a}();var za=function(a){function b(a,
d,e){this.property=a;this.subscribe=F(this.subscribe,this);b.__super__.constructor.call(this,d,e);this.current=B;this.currentValueRootId=void 0;this.propertyEnded=!1}v(b,a);b.prototype.push=function(a){a.isEnd()&&(this.propertyEnded=!0);a.hasValue()&&(this.current=new L(a),this.currentValueRootId=C.currentEventId());return b.__super__.push.call(this,a)};b.prototype.maybeSubSource=function(a,b){return b===e.noMore?q:this.propertyEnded?(a(p()),q):ea.prototype.subscribe.call(this,a)};b.prototype.subscribe=
function(a){var b=e.more;if(this.current.isDefined&&(this.hasSubscribers()||this.propertyEnded)){var c=C.currentEventId();var h=this.currentValueRootId;!this.propertyEnded&&h&&c&&c!==h?C.whenDoneWith(this.property,function(b){return function(){if(b.currentValueRootId===h)return a(ba(b.current.get().value()))}}(this)):C.inTransaction(void 0,this,function(){return b=a(ba(this.current.get().value()))},[])}return this.maybeSubSource(a,b)};return b}(ea);E=function(a){function b(){this.guardedSink=F(this.guardedSink,
this);this.subscribeAll=F(this.subscribeAll,this);this.unsubAll=F(this.unsubAll,this);this.sink=void 0;this.subscriptions=[];this.ended=!1;b.__super__.constructor.call(this,t(e,"Bus"),this.subscribeAll)}v(b,a);b.prototype.unsubAll=function(){var a;var b=this.subscriptions;var e=0;for(a=b.length;e<a;e++){var h=b[e];"function"===typeof h.unsub&&h.unsub()}};b.prototype.subscribeAll=function(a){var b;this.sink=a;var c=Ba(this.subscriptions);var e=0;for(b=c.length;e<b;e++)a=c[e],this.subscribeInput(a);
return this.unsubAll};b.prototype.guardedSink=function(a){return function(b){return function(c){return c.isEnd()?(b.unsubscribeInput(a),e.noMore):b.sink(c)}}(this)};b.prototype.subscribeInput=function(a){return a.unsub=a.input.dispatcher.subscribe(this.guardedSink(a.input))};b.prototype.unsubscribeInput=function(a){var b,c;var e=this.subscriptions;var g=b=0;for(c=e.length;b<c;g=++b){var k=e[g];if(k.input===a){"function"===typeof k.unsub&&k.unsub();this.subscriptions.splice(g,1);break}}};b.prototype.plug=
function(a){Ca(a);if(!this.ended){var b={input:a};this.subscriptions.push(b);null!=this.sink&&this.subscribeInput(b);return function(b){return function(){return b.unsubscribeInput(a)}}(this)}};b.prototype.end=function(){this.ended=!0;this.unsubAll();return"function"===typeof this.sink?this.sink(p()):void 0};b.prototype.push=function(a){return"function"===typeof this.sink?this.sink(H(a)):void 0};b.prototype.error=function(a){return"function"===typeof this.sink?this.sink(G(a)):void 0};return b}(w);
var A=function(){function a(a,c,d){this.obs=a;this.sync=c;this.lazy=null!=d?d:!1;this.queue=[]}a.prototype.subscribe=function(a){return this.obs.dispatcher.subscribe(a)};a.prototype.toString=function(){return this.obs.toString()};a.prototype.markEnded=function(){return this.ended=!0};a.prototype.consume=function(){return this.lazy?{value:l.always(this.queue[0])}:this.queue[0]};a.prototype.push=function(a){return this.queue=[a]};a.prototype.mayHave=function(){return!0};a.prototype.hasAtLeast=function(){return this.queue.length};
a.prototype.flatten=!0;return a}();var Da=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}v(b,a);b.prototype.consume=function(){return this.queue.shift()};b.prototype.push=function(a){return this.queue.push(a)};b.prototype.mayHave=function(a){return!this.ended||this.queue.length>=a};b.prototype.hasAtLeast=function(a){return this.queue.length>=a};b.prototype.flatten=!1;return b}(A);var ua=function(a){function b(a){b.__super__.constructor.call(this,a,!0)}v(b,a);b.prototype.consume=
function(){var a=this.queue;this.queue=[];return{value:function(){return a}}};b.prototype.push=function(a){return this.queue.push(a.value())};b.prototype.hasAtLeast=function(){return!0};return b}(A);A.isTrigger=function(a){return a instanceof A?a.sync:a instanceof w};A.fromObservable=function(a){return a instanceof A?a:a instanceof I?new A(a,!1):new Da(a,!0)};var t=function(){var a=arguments[0];var b=arguments[1];var c=3<=arguments.length?k.call(arguments,2):[];return(a||b)instanceof qa?a||b:new qa(a,
b,c)};var ra=function(a){return y(a)?l.flatMap(ra,a):P(a)?[a]:a instanceof A?[a.obs]:[]};var qa=function(){function a(a,c,d){this.context=a;this.method=c;this.args=d;this.cached=void 0}a.prototype.deps=function(){return this.cached||(this.cached=ra([this.context].concat(this.args)))};a.prototype.apply=function(a){a.desc=this;return a};a.prototype.toString=function(){return l.toString(this.context)+"."+l.toString(this.method)+"("+l.map(l.toString,this.args)+")"};return a}();var g=function(){var a;
var b=2<=arguments.length?k.call(arguments,0,a=arguments.length-1):(a=0,[]);a=arguments[a++];return t.apply(null,b).apply(a)};e.when=function(){var a,b,c,d;if(0===arguments.length)return e.never();var f=arguments.length;S("when: expecting arguments in the form (Observable+,function)+",0===f%2);var g=[];var m=[];var n=0;for(a=[];n<f;){a[n]=arguments[n];a[n+1]=arguments[n+1];var q=l.toArray(arguments[n]);var z=Ea(arguments[n+1]);var u={f:z,ixs:[]};var K=!1;var D=0;for(c=q.length;D<c;D++){var r=q[D];
z=l.indexOf(g,r);K||(K=A.isTrigger(r));0>z&&(g.push(r),z=g.length-1);var x=u.ixs;var v=0;for(d=x.length;v<d;v++){var y=x[v];y.index===z&&y.count++}u.ixs.push({index:z,count:1})}S("At least one EventStream required",K||!q.length);0<q.length&&m.push(u);n+=2}if(!g.length)return e.never();g=l.map(A.fromObservable,g);var B=l.any(g,function(a){return a.flatten})&&Fa(l.map(function(a){return a.obs},g));return b=new w(t.apply(null,[e,"when"].concat(k.call(a))),function(a){var c=[];var d=!1;var f=function(a){var b;
var c=a.ixs;a=0;for(b=c.length;a<b;a++)if(n=c[a],!g[n.index].hasAtLeast(n.count))return!1;return!0};var h=function(a){return!a.sync||a.ended};var k=function(a){var b;var c=a.ixs;a=0;for(b=c.length;a<b;a++)if(n=c[a],!g[n.index].mayHave(n.count))return!0};var z=function(a){return!a.source.flatten};var u=function(u){return function(K){var q=function(){return C.whenDoneWith(b,r)};var D=function(){var b;if(0<c.length){var d=e.more;d=c.pop();var h=0;for(b=m.length;h<b;h++){var k=m[h];if(f(k)){var u=function(){var a;
var b=k.ixs;var c=[];var d=0;for(a=b.length;d<a;d++)n=b[d],c.push(g[n.index].consume());return c}();d=a(d.e.apply(function(){var a;var b=[];var c=0;for(a=u.length;c<a;c++){var d=u[c];b.push(d.value())}return k.f.apply(k,b)}));c.length&&(c=l.filter(z,c));return d===e.noMore?d:D()}}}else return e.more};var r=function(){var b=D();d&&(d=!1,l.all(g,h)||l.all(m,k))&&(b=e.noMore,a(p()));b===e.noMore&&K();return b};return u.subscribe(function(b){if(b.isEnd())d=!0,u.markEnded(),q();else if(b.isError())var f=
a(b);else u.push(b),u.sync&&(c.push({source:u,e:b}),B||C.hasWaiters()?q():r());f===e.noMore&&K();return f||e.more})}};return la.apply(null,function(){var a;var b=[];var c=0;for(a=g.length;c<a;c++)r=g[c],b.push(u(r));return b}())})};var Fa=function(a,b){null==b&&(b=[]);var c=function(a){if(l.contains(b,a))return!0;var d=a.internalDeps();if(d.length)return b.push(a),l.any(d,c);b.push(a);return!1};return l.any(a,c)};e.update=function(){var a;var b=arguments[0];var c=2<=arguments.length?k.call(arguments,
1):[];var d=function(a){return function(){var b=1<=arguments.length?k.call(arguments,0):[];return function(c){return a.apply(null,[c].concat(b))}}};for(a=c.length-1;0<a;)c[a]instanceof Function||(c[a]=function(a){return function(){return a}}(c[a])),c[a]=d(c[a]),a-=2;return g.apply(null,[e,"update",b].concat(k.call(c),[e.when.apply(e,c).scan(b,function(a,b){return b(a)})]))};var la=function(){var a=1<=arguments.length?k.call(arguments,0):[];return(new da(a)).unsubscribe};var da=function(){function a(a){var b;
null==a&&(a=[]);this.unsubscribe=F(this.unsubscribe,this);this.unsubscribed=!1;this.subscriptions=[];this.starting=[];var d=0;for(b=a.length;d<b;d++){var e=a[d];this.add(e)}}a.prototype.add=function(a){if(!this.unsubscribed){var b=!1;var d=q;this.starting.push(a);var e=function(c){return function(){if(!c.unsubscribed)return b=!0,c.remove(d),l.remove(a,c.starting)}}(this);d=a(this.unsubscribe,e);this.unsubscribed||b||this.subscriptions.push(d);l.remove(a,this.starting);return d}};a.prototype.remove=
function(a){if(!this.unsubscribed&&void 0!==l.remove(a,this.subscriptions))return a()};a.prototype.unsubscribe=function(){var a;if(!this.unsubscribed){this.unsubscribed=!0;var c=this.subscriptions;var d=0;for(a=c.length;d<a;d++){var e=c[d];e()}this.subscriptions=[];return this.starting=[]}};a.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length};a.prototype.empty=function(){return 0===this.count()};return a}();e.CompositeUnsubscribe=da;var L=function(){function a(a){this.value=
a}a.prototype.getOrElse=function(){return this.value};a.prototype.get=function(){return this.value};a.prototype.filter=function(b){return b(this.value)?new a(this.value):B};a.prototype.map=function(b){return new a(b(this.value))};a.prototype.forEach=function(a){return a(this.value)};a.prototype.isDefined=!0;a.prototype.toArray=function(){return[this.value]};a.prototype.inspect=function(){return"Some("+this.value+")"};a.prototype.toString=function(){return this.inspect()};return a}();var B={getOrElse:function(a){return a},
filter:function(){return B},map:function(){return B},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}};var C=function(){var a=void 0;var b=[];var c={};var d=[];var f=0;var g=function(b){return a?d.push(b):b()};var k=function(){for(;0<b.length;)n(0)};var n=function(a){var d=b[a];var e=d.id;var f=c[e];b.splice(a,1);delete c[e];p(d);d=0;for(e=f.length;d<e;d++)a=f[d],a()};var p=function(a){var d;a=a.internalDeps();
var e=0;for(d=a.length;e<d;e++){var f=a[e];p(f);c[f.id]&&(f=l.indexOf(b,f),n(f))}};return{whenDoneWith:function(d,e){if(a){var f=c[d.id];return null==f?(c[d.id]=[e],b.push(d)):f.push(e)}return e()},hasWaiters:function(){return 0<b.length},inTransaction:function(b,c,e,g){if(a)return e.apply(c,g);a=b;try{var h=e.apply(c,g);k()}finally{for(a=void 0;f<d.length;)b=d[f],f++,b();f=0;d=[]}return h},currentEventId:function(){if(a)return a.id},wrappedSubscribe:function(a,b){var c;var d=c=!1;var f=function(){return d=
!0};var h=function(){c=!0;return f()};f=a.dispatcher.subscribe(function(a){return g(function(){if(!c){var d=b(a);if(d===e.noMore)return h()}})});d&&f();return h},afterTransaction:g}}();e.EventStream=w;e.Property=I;e.Observable=x;e.Bus=E;e.Initial=Q;e.Next=V;e.End=ma;e.Error=G;var q=function(){};var xa=function(a,b){return a};var ba=function(a){return new Q(a,!0)};var H=function(a){return new V(a,!0)};var p=function(){return new ma};var Z=function(a){return a instanceof N?a:H(a)};var Ba=function(a){return a.slice(0)};
var S=function(a,b){if(!b)throw new M(a);};var ya=function(a){if(!(a instanceof w))throw new M("not an EventStream : "+a);};var Ca=function(a){if(!(a instanceof x))throw new M("not an Observable : "+a);};var Y=function(a){return S("not a function : "+a,r(a))};var r=function(a){return"function"===typeof a};var y=function(a){return a instanceof Array};var P=function(a){return a instanceof x};var ta=function(a){if(!y(a))throw new M("not an array : "+a);};var Aa=function(a){return S("no arguments supported",
0===a.length)};var ka=function(a,b){return function(){var c=1<=arguments.length?k.call(arguments,0):[];return a.apply(null,b.concat(c))}};var X=function(a){return 1===a.length&&P(a[0])?l.always(a[0]):J(a)};var J=function(a){a=Array.prototype.slice.call(a);return sa.apply(null,a)};var sa=ja(function(){var a=arguments[0];var b=2<=arguments.length?k.call(arguments,1):[];return r(a)?b.length?ka(a,b):a:fa(a)?Ga(a,b):l.always(a)});var aa=function(a,b){return sa.apply(null,[a].concat(k.call(b)))};var Ea=
function(a){return r(a)?a:l.always(a)};var oa=function(a){return P(a)?a:e.once(a)};var fa=function(a){return"string"===typeof a&&1<a.length&&"."===a.charAt(0)};e.isFieldKey=fa;var Ga=function(a,b){var c=a.slice(1).split(".");var d=l.map(Ha(b),c);return function(b){var c;var e=0;for(c=d.length;e<c;e++)a=d[e],b=a(b);return b}};var Ha=function(a){return function(b){return function(c){if(null!=c){var d=c[b];return r(d)?d.apply(c,a):d}}}};var Ia=function(a){return a.slice(1)};var W=function(a){if(r(a))return a;
if(fa(a)){var b=Ia(a);return function(a,d){return a[b](d)}}return S("not a function or a field key: "+a,!1)};var na=function(a){return a instanceof L||a===B?a:new L(a)};"undefined"!==typeof define&&null!==define&&null!=define.amd?(define([],function(){return e}),this.Bacon=e):"undefined"!==typeof module&&null!==module&&null!=module.exports?(module.exports=e,e.Bacon=e):this.Bacon=e}).call(this);