var parallable;
void 0===parallable&&(parallable=function(f,m){parallable.core[m.toString()]=m().core;return function(){var c;if(1<arguments.length){var k=arguments[arguments.length-2];var e=arguments[arguments.length-1];var g=Array(arguments.length-2);for(c=0;c<arguments.length-2;c++)g[c]=arguments[c]}else k=arguments[0].async,e=arguments[0].worker,g=arguments[0],delete g.async,delete g.worker,g=[g];var h={shared:{}},d=m.apply(h,g);return k?function(J,b){var k=0,a=Array(e);b=d.pre.apply(h,[e]);for(c in h.shared)"function"==typeof h.shared[c]?
delete h.shared[c]:void 0!==h.shared[c].tagName&&delete h.shared[c];for(c=0;c<e;c++){var B=new Worker(f);B.onmessage=function(b){return function(g){a[b]="string"==typeof g.data?JSON.parse(g.data):g.data;k++;k==e&&J(d.post.apply(h,[a]))}}(c);var l={input:b[c],name:m.toString(),shared:h.shared,id:c,worker:g.worker_num};try{B.postMessage(l)}catch(n){B.postMessage(JSON.stringify(l))}}}:d.post.apply(h,[[d.core.apply(h,[d.pre.apply(h,[1])[0],0,1])]])}},parallable.core={});
function get_named_arguments(f,m){if(1<f.length){for(var c={},k=0;k<m.length;k++)c[m[k]]=f[k];return c}return 1==f.length?f[0]:{}}
var ccv={pre:function(f){if("img"==f.tagName.toLowerCase()){var m=document.createElement("canvas");document.body.appendChild(f);m.width=f.offsetWidth;m.style.width=f.offsetWidth.toString()+"px";m.height=f.offsetHeight;m.style.height=f.offsetHeight.toString()+"px";document.body.removeChild(f);m.getContext("2d").drawImage(f,0,0);return m}return f},grayscale:function(f){for(var m=f.getContext("2d"),c=m.getImageData(0,0,f.width,f.height),k=c.data,e,g,h=f.width*f.height*4;0<h;)k[h-=4]=k[e=h+1]=k[g=h+2]=
.3*k[h]+.59*k[e]+.11*k[g];m.putImageData(c,0,0);return f},array_group:function(f,m){var c,k,e=Array(f.length);for(c=0;c<f.length;c++)e[c]={parent:-1,element:f[c],rank:0};for(c=0;c<f.length;c++)if(e[c].element){for(var g=c;-1!=e[g].parent;)g=e[g].parent;for(k=0;k<f.length;k++)if(c!=k&&e[k].element&&m(e[c].element,e[k].element)){for(var h=k;-1!=e[h].parent;)h=e[h].parent;if(h!=g){e[g].rank>e[h].rank?e[h].parent=g:(e[g].parent=h,e[g].rank==e[h].rank&&e[h].rank++,g=h);for(var d=k;-1!=e[d].parent;)h=d,
d=e[d].parent,e[h].parent=g;for(d=c;-1!=e[d].parent;)h=d,d=e[d].parent,e[h].parent=g}}}m=Array(f.length);for(c=g=0;c<f.length;c++){k=-1;h=c;if(e[h].element){for(;-1!=e[h].parent;)h=e[h].parent;0<=e[h].rank&&(e[h].rank=~g++);k=~e[h].rank}m[c]=k}return{index:m,cat:g}},detect_objects:parallable("ccv.js",function(f,m,c,k){if(void 0!==this.shared){var e=get_named_arguments(arguments,["canvas","cascade","interval","min_neighbors"]);this.shared.canvas=e.canvas;this.shared.interval=e.interval;this.shared.min_neighbors=
e.min_neighbors;this.shared.cascade=e.cascade;this.shared.scale=Math.pow(2,1/(e.interval+1));this.shared.next=e.interval+1;this.shared.scale_upto=Math.floor(Math.log(Math.min(e.canvas.width/e.cascade.width,e.canvas.height/e.cascade.height))/Math.log(this.shared.scale));for(e=0;e<this.shared.cascade.stage_classifier.length;e++)this.shared.cascade.stage_classifier[e].orig_feature=this.shared.cascade.stage_classifier[e].feature}return{pre:function(g){g=this.shared.interval;var h=this.shared.scale,d=
this.shared.next,e=this.shared.scale_upto,b=Array(4*(e+2*d)),f=Array(4*(e+2*d));b[0]=this.shared.canvas;f[0]={width:b[0].width,height:b[0].height,data:b[0].getContext("2d").getImageData(0,0,b[0].width,b[0].height).data};var a;for(a=1;a<=g;a++)b[4*a]=document.createElement("canvas"),b[4*a].width=Math.floor(b[0].width/Math.pow(h,a)),b[4*a].height=Math.floor(b[0].height/Math.pow(h,a)),b[4*a].getContext("2d").drawImage(b[0],0,0,b[0].width,b[0].height,0,0,b[4*a].width,b[4*a].height),f[4*a]={width:b[4*
a].width,height:b[4*a].height,data:b[4*a].getContext("2d").getImageData(0,0,b[4*a].width,b[4*a].height).data};for(a=d;a<e+2*d;a++)b[4*a]=document.createElement("canvas"),b[4*a].width=Math.floor(b[4*a-4*d].width/2),b[4*a].height=Math.floor(b[4*a-4*d].height/2),b[4*a].getContext("2d").drawImage(b[4*a-4*d],0,0,b[4*a-4*d].width,b[4*a-4*d].height,0,0,b[4*a].width,b[4*a].height),f[4*a]={width:b[4*a].width,height:b[4*a].height,data:b[4*a].getContext("2d").getImageData(0,0,b[4*a].width,b[4*a].height).data};
for(a=2*d;a<e+2*d;a++)b[4*a+1]=document.createElement("canvas"),b[4*a+1].width=Math.floor(b[4*a-4*d].width/2),b[4*a+1].height=Math.floor(b[4*a-4*d].height/2),b[4*a+1].getContext("2d").drawImage(b[4*a-4*d],1,0,b[4*a-4*d].width-1,b[4*a-4*d].height,0,0,b[4*a+1].width-2,b[4*a+1].height),f[4*a+1]={width:b[4*a+1].width,height:b[4*a+1].height,data:b[4*a+1].getContext("2d").getImageData(0,0,b[4*a+1].width,b[4*a+1].height).data},b[4*a+2]=document.createElement("canvas"),b[4*a+2].width=Math.floor(b[4*a-4*d].width/
2),b[4*a+2].height=Math.floor(b[4*a-4*d].height/2),b[4*a+2].getContext("2d").drawImage(b[4*a-4*d],0,1,b[4*a-4*d].width,b[4*a-4*d].height-1,0,0,b[4*a+2].width,b[4*a+2].height-2),f[4*a+2]={width:b[4*a+2].width,height:b[4*a+2].height,data:b[4*a+2].getContext("2d").getImageData(0,0,b[4*a+2].width,b[4*a+2].height).data},b[4*a+3]=document.createElement("canvas"),b[4*a+3].width=Math.floor(b[4*a-4*d].width/2),b[4*a+3].height=Math.floor(b[4*a-4*d].height/2),b[4*a+3].getContext("2d").drawImage(b[4*a-4*d],1,
1,b[4*a-4*d].width-1,b[4*a-4*d].height-1,0,0,b[4*a+3].width-2,b[4*a+3].height-2),f[4*a+3]={width:b[4*a+3].width,height:b[4*a+3].height,data:b[4*a+3].getContext("2d").getImageData(0,0,b[4*a+3].width,b[4*a+3].height).data};return[f]},core:function(g,h,d){d=this.shared.cascade;var e=this.shared.scale,b=this.shared.next,f=this.shared.scale_upto,a,c,l,n,k=1,m=1,C=[0,1,0,1],D=[0,0,1,1],H=[];for(a=0;a<f;a++){var x=g[4*a+8*b].width-Math.floor(d.width/4),K=g[4*a+8*b].height-Math.floor(d.height/4);var v=[4*
g[4*a].width,4*g[4*a+4*b].width,4*g[4*a+8*b].width];var E=[16*g[4*a].width-16*x,8*g[4*a+4*b].width-8*x,4*g[4*a+8*b].width-4*x];for(c=0;c<d.stage_classifier.length;c++){var p=d.stage_classifier[c].orig_feature;h=d.stage_classifier[c].feature=Array(d.stage_classifier[c].count);for(l=0;l<d.stage_classifier[c].count;l++)for(h[l]={size:p[l].size,px:Array(p[l].size),pz:Array(p[l].size),nx:Array(p[l].size),nz:Array(p[l].size)},n=0;n<p[l].size;n++)h[l].px[n]=4*p[l].px[n]+p[l].py[n]*v[p[l].pz[n]],h[l].pz[n]=
p[l].pz[n],h[l].nx[n]=4*p[l].nx[n]+p[l].ny[n]*v[p[l].nz[n]],h[l].nz[n]=p[l].nz[n]}for(n=0;4>n;n++){var y=[g[4*a].data,g[4*a+4*b].data,g[4*a+8*b+n].data],q=[8*C[n]+D[n]*g[4*a].width*8,4*C[n]+D[n]*g[4*a+4*b].width*4,0];for(p=0;p<K;p++){for(v=0;v<x;v++){var w=0,I=!0;for(c=0;c<d.stage_classifier.length;c++){w=0;var F=d.stage_classifier[c].alpha;h=d.stage_classifier[c].feature;for(l=0;l<d.stage_classifier[c].count;l++){var r=h[l],z=y[r.pz[0]][q[r.pz[0]]+r.px[0]],A=y[r.nz[0]][q[r.nz[0]]+r.nx[0]];if(z<=
A)w+=F[2*l];else{var t,G=!0;for(t=0;t<r.size;t++){if(0<=r.pz[t]){var u=y[r.pz[t]][q[r.pz[t]]+r.px[t]];if(u<z){if(u<=A){G=!1;break}z=u}}if(0<=r.nz[t]&&(u=y[r.nz[t]][q[r.nz[t]]+r.nx[t]],u>A)){if(z<=u){G=!1;break}A=u}}w+=G?F[2*l+1]:F[2*l]}}if(w<d.stage_classifier[c].threshold){I=!1;break}}I&&H.push({x:(4*v+2*C[n])*k,y:(4*p+2*D[n])*m,width:d.width*k,height:d.height*m,neighbor:1,confidence:w});q[0]+=16;q[1]+=8;q[2]+=4}q[0]+=E[0];q[1]+=E[1];q[2]+=E[2]}}k*=e;m*=e}return H},post:function(e){var h=this.shared.min_neighbors;
var d=this.shared.cascade;var c;for(c=0;c<d.stage_classifier.length;c++)d.stage_classifier[c].feature=d.stage_classifier[c].orig_feature;e=e[0];if(0<h){c=ccv.array_group(e,function(a,b){var c=Math.floor(.25*a.width+.5);return b.x<=a.x+c&&b.x>=a.x-c&&b.y<=a.y+c&&b.y>=a.y-c&&b.width<=Math.floor(1.5*a.width+.5)&&Math.floor(1.5*b.width+.5)>=a.width});var b=c.cat,f=c.index,a=Array(b+1);for(c=0;c<a.length;c++)a[c]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(c=0;c<e.length;c++){d=e[c];var g=
f[c];0==a[g].neighbors&&(a[g].confidence=d.confidence);++a[g].neighbors;a[g].x+=d.x;a[g].y+=d.y;a[g].width+=d.width;a[g].height+=d.height;a[g].confidence=Math.max(a[g].confidence,d.confidence)}e=[];for(c=0;c<b;c++)d=a[c].neighbors,d>=h&&e.push({x:(2*a[c].x+d)/(2*d),y:(2*a[c].y+d)/(2*d),width:(2*a[c].width+d)/(2*d),height:(2*a[c].height+d)/(2*d),neighbors:a[c].neighbors,confidence:a[c].confidence});b=[];for(c=0;c<e.length;c++){d=e[c];a=!0;for(h=0;h<e.length;h++)if(f=e[h],g=Math.floor(.25*f.width+.5),
c!=h&&d.x>=f.x-g&&d.y>=f.y-g&&d.x+d.width<=f.x+f.width+g&&d.y+d.height<=f.y+f.height+g&&(f.neighbors>Math.max(3,d.neighbors)||3>d.neighbors)){a=!1;break}a&&b.push(d)}return b}return e}}})};onmessage=function(f){f="string"==typeof f.data?JSON.parse(f.data):f.data;f=parallable.core[f.name].apply({shared:f.shared},[f.input,f.id,f.worker]);try{postMessage(f)}catch(m){postMessage(JSON.stringify(f))}};